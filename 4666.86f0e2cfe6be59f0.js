(self.webpackChunkcoops=self.webpackChunkcoops||[]).push([[4666],{1076:(gr,Ct,Se)=>{Se.d(Ct,{Am:()=>$,Bd:()=>F,FA:()=>_r,Fy:()=>jt,I9:()=>Nt,Im:()=>Z,Ku:()=>Ut,Ll:()=>Ze,T9:()=>bt,Uj:()=>we,XA:()=>Ht,ZQ:()=>ye,bD:()=>he,cY:()=>Ue,eX:()=>He,g:()=>yn,gR:()=>yr,hp:()=>Gn,jZ:()=>rt,lT:()=>J,lV:()=>Jt,nr:()=>N,p7:()=>Pe,sr:()=>it,tD:()=>Yt,u:()=>q,zW:()=>U,zw:()=>ee});const Ie=function(I){const _=[];let v=0;for(let B=0;B<I.length;B++){let C=I.charCodeAt(B);C<128?_[v++]=C:C<2048?(_[v++]=C>>6|192,_[v++]=63&C|128):55296==(64512&C)&&B+1<I.length&&56320==(64512&I.charCodeAt(B+1))?(C=65536+((1023&C)<<10)+(1023&I.charCodeAt(++B)),_[v++]=C>>18|240,_[v++]=C>>12&63|128,_[v++]=C>>6&63|128,_[v++]=63&C|128):(_[v++]=C>>12|224,_[v++]=C>>6&63|128,_[v++]=63&C|128)}return _},ie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(I,_){if(!Array.isArray(I))throw Error("encodeByteArray takes an array as a parameter");this.init_();const v=_?this.byteToCharMapWebSafe_:this.byteToCharMap_,B=[];for(let C=0;C<I.length;C+=3){const Y=I[C],se=C+1<I.length,Le=se?I[C+1]:0,Ve=C+2<I.length,ot=Ve?I[C+2]:0;let Rt=(15&Le)<<2|ot>>6,Qt=63&ot;Ve||(Qt=64,se||(Rt=64)),B.push(v[Y>>2],v[(3&Y)<<4|Le>>4],v[Rt],v[Qt])}return B.join("")},encodeString(I,_){return this.HAS_NATIVE_SUPPORT&&!_?btoa(I):this.encodeByteArray(Ie(I),_)},decodeString(I,_){return this.HAS_NATIVE_SUPPORT&&!_?atob(I):function(I){const _=[];let v=0,B=0;for(;v<I.length;){const C=I[v++];if(C<128)_[B++]=String.fromCharCode(C);else if(C>191&&C<224){const Y=I[v++];_[B++]=String.fromCharCode((31&C)<<6|63&Y)}else if(C>239&&C<365){const Ve=((7&C)<<18|(63&I[v++])<<12|(63&I[v++])<<6|63&I[v++])-65536;_[B++]=String.fromCharCode(55296+(Ve>>10)),_[B++]=String.fromCharCode(56320+(1023&Ve))}else{const Y=I[v++],se=I[v++];_[B++]=String.fromCharCode((15&C)<<12|(63&Y)<<6|63&se)}}return _.join("")}(this.decodeStringToByteArray(I,_))},decodeStringToByteArray(I,_){this.init_();const v=_?this.charToByteMapWebSafe_:this.charToByteMap_,B=[];for(let C=0;C<I.length;){const Y=v[I.charAt(C++)],Le=C<I.length?v[I.charAt(C)]:0;++C;const ot=C<I.length?v[I.charAt(C)]:64;++C;const ce=C<I.length?v[I.charAt(C)]:64;if(++C,null==Y||null==Le||null==ot||null==ce)throw new tt;B.push(Y<<2|Le>>4),64!==ot&&(B.push(Le<<4&240|ot>>2),64!==ce&&B.push(ot<<6&192|ce))}return B},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let I=0;I<this.ENCODED_VALS.length;I++)this.byteToCharMap_[I]=this.ENCODED_VALS.charAt(I),this.charToByteMap_[this.byteToCharMap_[I]]=I,this.byteToCharMapWebSafe_[I]=this.ENCODED_VALS_WEBSAFE.charAt(I),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[I]]=I,I>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(I)]=I,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(I)]=I)}}};class tt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const we=function(I){return function(I){const _=Ie(I);return ie.encodeByteArray(_,!0)}(I).replace(/\./g,"")},q=function(I){try{return ie.decodeString(I,!0)}catch(_){console.error("base64Decode failed: ",_)}return null};function ee(I,_){if(!(_ instanceof Object))return _;switch(_.constructor){case Date:return new Date(_.getTime());case Object:void 0===I&&(I={});break;case Array:I=[];break;default:return _}for(const v in _)!_.hasOwnProperty(v)||!_e(v)||(I[v]=ee(I[v],_[v]));return I}function _e(I){return"__proto__"!==I}const ge=()=>{try{return function Ce(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const I=process.env.__FIREBASE_DEFAULTS__;return I?JSON.parse(I):void 0})()||(()=>{if(typeof document>"u")return;let I;try{I=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const _=I&&q(I[1]);return _&&JSON.parse(_)})()}catch(I){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${I}`)}},bt=()=>{var I;return null===(I=ge())||void 0===I?void 0:I.config},Ht=I=>{var _;return null===(_=ge())||void 0===_?void 0:_[`_${I}`]};class Ue{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((_,v)=>{this.resolve=_,this.reject=v})}wrapCallback(_){return(v,B)=>{v?this.reject(v):this.resolve(B),"function"==typeof _&&(this.promise.catch(()=>{}),1===_.length?_(v):_(v,B))}}}function jt(I,_){if(I.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const B=_||"demo-project",C=I.iat||0,Y=I.sub||I.user_id;if(!Y)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const se=Object.assign({iss:`https://securetoken.google.com/${B}`,aud:B,iat:C,exp:C+3600,auth_time:C,sub:Y,user_id:Y,firebase:{sign_in_provider:"custom",identities:{}}},I);return[we(JSON.stringify({alg:"none",type:"JWT"})),we(JSON.stringify(se)),""].join(".")}function ye(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function rt(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ye())}function Ze(){var I;const _=null===(I=ge())||void 0===I?void 0:I.forceEnvironment;if("node"===_)return!0;if("browser"===_)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function F(){return typeof window<"u"||Pe()}function Pe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function it(){const I="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof I&&void 0!==I.id}function Jt(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function J(){const I=ye();return I.indexOf("MSIE ")>=0||I.indexOf("Trident/")>=0}function N(){return!Ze()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){try{return"object"==typeof indexedDB}catch{return!1}}function He(){return new Promise((I,_)=>{try{let v=!0;const B="validate-browser-context-for-indexeddb-analytics-module",C=self.indexedDB.open(B);C.onsuccess=()=>{C.result.close(),v||self.indexedDB.deleteDatabase(B),I(!0)},C.onupgradeneeded=()=>{v=!1},C.onerror=()=>{var Y;_((null===(Y=C.error)||void 0===Y?void 0:Y.message)||"")}}catch(v){_(v)}})}class yn extends Error{constructor(_,v,B){super(v),this.code=_,this.customData=B,this.name="FirebaseError",Object.setPrototypeOf(this,yn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_r.prototype.create)}}class _r{constructor(_,v,B){this.service=_,this.serviceName=v,this.errors=B}create(_,...v){const B=v[0]||{},C=`${this.service}/${_}`,Y=this.errors[_],se=Y?function ci(I,_){return I.replace(li,(v,B)=>{const C=_[B];return null!=C?String(C):`<${B}?>`})}(Y,B):"Error";return new yn(C,`${this.serviceName}: ${se} (${C}).`,B)}}const li=/\{\$([^}]+)}/g;function yr(I,_){return Object.prototype.hasOwnProperty.call(I,_)}function Z(I){for(const _ in I)if(Object.prototype.hasOwnProperty.call(I,_))return!1;return!0}function he(I,_){if(I===_)return!0;const v=Object.keys(I),B=Object.keys(_);for(const C of v){if(!B.includes(C))return!1;const Y=I[C],se=_[C];if(Ir(Y)&&Ir(se)){if(!he(Y,se))return!1}else if(Y!==se)return!1}for(const C of B)if(!v.includes(C))return!1;return!0}function Ir(I){return null!==I&&"object"==typeof I}function $(I){const _=[];for(const[v,B]of Object.entries(I))Array.isArray(B)?B.forEach(C=>{_.push(encodeURIComponent(v)+"="+encodeURIComponent(C))}):_.push(encodeURIComponent(v)+"="+encodeURIComponent(B));return _.length?"&"+_.join("&"):""}function Nt(I){const _={};return I.replace(/^\?/,"").split("&").forEach(B=>{if(B){const[C,Y]=B.split("=");_[decodeURIComponent(C)]=decodeURIComponent(Y)}}),_}function Gn(I){const _=I.indexOf("?");if(!_)return"";const v=I.indexOf("#",_);return I.substring(_,v>0?v:void 0)}function Yt(I,_){const v=new _t(I,_);return v.subscribe.bind(v)}class _t{constructor(_,v){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=v,this.task.then(()=>{_(this)}).catch(B=>{this.error(B)})}next(_){this.forEachObserver(v=>{v.next(_)})}error(_){this.forEachObserver(v=>{v.error(_)}),this.close(_)}complete(){this.forEachObserver(_=>{_.complete()}),this.close()}subscribe(_,v,B){let C;if(void 0===_&&void 0===v&&void 0===B)throw new Error("Missing Observer.");C=function Xt(I,_){if("object"!=typeof I||null===I)return!1;for(const v of _)if(v in I&&"function"==typeof I[v])return!0;return!1}(_,["next","error","complete"])?_:{next:_,error:v,complete:B},void 0===C.next&&(C.next=Gt),void 0===C.error&&(C.error=Gt),void 0===C.complete&&(C.complete=Gt);const Y=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?C.error(this.finalError):C.complete()}catch{}}),this.observers.push(C),Y}unsubscribeOne(_){void 0===this.observers||void 0===this.observers[_]||(delete this.observers[_],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(_){if(!this.finalized)for(let v=0;v<this.observers.length;v++)this.sendOne(v,_)}sendOne(_,v){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[_])try{v(this.observers[_])}catch(B){typeof console<"u"&&console.error&&console.error(B)}})}close(_){this.finalized||(this.finalized=!0,void 0!==_&&(this.finalError=_),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gt(){}function Ut(I){return I&&I._delegate?I._delegate:I}},3345:(gr,Ct,Se)=>{Se.d(Ct,{A:()=>nt});var Te=Se(1076),V=Se(1362),ve=Se(5471),Ie=Se(8041);class Ge{constructor(fe,ge){this._delegate=fe,this.firebase=ge,(0,ve._addComponent)(fe,new V.uA("app-compat",()=>this,"PUBLIC")),this.container=fe.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(fe){this._delegate.automaticDataCollectionEnabled=fe}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(fe=>{this._delegate.checkDestroyed(),fe()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,ve.deleteApp)(this._delegate)))}_getService(fe,ge=ve._DEFAULT_ENTRY_NAME){var Bt;this._delegate.checkDestroyed();const Dt=this._delegate.container.getProvider(fe);return!Dt.isInitialized()&&"EXPLICIT"===(null===(Bt=Dt.getComponent())||void 0===Bt?void 0:Bt.instantiationMode)&&Dt.initialize(),Dt.getImmediate({identifier:ge})}_removeServiceInstance(fe,ge=ve._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(fe).clearInstance(ge)}_addComponent(fe){(0,ve._addComponent)(this._delegate,fe)}_addOrOverwriteComponent(fe){(0,ve._addOrOverwriteComponent)(this._delegate,fe)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const tt=new Te.FA("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),q=function we(){const Fe=function lt(Fe){const fe={},ge={__esModule:!0,initializeApp:function bt(ye,rt={}){const Ze=ve.initializeApp(ye,rt);if((0,Te.gR)(fe,Ze.name))return fe[Ze.name];const F=new Fe(Ze,ge);return fe[Ze.name]=F,F},app:Dt,registerVersion:ve.registerVersion,setLogLevel:ve.setLogLevel,onLog:ve.onLog,apps:null,SDK_VERSION:ve.SDK_VERSION,INTERNAL:{registerComponent:function Ue(ye){const rt=ye.name,Ze=rt.replace("-compat","");if(ve._registerComponent(ye)&&"PUBLIC"===ye.type){const F=(Pe=Dt())=>{if("function"!=typeof Pe[Ze])throw tt.create("invalid-app-argument",{appName:rt});return Pe[Ze]()};void 0!==ye.serviceProps&&(0,Te.zw)(F,ye.serviceProps),ge[Ze]=F,Fe.prototype[Ze]=function(...Pe){return this._getService.bind(this,rt).apply(this,ye.multipleInstances?Pe:[])}}return"PUBLIC"===ye.type?ge[Ze]:null},removeApp:function Bt(ye){delete fe[ye]},useAsService:function jt(ye,rt){return"serverAuth"===rt?null:rt},modularAPIs:ve}};function Dt(ye){if(!(0,Te.gR)(fe,ye=ye||ve._DEFAULT_ENTRY_NAME))throw tt.create("no-app",{appName:ye});return fe[ye]}return ge.default=ge,Object.defineProperty(ge,"apps",{get:function Ht(){return Object.keys(fe).map(ye=>fe[ye])}}),Dt.App=Fe,ge}(Ge);return Fe.INTERNAL=Object.assign(Object.assign({},Fe.INTERNAL),{createFirebaseNamespace:we,extendNamespace:function fe(ge){(0,Te.zw)(Fe,ge)},createSubscribe:Te.tD,ErrorFactory:Te.FA,deepExtend:Te.zw}),Fe}(),j=new Ie.Vy("@firebase/app-compat");if((0,Te.Bd)()&&void 0!==self.firebase){j.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const Fe=self.firebase.SDK_VERSION;Fe&&Fe.indexOf("LITE")>=0&&j.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const nt=q;!function Ce(Fe){(0,ve.registerVersion)("@firebase/app-compat","0.2.37",Fe)}()},5471:(gr,Ct,Se)=>{Se.r(Ct),Se.d(Ct,{FirebaseError:()=>Ie.g,SDK_VERSION:()=>kt,_DEFAULT_ENTRY_NAME:()=>Nt,_addComponent:()=>Er,_addOrOverwriteComponent:()=>Xt,_apps:()=>ht,_clearComponents:()=>fi,_components:()=>_t,_getProvider:()=>Tr,_isFirebaseApp:()=>Kn,_isFirebaseServerApp:()=>di,_registerComponent:()=>Gt,_removeServiceInstance:()=>st,_serverApps:()=>Yt,deleteApp:()=>vr,getApp:()=>Tn,getApps:()=>$t,initializeApp:()=>$n,initializeServerApp:()=>mi,onLog:()=>_,registerVersion:()=>I,setLogLevel:()=>v});var Te=Se(467),V=Se(1362),ve=Se(8041),Ie=Se(1076);const Ge=(k,R)=>R.some(O=>k instanceof O);let ie,tt;const q=new WeakMap,j=new WeakMap,ee=new WeakMap,_e=new WeakMap,Ce=new WeakMap;let fe={get(k,R,O){if(k instanceof IDBTransaction){if("done"===R)return j.get(k);if("objectStoreNames"===R)return k.objectStoreNames||ee.get(k);if("store"===R)return O.objectStoreNames[1]?void 0:O.objectStore(O.objectStoreNames[0])}return bt(k[R])},set:(k,R,O)=>(k[R]=O,!0),has:(k,R)=>k instanceof IDBTransaction&&("done"===R||"store"===R)||R in k};function Dt(k){return"function"==typeof k?function Bt(k){return k!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function we(){return tt||(tt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(k)?function(...R){return k.apply(Ht(this),R),bt(q.get(this))}:function(...R){return bt(k.apply(Ht(this),R))}:function(R,...O){const H=k.call(Ht(this),R,...O);return ee.set(H,R.sort?R.sort():[R]),bt(H)}}(k):(k instanceof IDBTransaction&&function Fe(k){if(j.has(k))return;const R=new Promise((O,H)=>{const oe=()=>{k.removeEventListener("complete",ue),k.removeEventListener("error",me),k.removeEventListener("abort",me)},ue=()=>{O(),oe()},me=()=>{H(k.error||new DOMException("AbortError","AbortError")),oe()};k.addEventListener("complete",ue),k.addEventListener("error",me),k.addEventListener("abort",me)});j.set(k,R)}(k),Ge(k,function lt(){return ie||(ie=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(k,fe):k)}function bt(k){if(k instanceof IDBRequest)return function nt(k){const R=new Promise((O,H)=>{const oe=()=>{k.removeEventListener("success",ue),k.removeEventListener("error",me)},ue=()=>{O(bt(k.result)),oe()},me=()=>{H(k.error),oe()};k.addEventListener("success",ue),k.addEventListener("error",me)});return R.then(O=>{O instanceof IDBCursor&&q.set(O,k)}).catch(()=>{}),Ce.set(R,k),R}(k);if(_e.has(k))return _e.get(k);const R=Dt(k);return R!==k&&(_e.set(k,R),Ce.set(R,k)),R}const Ht=k=>Ce.get(k),ye=["get","getKey","getAll","getAllKeys","count"],rt=["put","add","delete","clear"],Ze=new Map;function F(k,R){if(!(k instanceof IDBDatabase)||R in k||"string"!=typeof R)return;if(Ze.get(R))return Ze.get(R);const O=R.replace(/FromIndex$/,""),H=R!==O,oe=rt.includes(O);if(!(O in(H?IDBIndex:IDBObjectStore).prototype)||!oe&&!ye.includes(O))return;const ue=function(){var me=(0,Te.A)(function*(Ke,...$e){const Ot=this.transaction(Ke,oe?"readwrite":"readonly");let Qn=Ot.store;return H&&(Qn=Qn.index($e.shift())),(yield Promise.all([Qn[O](...$e),oe&&Ot.done]))[0]});return function($e){return me.apply(this,arguments)}}();return Ze.set(R,ue),ue}!function ge(k){fe=k(fe)}(k=>({...k,get:(R,O,H)=>F(R,O)||k.get(R,O,H),has:(R,O)=>!!F(R,O)||k.has(R,O)}));class Pe{constructor(R){this.container=R}getPlatformInfoString(){return this.container.getProviders().map(O=>{if(function it(k){const R=k.getComponent();return"VERSION"===R?.type}(O)){const H=O.getImmediate();return`${H.library}/${H.version}`}return null}).filter(O=>O).join(" ")}}const Jt="@firebase/app",W="0.10.7",J=new ve.Vy("@firebase/app"),Nt="[DEFAULT]",Gn={[Jt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ht=new Map,Yt=new Map,_t=new Map;function Er(k,R){try{k.container.addComponent(R)}catch(O){J.debug(`Component ${R.name} failed to register with FirebaseApp ${k.name}`,O)}}function Xt(k,R){k.container.addOrOverwriteComponent(R)}function Gt(k){const R=k.name;if(_t.has(R))return J.debug(`There were multiple attempts to register component ${R}.`),!1;_t.set(R,k);for(const O of ht.values())Er(O,k);for(const O of Yt.values())Er(O,k);return!0}function Tr(k,R){const O=k.container.getProvider("heartbeat").getImmediate({optional:!0});return O&&O.triggerHeartbeat(),k.container.getProvider(R)}function st(k,R,O=Nt){Tr(k,R).clearInstance(O)}function Kn(k){return void 0!==k.options}function di(k){return void 0!==k.settings}function fi(){_t.clear()}const dt=new Ie.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class P{constructor(R,O,H){this._isDeleted=!1,this._options=Object.assign({},R),this._config=Object.assign({},O),this._name=O.name,this._automaticDataCollectionEnabled=O.automaticDataCollectionEnabled,this._container=H,this.container.addComponent(new V.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(R){this.checkDestroyed(),this._automaticDataCollectionEnabled=R}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(R){this._isDeleted=R}checkDestroyed(){if(this.isDeleted)throw dt.create("app-deleted",{appName:this._name})}}class En extends P{constructor(R,O,H,oe){const ue=void 0!==O.automaticDataCollectionEnabled&&O.automaticDataCollectionEnabled,me={name:H,automaticDataCollectionEnabled:ue};super(void 0!==R.apiKey?R:R.options,me,oe),this._serverConfig=Object.assign({automaticDataCollectionEnabled:ue},O),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,O.releaseOnDeref=void 0,I(Jt,W,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(R){this.isDeleted||(this._refCount++,void 0!==R&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(R,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){vr(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw dt.create("server-app-deleted")}}const kt="10.12.4";function $n(k,R={}){let O=k;"object"!=typeof R&&(R={name:R});const H=Object.assign({name:Nt,automaticDataCollectionEnabled:!1},R),oe=H.name;if("string"!=typeof oe||!oe)throw dt.create("bad-app-name",{appName:String(oe)});if(O||(O=(0,Ie.T9)()),!O)throw dt.create("no-options");const ue=ht.get(oe);if(ue){if((0,Ie.bD)(O,ue.options)&&(0,Ie.bD)(H,ue.config))return ue;throw dt.create("duplicate-app",{appName:oe})}const me=new V.h1(oe);for(const $e of _t.values())me.addComponent($e);const Ke=new P(O,H,me);return ht.set(oe,Ke),Ke}function mi(k,R){if((0,Ie.Bd)()&&!(0,Ie.p7)())throw dt.create("invalid-server-app-environment");let O;void 0===R.automaticDataCollectionEnabled&&(R.automaticDataCollectionEnabled=!1),O=Kn(k)?k.options:k;const H=Object.assign(Object.assign({},R),O);if(void 0!==H.releaseOnDeref&&delete H.releaseOnDeref,void 0!==R.releaseOnDeref&&typeof FinalizationRegistry>"u")throw dt.create("finalization-registry-not-supported",{});const ue=""+(Ot=JSON.stringify(H),[...Ot].reduce((Qn,vs)=>Math.imul(31,Qn)+vs.charCodeAt(0)|0,0)),me=Yt.get(ue);var Ot;if(me)return me.incRefCount(R.releaseOnDeref),me;const Ke=new V.h1(ue);for(const Ot of _t.values())Ke.addComponent(Ot);const $e=new En(O,R,ue,Ke);return Yt.set(ue,$e),$e}function Tn(k=Nt){const R=ht.get(k);if(!R&&k===Nt&&(0,Ie.T9)())return $n();if(!R)throw dt.create("no-app",{appName:k});return R}function $t(){return Array.from(ht.values())}function vr(k){return Ut.apply(this,arguments)}function Ut(){return(Ut=(0,Te.A)(function*(k){let R=!1;const O=k.name;ht.has(O)?(R=!0,ht.delete(O)):Yt.has(O)&&k.decRefCount()<=0&&(Yt.delete(O),R=!0),R&&(yield Promise.all(k.container.getProviders().map(H=>H.delete())),k.isDeleted=!0)})).apply(this,arguments)}function I(k,R,O){var H;let oe=null!==(H=Gn[k])&&void 0!==H?H:k;O&&(oe+=`-${O}`);const ue=oe.match(/\s|\//),me=R.match(/\s|\//);if(ue||me){const Ke=[`Unable to register library "${oe}" with version "${R}":`];return ue&&Ke.push(`library name "${oe}" contains illegal characters (whitespace or "/")`),ue&&me&&Ke.push("and"),me&&Ke.push(`version name "${R}" contains illegal characters (whitespace or "/")`),void J.warn(Ke.join(" "))}Gt(new V.uA(`${oe}-version`,()=>({library:oe,version:R}),"VERSION"))}function _(k,R){if(null!==k&&"function"!=typeof k)throw dt.create("invalid-log-argument");(0,ve.Ey)(k,R)}function v(k){(0,ve.He)(k)}const B="firebase-heartbeat-database",C=1,Y="firebase-heartbeat-store";let se=null;function Le(){return se||(se=function Ue(k,R,{blocked:O,upgrade:H,blocking:oe,terminated:ue}={}){const me=indexedDB.open(k,R),Ke=bt(me);return H&&me.addEventListener("upgradeneeded",$e=>{H(bt(me.result),$e.oldVersion,$e.newVersion,bt(me.transaction),$e)}),O&&me.addEventListener("blocked",$e=>O($e.oldVersion,$e.newVersion,$e)),Ke.then($e=>{ue&&$e.addEventListener("close",()=>ue()),oe&&$e.addEventListener("versionchange",Ot=>oe(Ot.oldVersion,Ot.newVersion,Ot))}).catch(()=>{}),Ke}(B,C,{upgrade:(k,R)=>{if(0===R)try{k.createObjectStore(Y)}catch(O){console.warn(O)}}}).catch(k=>{throw dt.create("idb-open",{originalErrorMessage:k.message})})),se}function ot(){return(ot=(0,Te.A)(function*(k){try{const O=(yield Le()).transaction(Y),H=yield O.objectStore(Y).get(Rt(k));return yield O.done,H}catch(R){if(R instanceof Ie.g)J.warn(R.message);else{const O=dt.create("idb-get",{originalErrorMessage:R?.message});J.warn(O.message)}}})).apply(this,arguments)}function Mt(k,R){return ce.apply(this,arguments)}function ce(){return(ce=(0,Te.A)(function*(k,R){try{const H=(yield Le()).transaction(Y,"readwrite");yield H.objectStore(Y).put(R,Rt(k)),yield H.done}catch(O){if(O instanceof Ie.g)J.warn(O.message);else{const H=dt.create("idb-set",{originalErrorMessage:O?.message});J.warn(H.message)}}})).apply(this,arguments)}function Rt(k){return`${k.name}!${k.options.appId}`}class Fo{constructor(R){this.container=R,this._heartbeatsCache=null;const O=this.container.getProvider("app").getImmediate();this._storage=new Bo(O),this._heartbeatsCachePromise=this._storage.read().then(H=>(this._heartbeatsCache=H,H))}triggerHeartbeat(){var R=this;return(0,Te.A)(function*(){var O,H;const ue=R.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),me=Es();if((null!=(null===(O=R._heartbeatsCache)||void 0===O?void 0:O.heartbeats)||(R._heartbeatsCache=yield R._heartbeatsCachePromise,null!=(null===(H=R._heartbeatsCache)||void 0===H?void 0:H.heartbeats)))&&R._heartbeatsCache.lastSentHeartbeatDate!==me&&!R._heartbeatsCache.heartbeats.some(Ke=>Ke.date===me))return R._heartbeatsCache.heartbeats.push({date:me,agent:ue}),R._heartbeatsCache.heartbeats=R._heartbeatsCache.heartbeats.filter(Ke=>{const $e=new Date(Ke.date).valueOf();return Date.now()-$e<=2592e6}),R._storage.overwrite(R._heartbeatsCache)})()}getHeartbeatsHeader(){var R=this;return(0,Te.A)(function*(){var O;if(null===R._heartbeatsCache&&(yield R._heartbeatsCachePromise),null==(null===(O=R._heartbeatsCache)||void 0===O?void 0:O.heartbeats)||0===R._heartbeatsCache.heartbeats.length)return"";const H=Es(),{heartbeatsToSend:oe,unsentEntries:ue}=function Lo(k,R=1024){const O=[];let H=k.slice();for(const oe of k){const ue=O.find(me=>me.agent===oe.agent);if(ue){if(ue.dates.push(oe.date),Ts(O)>R){ue.dates.pop();break}}else if(O.push({agent:oe.agent,dates:[oe.date]}),Ts(O)>R){O.pop();break}H=H.slice(1)}return{heartbeatsToSend:O,unsentEntries:H}}(R._heartbeatsCache.heartbeats),me=(0,Ie.Uj)(JSON.stringify({version:2,heartbeats:oe}));return R._heartbeatsCache.lastSentHeartbeatDate=H,ue.length>0?(R._heartbeatsCache.heartbeats=ue,yield R._storage.overwrite(R._heartbeatsCache)):(R._heartbeatsCache.heartbeats=[],R._storage.overwrite(R._heartbeatsCache)),me})()}}function Es(){return(new Date).toISOString().substring(0,10)}class Bo{constructor(R){this.app=R,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,Te.A)(function*(){return!!(0,Ie.zW)()&&(0,Ie.eX)().then(()=>!0).catch(()=>!1)})()}read(){var R=this;return(0,Te.A)(function*(){if(yield R._canUseIndexedDBPromise){const H=yield function Ve(k){return ot.apply(this,arguments)}(R.app);return H?.heartbeats?H:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(R){var O=this;return(0,Te.A)(function*(){var H;if(yield O._canUseIndexedDBPromise){const ue=yield O.read();return Mt(O.app,{lastSentHeartbeatDate:null!==(H=R.lastSentHeartbeatDate)&&void 0!==H?H:ue.lastSentHeartbeatDate,heartbeats:R.heartbeats})}})()}add(R){var O=this;return(0,Te.A)(function*(){var H;if(yield O._canUseIndexedDBPromise){const ue=yield O.read();return Mt(O.app,{lastSentHeartbeatDate:null!==(H=R.lastSentHeartbeatDate)&&void 0!==H?H:ue.lastSentHeartbeatDate,heartbeats:[...ue.heartbeats,...R.heartbeats]})}})()}}function Ts(k){return(0,Ie.Uj)(JSON.stringify({version:2,heartbeats:k})).length}!function Uo(k){Gt(new V.uA("platform-logger",R=>new Pe(R),"PRIVATE")),Gt(new V.uA("heartbeat",R=>new Fo(R),"PRIVATE")),I(Jt,W,k),I(Jt,W,"esm2017"),I("fire-js","")}("")},1362:(gr,Ct,Se)=>{Se.d(Ct,{h1:()=>lt,uA:()=>ve});var Te=Se(467),V=Se(1076);class ve{constructor(q,j,ee){this.name=q,this.instanceFactory=j,this.type=ee,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(q){return this.instantiationMode=q,this}setMultipleInstances(q){return this.multipleInstances=q,this}setServiceProps(q){return this.serviceProps=q,this}setInstanceCreatedCallback(q){return this.onInstanceCreated=q,this}}const Ie="[DEFAULT]";class Ge{constructor(q,j){this.name=q,this.container=j,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(q){const j=this.normalizeInstanceIdentifier(q);if(!this.instancesDeferred.has(j)){const ee=new V.cY;if(this.instancesDeferred.set(j,ee),this.isInitialized(j)||this.shouldAutoInitialize())try{const _e=this.getOrInitializeService({instanceIdentifier:j});_e&&ee.resolve(_e)}catch{}}return this.instancesDeferred.get(j).promise}getImmediate(q){var j;const ee=this.normalizeInstanceIdentifier(q?.identifier),_e=null!==(j=q?.optional)&&void 0!==j&&j;if(!this.isInitialized(ee)&&!this.shouldAutoInitialize()){if(_e)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:ee})}catch(Ce){if(_e)return null;throw Ce}}getComponent(){return this.component}setComponent(q){if(q.name!==this.name)throw Error(`Mismatching Component ${q.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=q,this.shouldAutoInitialize()){if(function tt(we){return"EAGER"===we.instantiationMode}(q))try{this.getOrInitializeService({instanceIdentifier:Ie})}catch{}for(const[j,ee]of this.instancesDeferred.entries()){const _e=this.normalizeInstanceIdentifier(j);try{const Ce=this.getOrInitializeService({instanceIdentifier:_e});ee.resolve(Ce)}catch{}}}}clearInstance(q=Ie){this.instancesDeferred.delete(q),this.instancesOptions.delete(q),this.instances.delete(q)}delete(){var q=this;return(0,Te.A)(function*(){const j=Array.from(q.instances.values());yield Promise.all([...j.filter(ee=>"INTERNAL"in ee).map(ee=>ee.INTERNAL.delete()),...j.filter(ee=>"_delete"in ee).map(ee=>ee._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(q=Ie){return this.instances.has(q)}getOptions(q=Ie){return this.instancesOptions.get(q)||{}}initialize(q={}){const{options:j={}}=q,ee=this.normalizeInstanceIdentifier(q.instanceIdentifier);if(this.isInitialized(ee))throw Error(`${this.name}(${ee}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _e=this.getOrInitializeService({instanceIdentifier:ee,options:j});for(const[Ce,nt]of this.instancesDeferred.entries())ee===this.normalizeInstanceIdentifier(Ce)&&nt.resolve(_e);return _e}onInit(q,j){var ee;const _e=this.normalizeInstanceIdentifier(j),Ce=null!==(ee=this.onInitCallbacks.get(_e))&&void 0!==ee?ee:new Set;Ce.add(q),this.onInitCallbacks.set(_e,Ce);const nt=this.instances.get(_e);return nt&&q(nt,_e),()=>{Ce.delete(q)}}invokeOnInitCallbacks(q,j){const ee=this.onInitCallbacks.get(j);if(ee)for(const _e of ee)try{_e(q,j)}catch{}}getOrInitializeService({instanceIdentifier:q,options:j={}}){let ee=this.instances.get(q);if(!ee&&this.component&&(ee=this.component.instanceFactory(this.container,{instanceIdentifier:(we=q,we===Ie?void 0:we),options:j}),this.instances.set(q,ee),this.instancesOptions.set(q,j),this.invokeOnInitCallbacks(ee,q),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,q,ee)}catch{}var we;return ee||null}normalizeInstanceIdentifier(q=Ie){return this.component?this.component.multipleInstances?q:Ie:q}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class lt{constructor(q){this.name=q,this.providers=new Map}addComponent(q){const j=this.getProvider(q.name);if(j.isComponentSet())throw new Error(`Component ${q.name} has already been registered with ${this.name}`);j.setComponent(q)}addOrOverwriteComponent(q){this.getProvider(q.name).isComponentSet()&&this.providers.delete(q.name),this.addComponent(q)}getProvider(q){if(this.providers.has(q))return this.providers.get(q);const j=new Ge(q,this);return this.providers.set(q,j),j}getProviders(){return Array.from(this.providers.values())}}},8041:(gr,Ct,Se)=>{Se.d(Ct,{$b:()=>V,Ey:()=>we,He:()=>lt,Vy:()=>tt});const Te=[];var V=function(q){return q[q.DEBUG=0]="DEBUG",q[q.VERBOSE=1]="VERBOSE",q[q.INFO=2]="INFO",q[q.WARN=3]="WARN",q[q.ERROR=4]="ERROR",q[q.SILENT=5]="SILENT",q}(V||{});const ve={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},Ie=V.INFO,Ge={[V.DEBUG]:"log",[V.VERBOSE]:"log",[V.INFO]:"info",[V.WARN]:"warn",[V.ERROR]:"error"},ie=(q,j,...ee)=>{if(j<q.logLevel)return;const _e=(new Date).toISOString(),Ce=Ge[j];if(!Ce)throw new Error(`Attempted to log a message with an invalid logType (value: ${j})`);console[Ce](`[${_e}]  ${q.name}:`,...ee)};class tt{constructor(j){this.name=j,this._logLevel=Ie,this._logHandler=ie,this._userLogHandler=null,Te.push(this)}get logLevel(){return this._logLevel}set logLevel(j){if(!(j in V))throw new TypeError(`Invalid value "${j}" assigned to \`logLevel\``);this._logLevel=j}setLogLevel(j){this._logLevel="string"==typeof j?ve[j]:j}get logHandler(){return this._logHandler}set logHandler(j){if("function"!=typeof j)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=j}get userLogHandler(){return this._userLogHandler}set userLogHandler(j){this._userLogHandler=j}debug(...j){this._userLogHandler&&this._userLogHandler(this,V.DEBUG,...j),this._logHandler(this,V.DEBUG,...j)}log(...j){this._userLogHandler&&this._userLogHandler(this,V.VERBOSE,...j),this._logHandler(this,V.VERBOSE,...j)}info(...j){this._userLogHandler&&this._userLogHandler(this,V.INFO,...j),this._logHandler(this,V.INFO,...j)}warn(...j){this._userLogHandler&&this._userLogHandler(this,V.WARN,...j),this._logHandler(this,V.WARN,...j)}error(...j){this._userLogHandler&&this._userLogHandler(this,V.ERROR,...j),this._logHandler(this,V.ERROR,...j)}}function lt(q){Te.forEach(j=>{j.setLogLevel(q)})}function we(q,j){for(const ee of Te){let _e=null;j&&j.level&&(_e=ve[j.level]),ee.userLogHandler=null===q?null:(Ce,nt,...Fe)=>{const fe=Fe.map(ge=>{if(null==ge)return null;if("string"==typeof ge)return ge;if("number"==typeof ge||"boolean"==typeof ge)return ge.toString();if(ge instanceof Error)return ge.message;try{return JSON.stringify(ge)}catch{return null}}).filter(ge=>ge).join(" ");nt>=(_e??Ce.logLevel)&&q({level:V[nt].toLowerCase(),message:fe,args:Fe,type:Ce.name})}}}},4666:(gr,Ct,Se)=>{Se.r(Ct);var we,q,Te=Se(3345),V=Se(467),ve=Se(5471),Ie=Se(1362),Ge=Se(8041),ie=Se(1076),tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lt={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(A,g,T){T||(T=0);var w=Array(16);if("string"==typeof g)for(var b=0;16>b;++b)w[b]=g.charCodeAt(T++)|g.charCodeAt(T++)<<8|g.charCodeAt(T++)<<16|g.charCodeAt(T++)<<24;else for(b=0;16>b;++b)w[b]=g[T++]|g[T++]<<8|g[T++]<<16|g[T++]<<24;var D=A.g[3],E=(g=A.g[0])+(D^(T=A.g[1])&((b=A.g[2])^D))+w[0]+3614090360&4294967295;E=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=(T=(b=(D=(g=T+(E<<7&4294967295|E>>>25))+((E=D+(b^g&(T^b))+w[1]+3905402710&4294967295)<<12&4294967295|E>>>20))+((E=b+(T^D&(g^T))+w[2]+606105819&4294967295)<<17&4294967295|E>>>15))+((E=T+(g^b&(D^g))+w[3]+3250441966&4294967295)<<22&4294967295|E>>>10))+((E=g+(D^T&(b^D))+w[4]+4118548399&4294967295)<<7&4294967295|E>>>25))+((E=D+(b^g&(T^b))+w[5]+1200080426&4294967295)<<12&4294967295|E>>>20))+((E=b+(T^D&(g^T))+w[6]+2821735955&4294967295)<<17&4294967295|E>>>15))+((E=T+(g^b&(D^g))+w[7]+4249261313&4294967295)<<22&4294967295|E>>>10))+((E=g+(D^T&(b^D))+w[8]+1770035416&4294967295)<<7&4294967295|E>>>25))+((E=D+(b^g&(T^b))+w[9]+2336552879&4294967295)<<12&4294967295|E>>>20))+((E=b+(T^D&(g^T))+w[10]+4294925233&4294967295)<<17&4294967295|E>>>15))+((E=T+(g^b&(D^g))+w[11]+2304563134&4294967295)<<22&4294967295|E>>>10))+((E=g+(D^T&(b^D))+w[12]+1804603682&4294967295)<<7&4294967295|E>>>25))+((E=D+(b^g&(T^b))+w[13]+4254626195&4294967295)<<12&4294967295|E>>>20))+((E=b+(T^D&(g^T))+w[14]+2792965006&4294967295)<<17&4294967295|E>>>15))+((E=T+(g^b&(D^g))+w[15]+1236535329&4294967295)<<22&4294967295|E>>>10))+((E=g+(b^D&(T^b))+w[1]+4129170786&4294967295)<<5&4294967295|E>>>27))+((E=D+(T^b&(g^T))+w[6]+3225465664&4294967295)<<9&4294967295|E>>>23))+((E=b+(g^T&(D^g))+w[11]+643717713&4294967295)<<14&4294967295|E>>>18))+((E=T+(D^g&(b^D))+w[0]+3921069994&4294967295)<<20&4294967295|E>>>12))+((E=g+(b^D&(T^b))+w[5]+3593408605&4294967295)<<5&4294967295|E>>>27))+((E=D+(T^b&(g^T))+w[10]+38016083&4294967295)<<9&4294967295|E>>>23))+((E=b+(g^T&(D^g))+w[15]+3634488961&4294967295)<<14&4294967295|E>>>18))+((E=T+(D^g&(b^D))+w[4]+3889429448&4294967295)<<20&4294967295|E>>>12))+((E=g+(b^D&(T^b))+w[9]+568446438&4294967295)<<5&4294967295|E>>>27))+((E=D+(T^b&(g^T))+w[14]+3275163606&4294967295)<<9&4294967295|E>>>23))+((E=b+(g^T&(D^g))+w[3]+4107603335&4294967295)<<14&4294967295|E>>>18))+((E=T+(D^g&(b^D))+w[8]+1163531501&4294967295)<<20&4294967295|E>>>12))+((E=g+(b^D&(T^b))+w[13]+2850285829&4294967295)<<5&4294967295|E>>>27))+((E=D+(T^b&(g^T))+w[2]+4243563512&4294967295)<<9&4294967295|E>>>23))+((E=b+(g^T&(D^g))+w[7]+1735328473&4294967295)<<14&4294967295|E>>>18))+((E=T+(D^g&(b^D))+w[12]+2368359562&4294967295)<<20&4294967295|E>>>12))+((E=g+(T^b^D)+w[5]+4294588738&4294967295)<<4&4294967295|E>>>28))+((E=D+(g^T^b)+w[8]+2272392833&4294967295)<<11&4294967295|E>>>21))+((E=b+(D^g^T)+w[11]+1839030562&4294967295)<<16&4294967295|E>>>16))+((E=T+(b^D^g)+w[14]+4259657740&4294967295)<<23&4294967295|E>>>9))+((E=g+(T^b^D)+w[1]+2763975236&4294967295)<<4&4294967295|E>>>28))+((E=D+(g^T^b)+w[4]+1272893353&4294967295)<<11&4294967295|E>>>21))+((E=b+(D^g^T)+w[7]+4139469664&4294967295)<<16&4294967295|E>>>16))+((E=T+(b^D^g)+w[10]+3200236656&4294967295)<<23&4294967295|E>>>9))+((E=g+(T^b^D)+w[13]+681279174&4294967295)<<4&4294967295|E>>>28))+((E=D+(g^T^b)+w[0]+3936430074&4294967295)<<11&4294967295|E>>>21))+((E=b+(D^g^T)+w[3]+3572445317&4294967295)<<16&4294967295|E>>>16))+((E=T+(b^D^g)+w[6]+76029189&4294967295)<<23&4294967295|E>>>9))+((E=g+(T^b^D)+w[9]+3654602809&4294967295)<<4&4294967295|E>>>28))+((E=D+(g^T^b)+w[12]+3873151461&4294967295)<<11&4294967295|E>>>21))+((E=b+(D^g^T)+w[15]+530742520&4294967295)<<16&4294967295|E>>>16))+((E=T+(b^D^g)+w[2]+3299628645&4294967295)<<23&4294967295|E>>>9))+((E=g+(b^(T|~D))+w[0]+4096336452&4294967295)<<6&4294967295|E>>>26))+((E=D+(T^(g|~b))+w[7]+1126891415&4294967295)<<10&4294967295|E>>>22))+((E=b+(g^(D|~T))+w[14]+2878612391&4294967295)<<15&4294967295|E>>>17))+((E=T+(D^(b|~g))+w[5]+4237533241&4294967295)<<21&4294967295|E>>>11))+((E=g+(b^(T|~D))+w[12]+1700485571&4294967295)<<6&4294967295|E>>>26))+((E=D+(T^(g|~b))+w[3]+2399980690&4294967295)<<10&4294967295|E>>>22))+((E=b+(g^(D|~T))+w[10]+4293915773&4294967295)<<15&4294967295|E>>>17))+((E=T+(D^(b|~g))+w[1]+2240044497&4294967295)<<21&4294967295|E>>>11))+((E=g+(b^(T|~D))+w[8]+1873313359&4294967295)<<6&4294967295|E>>>26))+((E=D+(T^(g|~b))+w[15]+4264355552&4294967295)<<10&4294967295|E>>>22))+((E=b+(g^(D|~T))+w[6]+2734768916&4294967295)<<15&4294967295|E>>>17))+((E=T+(D^(b|~g))+w[13]+1309151649&4294967295)<<21&4294967295|E>>>11))+((D=(g=T+((E=g+(b^(T|~D))+w[4]+4149444226&4294967295)<<6&4294967295|E>>>26))+((E=D+(T^(g|~b))+w[11]+3174756917&4294967295)<<10&4294967295|E>>>22))^((b=D+((E=b+(g^(D|~T))+w[2]+718787259&4294967295)<<15&4294967295|E>>>17))|~g))+w[9]+3951481745&4294967295,A.g[0]=A.g[0]+g&4294967295,A.g[1]=A.g[1]+(b+(E<<21&4294967295|E>>>11))&4294967295,A.g[2]=A.g[2]+b&4294967295,A.g[3]=A.g[3]+D&4294967295}function a(A,g){this.h=g;for(var T=[],w=!0,b=A.length-1;0<=b;b--){var D=0|A[b];w&&D==g||(T[b]=D,w=!1)}this.g=T}(function e(A,g){function T(){}T.prototype=g.prototype,A.D=g.prototype,A.prototype=new T,A.prototype.constructor=A,A.C=function(w,b,D){for(var E=Array(arguments.length-2),pn=2;pn<arguments.length;pn++)E[pn-2]=arguments[pn];return g.prototype[b].apply(w,E)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(A,g){void 0===g&&(g=A.length);for(var T=g-this.blockSize,w=this.B,b=this.h,D=0;D<g;){if(0==b)for(;D<=T;)i(this,A,D),D+=this.blockSize;if("string"==typeof A){for(;D<g;)if(w[b++]=A.charCodeAt(D++),b==this.blockSize){i(this,w),b=0;break}}else for(;D<g;)if(w[b++]=A[D++],b==this.blockSize){i(this,w),b=0;break}}this.h=b,this.o+=g},n.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var g=1;g<A.length-8;++g)A[g]=0;var T=8*this.o;for(g=A.length-8;g<A.length;++g)A[g]=255&T,T/=256;for(this.u(A),A=Array(16),g=T=0;4>g;++g)for(var w=0;32>w;w+=8)A[T++]=this.g[g]>>>w&255;return A};var u={};function c(A){return-128<=A&&128>A?function s(A,g){var T=u;return Object.prototype.hasOwnProperty.call(T,A)?T[A]:T[A]=g(A)}(A,function(g){return new a([0|g],0>g?-1:0)}):new a([0|A],0>A?-1:0)}function h(A){if(isNaN(A)||!isFinite(A))return p;if(0>A)return z(h(-A));for(var g=[],T=1,w=0;A>=T;w++)g[w]=A/T|0,T*=4294967296;return new a(g,0)}var p=c(0),y=c(1),x=c(16777216);function L(A){if(0!=A.h)return!1;for(var g=0;g<A.g.length;g++)if(0!=A.g[g])return!1;return!0}function G(A){return-1==A.h}function z(A){for(var g=A.g.length,T=[],w=0;w<g;w++)T[w]=~A.g[w];return new a(T,~A.h).add(y)}function X(A,g){return A.add(z(g))}function ne(A,g){for(;(65535&A[g])!=A[g];)A[g+1]+=A[g]>>>16,A[g]&=65535,g++}function te(A,g){this.g=A,this.h=g}function ae(A,g){if(L(g))throw Error("division by zero");if(L(A))return new te(p,p);if(G(A))return g=ae(z(A),g),new te(z(g.g),z(g.h));if(G(g))return g=ae(A,z(g)),new te(z(g.g),g.h);if(30<A.g.length){if(G(A)||G(g))throw Error("slowDivide_ only works with positive integers.");for(var T=y,w=g;0>=w.l(A);)T=be(T),w=be(w);var b=de(T,1),D=de(w,1);for(w=de(w,2),T=de(T,2);!L(w);){var E=D.add(w);0>=E.l(A)&&(b=b.add(T),D=E),w=de(w,1),T=de(T,1)}return g=X(A,b.j(g)),new te(b,g)}for(b=p;0<=A.l(g);){for(T=Math.max(1,Math.floor(A.m()/g.m())),w=48>=(w=Math.ceil(Math.log(T)/Math.LN2))?1:Math.pow(2,w-48),E=(D=h(T)).j(g);G(E)||0<E.l(A);)E=(D=h(T-=w)).j(g);L(D)&&(D=y),b=b.add(D),A=X(A,E)}return new te(b,A)}function be(A){for(var g=A.g.length+1,T=[],w=0;w<g;w++)T[w]=A.i(w)<<1|A.i(w-1)>>>31;return new a(T,A.h)}function de(A,g){var T=g>>5;g%=32;for(var w=A.g.length-T,b=[],D=0;D<w;D++)b[D]=0<g?A.i(D+T)>>>g|A.i(D+T+1)<<32-g:A.i(D+T);return new a(b,A.h)}(r=a.prototype).m=function(){if(G(this))return-z(this).m();for(var A=0,g=1,T=0;T<this.g.length;T++){var w=this.i(T);A+=(0<=w?w:4294967296+w)*g,g*=4294967296}return A},r.toString=function(A){if(2>(A=A||10)||36<A)throw Error("radix out of range: "+A);if(L(this))return"0";if(G(this))return"-"+z(this).toString(A);for(var g=h(Math.pow(A,6)),T=this,w="";;){var b=ae(T,g).g,D=((0<(T=X(T,b.j(g))).g.length?T.g[0]:T.h)>>>0).toString(A);if(L(T=b))return D+w;for(;6>D.length;)D="0"+D;w=D+w}},r.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h},r.l=function(A){return G(A=X(this,A))?-1:L(A)?0:1},r.abs=function(){return G(this)?z(this):this},r.add=function(A){for(var g=Math.max(this.g.length,A.g.length),T=[],w=0,b=0;b<=g;b++){var D=w+(65535&this.i(b))+(65535&A.i(b)),E=(D>>>16)+(this.i(b)>>>16)+(A.i(b)>>>16);w=E>>>16,T[b]=(E&=65535)<<16|(D&=65535)}return new a(T,-2147483648&T[T.length-1]?-1:0)},r.j=function(A){if(L(this)||L(A))return p;if(G(this))return G(A)?z(this).j(z(A)):z(z(this).j(A));if(G(A))return z(this.j(z(A)));if(0>this.l(x)&&0>A.l(x))return h(this.m()*A.m());for(var g=this.g.length+A.g.length,T=[],w=0;w<2*g;w++)T[w]=0;for(w=0;w<this.g.length;w++)for(var b=0;b<A.g.length;b++){var D=this.i(w)>>>16,E=65535&this.i(w),pn=A.i(b)>>>16,Xi=65535&A.i(b);T[2*w+2*b]+=E*Xi,ne(T,2*w+2*b),T[2*w+2*b+1]+=D*Xi,ne(T,2*w+2*b+1),T[2*w+2*b+1]+=E*pn,ne(T,2*w+2*b+1),T[2*w+2*b+2]+=D*pn,ne(T,2*w+2*b+2)}for(w=0;w<g;w++)T[w]=T[2*w+1]<<16|T[2*w];for(w=g;w<2*g;w++)T[w]=0;return new a(T,0)},r.A=function(A){return ae(this,A).h},r.and=function(A){for(var g=Math.max(this.g.length,A.g.length),T=[],w=0;w<g;w++)T[w]=this.i(w)&A.i(w);return new a(T,this.h&A.h)},r.or=function(A){for(var g=Math.max(this.g.length,A.g.length),T=[],w=0;w<g;w++)T[w]=this.i(w)|A.i(w);return new a(T,this.h|A.h)},r.xor=function(A){for(var g=Math.max(this.g.length,A.g.length),T=[],w=0;w<g;w++)T[w]=this.i(w)^A.i(w);return new a(T,this.h^A.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,q=lt.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(A,g){if(0==A.length)throw Error("number format error: empty string");if(2>(g=g||10)||36<g)throw Error("radix out of range: "+g);if("-"==A.charAt(0))return z(f(A.substring(1),g));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=h(Math.pow(g,8)),w=p,b=0;b<A.length;b+=8){var D=Math.min(8,A.length-b),E=parseInt(A.substring(b,b+D),g);8>D?(D=h(Math.pow(g,D)),w=w.j(D).add(h(E))):w=(w=w.j(T)).add(h(E))}return w},we=lt.Integer=a}).apply(typeof tt<"u"?tt:typeof self<"u"?self:typeof window<"u"?window:{});var _e,Ce,nt,Fe,fe,ge,Bt,Dt,bt,j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ee={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof j&&j];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var S=o[m];if(!(S in d))break e;d=d[S]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,S={next:function(){if(!m&&d<o.length){var M=d++;return{value:l(M,o[M]),done:!1}}return m=!0,{done:!0,value:void 0}}};return S[Symbol.iterator]=function(){return S},S}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function p(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var S=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(S,m),o.apply(l,S)}}return function(){return o.apply(l,arguments)}}function y(o,l,d){return(y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:p).apply(null,arguments)}function x(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function L(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,S,M){for(var Q=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)Q[Oe-2]=arguments[Oe];return l.prototype[S].apply(m,Q)}}function G(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function z(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const S=o.length||0,M=m.length||0;o.length=S+M;for(let Q=0;Q<M;Q++)o[S+Q]=m[Q]}else o.push(m)}}function ne(o){return/^[\s\xa0]*$/.test(o)}function te(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function ae(o){return ae[" "](o),o}ae[" "]=function(){};var be=!(-1==te().indexOf("Gecko")||-1!=te().toLowerCase().indexOf("webkit")&&-1==te().indexOf("Edge")||-1!=te().indexOf("Trident")||-1!=te().indexOf("MSIE")||-1!=te().indexOf("Edge"));function de(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function g(o){const l={};for(const d in o)l[d]=o[d];return l}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,l){let d,m;for(let S=1;S<arguments.length;S++){for(d in m=arguments[S],m)o[d]=m[d];for(let M=0;M<T.length;M++)d=T[M],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function b(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function D(o){u.setTimeout(()=>{throw o},0)}function E(){var o=rc;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var Xi=new class X{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new O_,o=>o.reset());class O_{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Zi,es=!1,rc=new class pn{constructor(){this.h=this.g=null}add(l,d){const m=Xi.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},Jd=()=>{const o=u.Promise.resolve(void 0);Zi=()=>{o.then(F_)}};var F_=()=>{for(var o;o=E();){try{o.h.call(o.g)}catch(d){D(d)}var l=Xi;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}es=!1};function Ln(){this.s=this.s,this.C=this.C}function Tt(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Ln.prototype.s=!1,Ln.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ln.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Tt.prototype.h=function(){this.defaultPrevented=!0};var L_=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function ts(o,l){if(Tt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(be){e:{try{ae(l.nodeName);var S=!0;break e}catch{}S=!1}S||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:B_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&ts.aa.h.call(this)}}L(ts,Tt);var B_={2:"touch",3:"pen",4:"mouse"};ts.prototype.h=function(){ts.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ns="closure_listenable_"+(1e6*Math.random()|0),U_=0;function q_(o,l,d,m,S){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=S,this.key=++U_,this.da=this.fa=!1}function Eo(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function To(o){this.src=o,this.g={},this.h=0}function ic(o,l){var d=l.type;if(d in o.g){var M,m=o.g[d],S=Array.prototype.indexOf.call(m,l,void 0);(M=0<=S)&&Array.prototype.splice.call(m,S,1),M&&(Eo(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function sc(o,l,d,m){for(var S=0;S<o.length;++S){var M=o[S];if(!M.da&&M.listener==l&&M.capture==!!d&&M.ha==m)return S}return-1}To.prototype.add=function(o,l,d,m,S){var M=o.toString();(o=this.g[M])||(o=this.g[M]=[],this.h++);var Q=sc(o,l,m,S);return-1<Q?(l=o[Q],d||(l.fa=!1)):((l=new q_(l,this.src,M,!!m,S)).fa=d,o.push(l)),l};var oc="closure_lm_"+(1e6*Math.random()|0),ac={};function Yd(o,l,d,m,S){if(m&&m.once)return Zd(o,l,d,m,S);if(Array.isArray(l)){for(var M=0;M<l.length;M++)Yd(o,l[M],d,m,S);return null}return d=hc(d),o&&o[ns]?o.K(l,d,h(m)?!!m.capture:!!m,S):Xd(o,l,d,!1,m,S)}function Xd(o,l,d,m,S,M){if(!l)throw Error("Invalid event type");var Q=h(S)?!!S.capture:!!S,Oe=cc(o);if(Oe||(o[oc]=Oe=new To(o)),(d=Oe.add(l,d,m,Q,M)).proxy)return d;if(m=function z_(){const l=j_;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)L_||(S=Q),void 0===S&&(S=!1),o.addEventListener(l.toString(),m,S);else if(o.attachEvent)o.attachEvent(tf(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function Zd(o,l,d,m,S){if(Array.isArray(l)){for(var M=0;M<l.length;M++)Zd(o,l[M],d,m,S);return null}return d=hc(d),o&&o[ns]?o.L(l,d,h(m)?!!m.capture:!!m,S):Xd(o,l,d,!0,m,S)}function ef(o,l,d,m,S){if(Array.isArray(l))for(var M=0;M<l.length;M++)ef(o,l[M],d,m,S);else m=h(m)?!!m.capture:!!m,d=hc(d),o&&o[ns]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=sc(M=o.g[l],d,m,S))&&(Eo(M[d]),Array.prototype.splice.call(M,d,1),0==M.length&&(delete o.g[l],o.h--))):o&&(o=cc(o))&&(l=o.g[l.toString()],o=-1,l&&(o=sc(l,d,m,S)),(d=-1<o?l[o]:null)&&uc(d))}function uc(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[ns])ic(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(tf(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=cc(l))?(ic(d,o),0==d.h&&(d.src=null,l[oc]=null)):Eo(o)}}}function tf(o){return o in ac?ac[o]:ac[o]="on"+o}function j_(o,l){if(o.da)o=!0;else{l=new ts(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&uc(o),o=d.call(m,l)}return o}function cc(o){return(o=o[oc])instanceof To?o:null}var lc="__closure_events_fn_"+(1e9*Math.random()>>>0);function hc(o){return"function"==typeof o?o:(o[lc]||(o[lc]=function(l){return o.handleEvent(l)}),o[lc])}function vt(){Ln.call(this),this.i=new To(this),this.M=this,this.F=null}function Vt(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new Tt(l,o);else if(l instanceof Tt)l.target=l.target||o;else{var S=l;w(l=new Tt(m,o),S)}if(S=!0,d)for(var M=d.length-1;0<=M;M--){var Q=l.g=d[M];S=vo(Q,m,!0,l)&&S}if(S=vo(Q=l.g=o,m,!0,l)&&S,S=vo(Q,m,!1,l)&&S,d)for(M=0;M<d.length;M++)S=vo(Q=l.g=d[M],m,!1,l)&&S}function vo(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var S=!0,M=0;M<l.length;++M){var Q=l[M];if(Q&&!Q.da&&Q.capture==d){var Oe=Q.listener,gt=Q.ha||Q.src;Q.fa&&ic(o.i,Q),S=!1!==Oe.call(gt,m)&&S}}return S&&!m.defaultPrevented}function nf(o,l,d){if("function"==typeof o)d&&(o=y(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=y(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function rf(o){o.g=nf(()=>{o.g=null,o.i&&(o.i=!1,rf(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}L(vt,Ln),vt.prototype[ns]=!0,vt.prototype.removeEventListener=function(o,l,d,m){ef(this,o,l,d,m)},vt.prototype.N=function(){if(vt.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)Eo(d[m]);delete o.g[l],o.h--}}this.F=null},vt.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},vt.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class G_ extends Ln{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:rf(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rs(o){Ln.call(this),this.h=o,this.g={}}L(rs,Ln);var sf=[];function of(o){de(o.g,function(l,d){this.g.hasOwnProperty(d)&&uc(l)},o),o.g={}}rs.prototype.N=function(){rs.aa.N.call(this),of(this)},rs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dc=u.JSON.stringify,K_=u.JSON.parse,$_=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function fc(){}function uf(){}fc.prototype.h=null;var is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function mc(){Tt.call(this,"d")}function pc(){Tt.call(this,"c")}L(mc,Tt),L(pc,Tt);var dr={},cf=null;function Ao(){return cf=cf||new vt}function lf(o){Tt.call(this,dr.La,o)}function ss(o){const l=Ao();Vt(l,new lf(l))}function hf(o,l){Tt.call(this,dr.STAT_EVENT,o),this.stat=l}function xt(o){const l=Ao();Vt(l,new hf(l,o))}function df(o,l){Tt.call(this,dr.Ma,o),this.size=l}function os(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function as(){this.g=!0}function ri(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function J_(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var S=m[1];if(Array.isArray(S)&&!(1>S.length)){var M=S[0];if("noop"!=M&&"stop"!=M&&"close"!=M)for(var Q=1;Q<S.length;Q++)S[Q]=""}}}return dc(d)}catch{return l}}(o,d)+(m?" "+m:"")})}dr.La="serverreachability",L(lf,Tt),dr.STAT_EVENT="statevent",L(hf,Tt),dr.Ma="timingevent",L(df,Tt),as.prototype.xa=function(){this.g=!1},as.prototype.info=function(){};var gc,wo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ff={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function bo(){}function Bn(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new rs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new mf}function mf(){this.i=null,this.g="",this.h=!1}L(bo,fc),bo.prototype.g=function(){return new XMLHttpRequest},bo.prototype.i=function(){return{}},gc=new bo;var pf={},_c={};function yc(o,l,d){o.L=1,o.v=Vo(gn(l)),o.m=d,o.P=!0,gf(o,null)}function gf(o,l){o.F=Date.now(),Ro(o),o.A=gn(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),xf(d.i,"t",m),o.C=0,d=o.j.J,o.h=new mf,o.g=Wf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new G_(y(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var S="readystatechange";Array.isArray(S)||(S&&(sf[0]=S.toString()),S=sf);for(var M=0;M<S.length;M++){var Q=Yd(d,S[M],m||l.handleEvent,!1,l.h||l);if(!Q)break;l.g[Q.key]=Q}l=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),ss(),function Q_(o,l,d,m,S,M){o.info(function(){if(o.g)if(M)for(var Q="",Oe=M.split("&"),gt=0;gt<Oe.length;gt++){var Re=Oe[gt].split("=");if(1<Re.length){var At=Re[0];Re=Re[1];var wt=At.split("_");Q=2<=wt.length&&"type"==wt[1]?Q+(At+"=")+Re+"&":Q+(At+"=redacted&")}}else Q=null;else Q=M;return"XMLHTTP REQ ("+m+") [attempt "+S+"]: "+l+"\n"+d+"\n"+Q})}(o.i,o.u,o.A,o.l,o.R,o.m)}function _f(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function Y_(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?_c:(d=Number(l.substring(d,m)),isNaN(d)?pf:(m+=1)+d>l.length?_c:(l=l.slice(m,m+d),o.C=m+d,l))}function Ro(o){o.S=Date.now()+o.I,yf(o,o.I)}function yf(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=os(y(o.ba,o),l)}function Ic(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function us(o){0==o.j.G||o.J||Gf(o.j,o)}function fr(o){Ic(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,of(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Ec(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Tc(d.h,o)))if(!o.K&&Tc(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var S=m;if(0==S[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;ko(d),Do(d)}bc(d),xt(18)}}else d.za=S[1],0<d.za-d.T&&37500>S[2]&&d.F&&0==d.v&&!d.C&&(d.C=os(y(d.Za,d),6e3));if(1>=Tf(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else pr(d,11)}else if((o.K||d.g==o)&&ko(d),!ne(l))for(S=d.Da.g.parse(l),l=0;l<S.length;l++){let Re=S[l];if(d.T=Re[0],Re=Re[1],2==d.G)if("c"==Re[0]){d.K=Re[1],d.ia=Re[2];const At=Re[3];null!=At&&(d.la=At,d.j.info("VER="+d.la));const wt=Re[4];null!=wt&&(d.Aa=wt,d.j.info("SVER="+d.Aa));const oi=Re[5];null!=oi&&"number"==typeof oi&&0<oi&&(d.L=m=1.5*oi,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Wt=o.g;if(Wt){const Oo=Wt.g?Wt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Oo){var M=m.h;M.g||-1==Oo.indexOf("spdy")&&-1==Oo.indexOf("quic")&&-1==Oo.indexOf("h2")||(M.j=M.l,M.g=new Set,M.h&&(vc(M,M.h),M.h=null))}if(m.D){const Pc=Wt.g?Wt.g.getResponseHeader("X-HTTP-Session-Id"):null;Pc&&(m.ya=Pc,je(m.I,m.D,Pc))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var Q=o;if((m=d).qa=Qf(m,m.J?m.ia:null,m.W),Q.K){vf(m.h,Q);var Oe=Q,gt=m.L;gt&&(Oe.I=gt),Oe.B&&(Ic(Oe),Ro(Oe)),m.g=Q}else zf(m);0<d.i.length&&No(d)}else"stop"!=Re[0]&&"close"!=Re[0]||pr(d,7);else 3==d.G&&("stop"==Re[0]||"close"==Re[0]?"stop"==Re[0]?pr(d,7):wc(d):"noop"!=Re[0]&&d.l&&d.l.ta(Re),d.v=0)}ss()}catch{}}Bn.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==_n(o)?l.j():this.Y(o)},Bn.prototype.Y=function(o){try{if(o==this.g)e:{const wt=_n(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>wt)&&(3!=wt||this.g&&(this.h.h||this.g.oa()||Ff(this.g)))){this.J||4!=wt||7==l||ss(),Ic(this);var d=this.g.Z();this.X=d;t:if(_f(this)){var m=Ff(this.g);o="";var S=m.length,M=4==_n(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){fr(this),us(this);var Q="";break t}this.h.i=new u.TextDecoder}for(l=0;l<S;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(M&&l==S-1)});m.length=0,this.h.g+=o,this.C=0,Q=this.h.g}else Q=this.g.oa();if(this.o=200==d,function W_(o,l,d,m,S,M,Q){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+S+"]: "+l+"\n"+d+"\n"+M+" "+Q})}(this.i,this.u,this.A,this.l,this.R,wt,d),this.o){if(this.T&&!this.K){t:{if(this.g){var Oe,gt=this.g;if((Oe=gt.g?gt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ne(Oe)){var Re=Oe;break t}}Re=null}if(!(d=Re)){this.o=!1,this.s=3,xt(12),fr(this),us(this);break e}ri(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ec(this,d)}if(this.P){let Wt;for(d=!0;!this.J&&this.C<Q.length;){if(Wt=Y_(this,Q),Wt==_c){4==wt&&(this.s=4,xt(14),d=!1),ri(this.i,this.l,null,"[Incomplete Response]");break}if(Wt==pf){this.s=4,xt(15),ri(this.i,this.l,Q,"[Invalid Chunk]"),d=!1;break}ri(this.i,this.l,Wt,null),Ec(this,Wt)}if(_f(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=wt||0!=Q.length||this.h.h||(this.s=1,xt(16),d=!1),this.o=this.o&&d,d){if(0<Q.length&&!this.W){this.W=!0;var At=this.j;At.g==this&&At.ba&&!At.M&&(At.j.info("Great, no buffering proxy detected. Bytes received: "+Q.length),Rc(At),At.M=!0,xt(11))}}else ri(this.i,this.l,Q,"[Invalid Chunked Response]"),fr(this),us(this)}else ri(this.i,this.l,Q,null),Ec(this,Q);4==wt&&fr(this),this.o&&!this.J&&(4==wt?Gf(this.j,this):(this.o=!1,Ro(this)))}else(function my(o){const l={};o=(o.g&&2<=_n(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(ne(o[m]))continue;var d=b(o[m]);const S=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const M=l[S]||[];l[S]=M,M.push(d)}!function A(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<Q.indexOf("Unknown SID")?(this.s=3,xt(12)):(this.s=0,xt(13)),fr(this),us(this)}}}catch{}},Bn.prototype.cancel=function(){this.J=!0,fr(this)},Bn.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function H_(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(ss(),xt(17)),fr(this),this.s=2,us(this)):yf(this,this.S-o)};var X_=class{constructor(o,l){this.g=o,this.map=l}};function If(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ef(o){return!!o.h||!!o.g&&o.g.size>=o.j}function Tf(o){return o.h?1:o.g?o.g.size:0}function Tc(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function vc(o,l){o.g?o.g.add(l):o.h=l}function vf(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function Af(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return G(o.i)}function wf(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function ey(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function Z_(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),S=m.length,M=0;M<S;M++)l.call(void 0,m[M],d&&d[M],o)}If.prototype.cancel=function(){if(this.i=Af(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var bf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mr(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof mr){this.h=o.h,Po(this,o.j),this.o=o.o,this.g=o.g,So(this,o.s),this.l=o.l;var l=o.i,d=new hs;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Rf(this,d),this.m=o.m}else o&&(l=String(o).match(bf))?(this.h=!1,Po(this,l[1]||"",!0),this.o=cs(l[2]||""),this.g=cs(l[3]||"",!0),So(this,l[4]),this.l=cs(l[5]||"",!0),Rf(this,l[6]||"",!0),this.m=cs(l[7]||"")):(this.h=!1,this.i=new hs(null,this.h))}function gn(o){return new mr(o)}function Po(o,l,d){o.j=d?cs(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function So(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Rf(o,l,d){l instanceof hs?(o.i=l,function ay(o,l){l&&!o.j&&(Un(o),o.i=null,o.g.forEach(function(d,m){var S=m.toLowerCase();m!=S&&(Sf(this,m),xf(this,S,d))},o)),o.j=l}(o.i,o.h)):(d||(l=ls(l,sy)),o.i=new hs(l,o.h))}function je(o,l,d){o.i.set(l,d)}function Vo(o){return je(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function cs(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ls(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,ny),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function ny(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}mr.prototype.toString=function(){var o=[],l=this.j;l&&o.push(ls(l,Pf,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(ls(l,Pf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(ls(d,"/"==d.charAt(0)?iy:ry,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",ls(d,oy)),o.join("")};var Pf=/[#\/\?@]/g,ry=/[#\?:]/g,iy=/[#\?]/g,sy=/[#\?@]/g,oy=/#/g;function hs(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Un(o){o.g||(o.g=new Map,o.h=0,o.i&&function ty(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),S=null;if(0<=m){var M=o[d].substring(0,m);S=o[d].substring(m+1)}else M=o[d];l(M,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function Sf(o,l){Un(o),l=ii(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Vf(o,l){return Un(o),l=ii(o,l),o.g.has(l)}function xf(o,l,d){Sf(o,l),0<d.length&&(o.i=null,o.g.set(ii(o,l),G(d)),o.h+=d.length)}function ii(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function qn(o,l,d,m,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),m(d)}catch{}}function ly(){this.g=new $_}function hy(o,l,d){const m=d||"";try{wf(o,function(S,M){let Q=S;h(S)&&(Q=dc(S)),l.push(m+M+"="+encodeURIComponent(Q))})}catch(S){throw l.push(m+"type="+encodeURIComponent("_badmap")),S}}function ds(o){this.l=o.Ub||null,this.j=o.eb||!1}function xo(o,l){vt.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Cf(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function fs(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ms(o)}function ms(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Df(o){let l="";return de(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function Ac(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Df(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):je(o,l,d))}function Ye(o){vt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=hs.prototype).add=function(o,l){Un(this),this.i=null,o=ii(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){Un(this),this.g.forEach(function(d,m){d.forEach(function(S){o.call(l,S,m,this)},this)},this)},r.na=function(){Un(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const S=o[m];for(let M=0;M<S.length;M++)d.push(l[m])}return d},r.V=function(o){Un(this);let l=[];if("string"==typeof o)Vf(this,o)&&(l=l.concat(this.g.get(ii(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Un(this),this.i=null,Vf(this,o=ii(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const M=encodeURIComponent(String(m)),Q=this.V(m);for(m=0;m<Q.length;m++){var S=M;""!==Q[m]&&(S+="="+encodeURIComponent(String(Q[m]))),o.push(S)}}return this.i=o.join("&")},L(ds,fc),ds.prototype.g=function(){return new xo(this.l,this.j)},ds.prototype.i=function(o){return function(){return o}}({}),L(xo,vt),(r=xo.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,ms(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,fs(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ms(this)),this.g&&(this.readyState=3,ms(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Cf(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?fs(this):ms(this),3==this.readyState&&Cf(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,fs(this))},r.Qa=function(o){this.g&&(this.response=o,fs(this))},r.ga=function(){this.g&&fs(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(xo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),L(Ye,vt);var dy=/^https?$/i,fy=["POST","PUT"];function Nf(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,kf(o),Co(o)}function kf(o){o.A||(o.A=!0,Vt(o,"complete"),Vt(o,"error"))}function Mf(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=_n(o)||2!=o.Z()))if(o.u&&4==_n(o))nf(o.Ea,0,o);else if(Vt(o,"readystatechange"),4==_n(o)){o.h=!1;try{const Q=o.Z();e:switch(Q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===Q){var S=String(o.D).match(bf)[1]||null;!S&&u.self&&u.self.location&&(S=u.self.location.protocol.slice(0,-1)),m=!dy.test(S?S.toLowerCase():"")}d=m}if(d)Vt(o,"complete"),Vt(o,"success");else{o.m=6;try{var M=2<_n(o)?o.g.statusText:""}catch{M=""}o.l=M+" ["+o.Z()+"]",kf(o)}}finally{Co(o)}}}function Co(o,l){if(o.g){Of(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Vt(o,"ready");try{d.onreadystatechange=m}catch{}}}function Of(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function _n(o){return o.g?o.g.readyState:0}function Ff(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ps(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Lf(o){this.Aa=0,this.i=[],this.j=new as,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ps("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ps("baseRetryDelayMs",5e3,o),this.cb=ps("retryDelaySeedMs",1e4,o),this.Wa=ps("forwardChannelMaxRetries",2,o),this.wa=ps("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new If(o&&o.concurrentRequestLimit),this.Da=new ly,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function wc(o){if(Bf(o),3==o.G){var l=o.U++,d=gn(o.I);if(je(d,"SID",o.K),je(d,"RID",l),je(d,"TYPE","terminate"),gs(o,d),(l=new Bn(o,o.j,l)).L=2,l.v=Vo(gn(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Wf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ro(l)}$f(o)}function Do(o){o.g&&(Rc(o),o.g.cancel(),o.g=null)}function Bf(o){Do(o),o.u&&(u.clearTimeout(o.u),o.u=null),ko(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function No(o){if(!Ef(o.h)&&!o.s){o.s=!0;var l=o.Ga;Zi||Jd(),es||(Zi(),es=!0),rc.add(l,o),o.B=0}}function Uf(o,l){var d;d=l?l.l:o.U++;const m=gn(o.I);je(m,"SID",o.K),je(m,"RID",d),je(m,"AID",o.T),gs(o,m),o.m&&o.o&&Ac(m,o.m,o.o),d=new Bn(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=qf(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),vc(o.h,d),yc(d,m,l)}function gs(o,l){o.H&&de(o.H,function(d,m){je(l,m,d)}),o.l&&wf({},function(d,m){je(l,m,d)})}function qf(o,l,d){d=Math.min(o.i.length,d);var m=o.l?y(o.l.Na,o.l,o):null;e:{var S=o.i;let M=-1;for(;;){const Q=["count="+d];-1==M?0<d?(M=S[0].g,Q.push("ofs="+M)):M=0:Q.push("ofs="+M);let Oe=!0;for(let gt=0;gt<d;gt++){let Re=S[gt].g;const At=S[gt].map;if(Re-=M,0>Re)M=Math.max(0,S[gt].g-100),Oe=!1;else try{hy(At,Q,"req"+Re+"_")}catch{m&&m(At)}}if(Oe){m=Q.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function zf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Zi||Jd(),es||(Zi(),es=!0),rc.add(l,o),o.v=0}}function bc(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=os(y(o.Fa,o),Kf(o,o.v)),o.v++,0))}function Rc(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function jf(o){o.g=new Bn(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=gn(o.qa);je(l,"RID","rpc"),je(l,"SID",o.K),je(l,"AID",o.T),je(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&je(l,"TO",o.ja),je(l,"TYPE","xmlhttp"),gs(o,l),o.m&&o.o&&Ac(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Vo(gn(l)),d.m=null,d.P=!0,gf(d,o)}function ko(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Gf(o,l){var d=null;if(o.g==l){ko(o),Rc(o),o.g=null;var m=2}else{if(!Tc(o.h,l))return;d=l.D,vf(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var S=o.B;Vt(m=Ao(),new df(m,d)),No(o)}else zf(o);else if(3==(S=l.s)||0==S&&0<l.X||!(1==m&&function py(o,l){return!(Tf(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=os(y(o.Ga,o,l),Kf(o,o.B)),o.B++,0)))}(o,l)||2==m&&bc(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),S){case 1:pr(o,5);break;case 4:pr(o,10);break;case 3:pr(o,6);break;default:pr(o,2)}}function Kf(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function pr(o,l){if(o.j.info("Error code "+l),2==l){var d=y(o.fb,o),m=o.Xa;const S=!m;m=new mr(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Po(m,"https"),Vo(m),S?function uy(o,l){const d=new as;if(u.Image){const m=new Image;m.onload=x(qn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=x(qn,d,"TestLoadImage: error",!1,l,m),m.onabort=x(qn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=x(qn,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function cy(o,l){new as;const m=new AbortController,S=setTimeout(()=>{m.abort(),qn(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(M=>{clearTimeout(S),qn(0,0,!!M.ok,l)}).catch(()=>{clearTimeout(S),qn(0,0,!1,l)})}(m.toString(),d)}else xt(2);o.G=0,o.l&&o.l.sa(l),$f(o),Bf(o)}function $f(o){if(o.G=0,o.ka=[],o.l){const l=Af(o.h);(0!=l.length||0!=o.i.length)&&(z(o.ka,l),z(o.ka,o.i),o.h.i.length=0,G(o.i),o.i.length=0),o.l.ra()}}function Qf(o,l,d){var m=d instanceof mr?gn(d):new mr(d);if(""!=m.g)l&&(m.g=l+"."+m.g),So(m,m.s);else{var S=u.location;m=S.protocol,l=l?l+"."+S.hostname:S.hostname,S=+S.port;var M=new mr(null);m&&Po(M,m),l&&(M.g=l),S&&So(M,S),d&&(M.l=d),m=M}return l=o.ya,(d=o.D)&&l&&je(m,d,l),je(m,"VER",o.la),gs(o,m),m}function Wf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new Ye(o.Ca&&!o.pa?new ds({eb:d}):o.pa)).Ha(o.J),l}function Hf(){}function Mo(){}function qt(o,l){vt.call(this),this.g=new Lf(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!ne(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!ne(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new si(this)}function Jf(o){mc.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Yf(){pc.call(this),this.status=1}function si(o){this.g=o}(r=Ye.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gc.g(),this.v=function af(o){return o.h||(o.h=o.i())}(this.o?this.o:gc),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(M){return void Nf(this,M)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var S in m)d.set(S,m[S]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const M of m.keys())d.set(M,m.get(M))}m=Array.from(d.keys()).find(M=>"content-type"==M.toLowerCase()),S=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(fy,l,void 0))||m||S||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[M,Q]of d)this.g.setRequestHeader(M,Q);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Of(this),this.u=!0,this.g.send(o),this.u=!1}catch(M){Nf(this,M)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Vt(this,"complete"),Vt(this,"abort"),Co(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Co(this,!0)),Ye.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Mf(this):this.bb())},r.bb=function(){Mf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<_n(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),K_(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Lf.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){xt(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Qf(this,null,this.W),No(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const S=new Bn(this,this.j,o);let M=this.o;if(this.S&&(M?(M=g(M),w(M,this.S)):M=this.S),null!==this.m||this.O||(S.H=M,M=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=qf(this,S,l),je(d=gn(this.I),"RID",o),je(d,"CVER",22),this.D&&je(d,"X-HTTP-Session-Id",this.D),gs(this,d),M&&(this.O?l="headers="+encodeURIComponent(String(Df(M)))+"&"+l:this.m&&Ac(d,this.m,M)),vc(this.h,S),this.Ua&&je(d,"TYPE","init"),this.P?(je(d,"$req",l),je(d,"SID","null"),S.T=!0,yc(S,d,null)):yc(S,d,l),this.G=2}}else 3==this.G&&(o?Uf(this,o):0==this.i.length||Ef(this.h)||Uf(this))},r.Fa=function(){if(this.u=null,jf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=os(y(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xt(10),Do(this),jf(this))},r.Za=function(){null!=this.C&&(this.C=null,Do(this),bc(this),xt(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),xt(2)):(this.j.info("Failed to ping google.com"),xt(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Hf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Mo.prototype.g=function(o,l){return new qt(o,l)},L(qt,vt),qt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},qt.prototype.close=function(){wc(this.g)},qt.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=dc(o),o=d);l.i.push(new X_(l.Ya++,o)),3==l.G&&No(l)},qt.prototype.N=function(){this.g.l=null,delete this.j,wc(this.g),delete this.g,qt.aa.N.call(this)},L(Jf,mc),L(Yf,pc),L(si,Hf),si.prototype.ua=function(){Vt(this.g,"a")},si.prototype.ta=function(o){Vt(this.g,new Jf(o))},si.prototype.sa=function(o){Vt(this.g,new Yf)},si.prototype.ra=function(){Vt(this.g,"b")},Mo.prototype.createWebChannel=Mo.prototype.g,qt.prototype.send=qt.prototype.o,qt.prototype.open=qt.prototype.m,qt.prototype.close=qt.prototype.close,bt=ee.createWebChannelTransport=function(){return new Mo},Dt=ee.getStatEventTarget=function(){return Ao()},Bt=ee.Event=dr,ge=ee.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},wo.NO_ERROR=0,wo.TIMEOUT=8,wo.HTTP_ERROR=6,fe=ee.ErrorCode=wo,ff.COMPLETE="complete",Fe=ee.EventType=ff,uf.EventType=is,is.OPEN="a",is.CLOSE="b",is.ERROR="c",is.MESSAGE="d",vt.prototype.listen=vt.prototype.K,nt=ee.WebChannel=uf,Ce=ee.FetchXmlHttpFactory=ds,Ye.prototype.listenOnce=Ye.prototype.L,Ye.prototype.getLastError=Ye.prototype.Ka,Ye.prototype.getLastErrorCode=Ye.prototype.Ba,Ye.prototype.getStatus=Ye.prototype.Z,Ye.prototype.getResponseJson=Ye.prototype.Oa,Ye.prototype.getResponseText=Ye.prototype.oa,Ye.prototype.send=Ye.prototype.ea,Ye.prototype.setWithCredentials=Ye.prototype.Ha,_e=ee.XhrIo=Ye}).apply(typeof j<"u"?j:typeof self<"u"?self:typeof window<"u"?window:{});const Ht="@firebase/firestore";class Ue{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ue.UNAUTHENTICATED=new Ue(null),Ue.GOOGLE_CREDENTIALS=new Ue("google-credentials-uid"),Ue.FIRST_PARTY=new Ue("first-party-uid"),Ue.MOCK_USER=new Ue("mock-user");let jt="10.12.3";const ye=new Ge.Vy("@firebase/firestore");function rt(){return ye.logLevel}function F(r,...e){if(ye.logLevel<=Ge.$b.DEBUG){const t=e.map(Jt);ye.debug(`Firestore (${jt}): ${r}`,...t)}}function Pe(r,...e){if(ye.logLevel<=Ge.$b.ERROR){const t=e.map(Jt);ye.error(`Firestore (${jt}): ${r}`,...t)}}function it(r,...e){if(ye.logLevel<=Ge.$b.WARN){const t=e.map(Jt);ye.warn(`Firestore (${jt}): ${r}`,...t)}}function Jt(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function W(r="Unexpected state"){const e=`FIRESTORE (${jt}) INTERNAL ASSERTION FAILED: `+r;throw Pe(e),new Error(e)}function J(r,e){r||W()}function K(r,e){return r}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends ie.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class He{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ai{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ui{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ue.UNAUTHENTICATED))}shutdown(){}}class yn{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class _r{constructor(e){this.t=e,this.currentUser=Ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new He;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new He,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,V.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new He)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(J("string"==typeof n.accessToken),new ai(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return J(null===e||"string"==typeof e),new Ue(e)}}class ci{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ue.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class li{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ci(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class zn{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ys{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,F("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(J("string"==typeof t.token),this.R=t.token,new zn(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Is(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class hi{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Is(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function re(r,e){return r<e?-1:r>e?1:0}function sn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function yr(r){return r+"\0"}class Me{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new U(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Me.fromMillis(Date.now())}static fromDate(e){return Me.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Me(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?re(this.nanoseconds,e.nanoseconds):re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Z{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Z(e)}static min(){return new Z(new Me(0,0))}static max(){return new Z(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class In{constructor(e,t,n){void 0===t?t=0:t>e.length&&W(),void 0===n?n=e.length-t:n>e.length-t&&W(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===In.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof In?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class he extends In{construct(e,t,n){return new he(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new U(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new he(t)}static emptyPath(){return new he([])}}const Ir=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class De extends In{construct(e,t,n){return new De(e,t,n)}static isValidIdentifier(e){return Ir.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),De.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new De(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new U(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new U(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new U(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new U(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new De(t)}static emptyPath(){return new De([])}}class ${constructor(e){this.path=e}static fromPath(e){return new $(he.fromString(e))}static fromName(e){return new $(he.fromString(e).popFirst(5))}static empty(){return new $(he.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===he.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return he.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $(new he(e.slice()))}}class Nt{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Gn(r){return r.fields.find(e=>2===e.kind)}function ht(r){return r.fields.filter(e=>2!==e.kind)}Nt.UNKNOWN_ID=-1;class _t{constructor(e,t){this.fieldPath=e,this.kind=t}}class Xt{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Xt(0,st.min())}}function Gt(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=Z.fromTimestamp(1e9===n?new Me(t+1,0):new Me(t,n));return new st(i,$.empty(),e)}function Tr(r){return new st(r.readTime,r.key,-1)}class st{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new st(Z.min(),$.empty(),-1)}static max(){return new st(Z.max(),$.empty(),-1)}}function Kn(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=$.comparator(r.documentKey,e.documentKey),0!==t?t:re(r.largestBatchId,e.largestBatchId))}const di="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Kt(r){return dt.apply(this,arguments)}function dt(){return(dt=(0,V.A)(function*(r){if(r.code!==N.FAILED_PRECONDITION||r.message!==di)throw r;F("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,n)=>{t(e)})}static reject(e){return new P((t,n)=>{n(e)})}static waitFor(e){return new P((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next(i=>i?P.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new P((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new P((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class En{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new He,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Tn(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=_(n.target.error);this.V.reject(new Tn(e,i))}}static open(e,t,n,i){try{return new En(t,e.transaction(i,n))}catch(s){throw new Tn(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(F("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new vr(t)}}class kt{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===kt.S((0,ie.ZQ)())&&Pe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return F("SimpleDb","Removing database:",e),Ut(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ie.zW)())return!1;if(kt.C())return!0;const e=(0,ie.ZQ)(),t=kt.S(e),n=0<t&&t<10,i=$n(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,V.A)(function*(){return t.db||(F("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new Tn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new U(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new U(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new Tn(e,u))},s.onupgradeneeded=a=>{F("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{F("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,V.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=En.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),P.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(F("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function $n(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class mi{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Ut(this.B.delete())}}class Tn extends U{constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function $t(r){return"IndexedDbTransactionError"===r.name}class vr{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(F("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(F("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ut(n)}add(e){return F("SimpleDb","ADD",this.store.name,e,e),Ut(this.store.add(e))}get(e){return Ut(this.store.get(e)).next(t=>(void 0===t&&(t=null),F("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return F("SimpleDb","DELETE",this.store.name,e),Ut(this.store.delete(e))}count(){return F("SimpleDb","COUNT",this.store.name),Ut(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new P((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new P((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){F("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new P((n,i)=>{t.onerror=s=>{const a=_(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new P((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new mi(u),h=t(u.primaryKey,u.value,c);if(h instanceof P){const f=h.catch(p=>(c.done(),P.reject(p)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>P.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ut(r){return new P((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=_(n.target.error);t(i)}})}let I=!1;function _(r){const e=kt.S((0,ie.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new U("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return I||(I=!0,setTimeout(()=>{throw n},0)),n}}return r}class v{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;F("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,V.A)(function*(){t.task=null;try{F("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){$t(n)?F("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Kt(n)}yield t.X(6e4)}))}}class B{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,V.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return P.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return F("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(F("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=Tr(s);Kn(a,n)>0&&(n=a)}),new st(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let C=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Y(r){return null==r}function se(r){return 0===r&&1/r==-1/0}function Le(r){return"number"==typeof r&&Number.isInteger(r)&&!se(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ve(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Mt(e)),e=ot(r.get(t),e);return Mt(e)}function ot(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Mt(r){return r+"\x01\x01"}function ce(r){const e=r.length;if(J(e>=2),2===e)return J("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),he.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&W(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:W()}s=a+2}return new he(n)}const Rt=["userId","batchId"];function Qt(r,e){return[r,Ve(e)]}function Ar(r,e,t){return[r,Ve(e),t]}const Fo={},Es=["prefixPath","collectionGroup","readTime","documentId"],Lo=["prefixPath","collectionGroup","documentId"],Bo=["collectionGroup","readTime","prefixPath","documentId"],Ts=["canonicalId","targetId"],Uo=["targetId","path"],k=["path","targetId"],R=["collectionId","parent"],O=["indexId","uid"],H=["uid","sequenceNumber"],oe=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ue=["indexId","uid","orderedDocumentKey"],me=["userId","collectionPath","documentId"],Ke=["userId","collectionPath","largestBatchId"],$e=["userId","collectionGroup","largestBatchId"],Ot=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Qn=[...Ot,"documentOverlays"],vs=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Sc=vs,Vc=[...Sc,"indexConfiguration","indexState","indexEntries"],Xf=Vc;class qo extends fi{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ut(r,e){const t=K(r);return kt.F(t._e,e)}function xc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Dc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Be{constructor(e,t){this.comparator=e,this.root=t||ft.EMPTY}insert(e,t){return new Be(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(e){return new Be(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ft.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new As(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new As(this.root,e,this.comparator,!1)}getReverseIterator(){return new As(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new As(this.root,e,this.comparator,!0)}}class As{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ft{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??ft.RED,this.left=i??ft.EMPTY,this.right=s??ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new ft(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ft.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw W();const e=this.left.check();if(e!==this.right.check())throw W();return e+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1,ft.EMPTY=new class{constructor(){this.size=0}get key(){throw W()}get value(){throw W()}get color(){throw W()}get left(){throw W()}get right(){throw W()}copy(e,t,n,i,s){return this}insert(e,t,n){return new ft(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ne{constructor(e){this.comparator=e,this.data=new Be(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nc(this.data.getIterator())}getIteratorFrom(e){return new Nc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ne(this.comparator);return t.data=e,t}}class Nc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function wr(r){return r.hasNext()?r.getNext():void 0}class Ft{constructor(e){this.fields=e,e.sort(De.comparator)}static empty(){return new Ft([])}unionWith(e){let t=new Ne(De.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ft(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class kc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class at{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new kc("Invalid base64 string: "+s):s}}(e);return new at(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new at(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}at.EMPTY_BYTE_STRING=new at("");const em=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function on(r){if(J(!!r),"string"==typeof r){let e=0;const t=em.exec(r);if(J(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Je(r.seconds),nanos:Je(r.nanos)}}function Je(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function an(r){return"string"==typeof r?at.fromBase64String(r):at.fromUint8Array(r)}function ws(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function bs(r){const e=r.mapValue.fields.__previous_value__;return ws(e)?bs(e):e}function pi(r){const e=on(r.mapValue.fields.__local_write_time__.timestampValue);return new Me(e.seconds,e.nanos)}class tm{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class An{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new An("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof An&&e.projectId===this.projectId&&e.database===this.database}}const wn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Rs={nullValue:"NULL_VALUE"};function bn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ws(r)?4:Lc(r)?9007199254740991:10:W()}function Zt(r,e){if(r===e)return!0;const t=bn(r);if(t!==bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return pi(r).isEqual(pi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=on(i.timestampValue),u=on(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,an(r.bytesValue).isEqual(an(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Je(i.geoPointValue.latitude)===Je(s.geoPointValue.latitude)&&Je(i.geoPointValue.longitude)===Je(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Je(i.integerValue)===Je(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Je(i.doubleValue),u=Je(s.doubleValue);return a===u?se(a)===se(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return sn(r.arrayValue.values||[],e.arrayValue.values||[],Zt);case 10:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(xc(a)!==xc(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!Zt(a[c],u[c])))return!1;return!0}(r,e);default:return W()}var s}function gi(r,e){return void 0!==(r.values||[]).find(t=>Zt(t,e))}function Rn(r,e){if(r===e)return 0;const t=bn(r),n=bn(e);if(t!==n)return re(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return re(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=Je(s.integerValue||s.doubleValue),c=Je(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return Mc(r.timestampValue,e.timestampValue);case 4:return Mc(pi(r),pi(e));case 5:return re(r.stringValue,e.stringValue);case 6:return function(s,a){const u=an(s),c=an(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=re(u[h],c[h]);if(0!==f)return f}return re(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=re(Je(s.latitude),Je(a.latitude));return 0!==u?u:re(Je(s.longitude),Je(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,a){const u=s.values||[],c=a.values||[];for(let h=0;h<u.length&&h<c.length;++h){const f=Rn(u[h],c[h]);if(f)return f}return re(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===wn.mapValue&&a===wn.mapValue)return 0;if(s===wn.mapValue)return 1;if(a===wn.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const y=re(c[p],f[p]);if(0!==y)return y;const x=Rn(u[c[p]],h[f[p]]);if(0!==x)return x}return re(c.length,f.length)}(r.mapValue,e.mapValue);default:throw W()}}function Mc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return re(r,e);const t=on(r),n=on(e),i=re(t.seconds,n.seconds);return 0!==i?i:re(t.nanos,n.nanos)}function br(r){return zo(r)}function zo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=on(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?an(r.bytesValue).toBase64():"referenceValue"in r?$.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=zo(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${zo(t.fields[a])}`;return i+"}"}(r.mapValue):W()}function Wn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function jo(r){return!!r&&"integerValue"in r}function _i(r){return!!r&&"arrayValue"in r}function Oc(r){return!!r&&"nullValue"in r}function Fc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ss(r){return!!r&&"mapValue"in r}function yi(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return vn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=yi(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=yi(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Lc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}function nm(r){return"nullValue"in r?Rs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Wn(An.empty(),$.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:W()}function rm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Wn(An.empty(),$.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?wn:W()}function Bc(r,e){const t=Rn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Uc(r,e){const t=Rn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class mt{constructor(e){this.value=e}static empty(){return new mt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ss(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=yi(t)}setAll(e){let t=De.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=yi(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Ss(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Zt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ss(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){vn(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new mt(yi(this.value))}}function qc(r){const e=[];return vn(r.fields,(t,n)=>{const i=new De([t]);if(Ss(n)){const s=qc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Ft(e)}class qe{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new qe(e,0,Z.min(),Z.min(),Z.min(),mt.empty(),0)}static newFoundDocument(e,t,n,i){return new qe(e,1,t,Z.min(),n,i,0)}static newNoDocument(e,t){return new qe(e,2,t,Z.min(),Z.min(),mt.empty(),0)}static newUnknownDocument(e,t){return new qe(e,3,t,Z.min(),Z.min(),mt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Pn{constructor(e,t){this.position=e,this.inclusive=t}}function zc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?$.comparator($.fromName(a.referenceValue),t.key):Rn(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function jc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Zt(r.position[t],e.position[t]))return!1;return!0}class Ii{constructor(e,t="asc"){this.field=e,this.dir=t}}function im(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Gc{}class Ee extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new sm(e,t,n):"array-contains"===t?new um(e,n):"in"===t?new Jc(e,n):"not-in"===t?new cm(e,n):"array-contains-any"===t?new lm(e,n):new Ee(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new om(e,n):new am(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Rn(t,this.value)):null!==t&&bn(this.value)===bn(t)&&this.matchesComparison(Rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return W()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class xe extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new xe(e,t)}matches(e){return Rr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rr(r){return"and"===r.op}function Go(r){return"or"===r.op}function Ko(r){return Kc(r)&&Rr(r)}function Kc(r){for(const e of r.filters)if(e instanceof xe)return!1;return!0}function $o(r){if(r instanceof Ee)return r.field.canonicalString()+r.op.toString()+br(r.value);if(Ko(r))return r.filters.map(e=>$o(e)).join(",");{const e=r.filters.map(t=>$o(t)).join(",");return`${r.op}(${e})`}}function $c(r,e){return r instanceof Ee?(n=r,(i=e)instanceof Ee&&n.op===i.op&&n.field.isEqual(i.field)&&Zt(n.value,i.value)):r instanceof xe?function(n,i){return i instanceof xe&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&$c(a,i.filters[u]),!0)}(r,e):void W();var n,i}function Qc(r,e){const t=r.filters.concat(e);return xe.create(t,r.op)}function Wc(r){return r instanceof Ee?`${(t=r).field.canonicalString()} ${t.op} ${br(t.value)}`:r instanceof xe?function(t){return t.op.toString()+" {"+t.getFilters().map(Wc).join(" ,")+"}"}(r):"Filter";var t}class sm extends Ee{constructor(e,t,n){super(e,t,n),this.key=$.fromName(n.referenceValue)}matches(e){const t=$.comparator(e.key,this.key);return this.matchesComparison(t)}}class om extends Ee{constructor(e,t){super(e,"in",t),this.keys=Hc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class am extends Ee{constructor(e,t){super(e,"not-in",t),this.keys=Hc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Hc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>$.fromName(n.referenceValue))}class um extends Ee{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _i(t)&&gi(t.arrayValue,this.value)}}class Jc extends Ee{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&gi(this.value.arrayValue,t)}}class cm extends Ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(gi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!gi(this.value.arrayValue,t)}}class lm extends Ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_i(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>gi(this.value.arrayValue,n))}}class hm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Qo(r,e=null,t=[],n=[],i=null,s=null,a=null){return new hm(r,e,t,n,i,s,a)}function Hn(r){const e=K(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>$o(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),Y(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>br(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>br(n)).join(",")),e.ue=t}return e.ue}function Ei(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!im(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!$c(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!jc(r.startAt,e.startAt)&&jc(r.endAt,e.endAt)}function Vs(r){return $.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function xs(r,e){return r.filters.filter(t=>t instanceof Ee&&t.field.isEqual(e))}function Yc(r,e,t){let n=Rs,i=!0;for(const s of xs(r,e)){let a=Rs,u=!0;switch(s.op){case"<":case"<=":a=nm(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Rs}Bc({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Bc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function Xc(r,e,t){let n=wn,i=!0;for(const s of xs(r,e)){let a=wn,u=!0;switch(s.op){case">=":case">":a=rm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=wn}Uc({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Uc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class un{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function Zc(r,e,t,n,i,s,a,u){return new un(r,e,t,n,i,s,a,u)}function Pr(r){return new un(r)}function el(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Wo(r){return null!==r.collectionGroup}function Sr(r){const e=K(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Ne(De.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Ii(s,n))}),t.has(De.keyField().canonicalString())||e.ce.push(new Ii(De.keyField(),n))}return e.ce}function yt(r){const e=K(r);return e.le||(e.le=function nl(r,e){if("F"===r.limitType)return Qo(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Ii(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Pn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Pn(r.startAt.position,r.startAt.inclusive):null;return Qo(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Sr(r))),e.le}function Ho(r,e){const t=r.filters.concat([e]);return new un(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Cs(r,e,t){return new un(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ti(r,e){return Ei(yt(r),yt(e))&&r.limitType===e.limitType}function rl(r){return`${Hn(yt(r))}|lt:${r.limitType}`}function Vr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Wc(i)).join(", ")}]`),Y(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>br(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>br(i)).join(",")),`Target(${n})`}(yt(r))}; limitType=${r.limitType})`}function vi(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):$.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Sr(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=zc(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,Sr(n),i)||n.endAt&&!function(a,u,c){const h=zc(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,Sr(n),i)));var n,i}function il(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function sl(r){return(e,t)=>{let n=!1;for(const i of Sr(r)){const s=dm(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function dm(r,e,t){const n=r.field.isKeyField()?$.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Rn(c,h):W()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return W()}}class cn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vn(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return Dc(this.inner)}size(){return this.innerSize}}const fm=new Be($.comparator);function Lt(){return fm}const ol=new Be($.comparator);function Ai(...r){let e=ol;for(const t of r)e=e.insert(t.key,t);return e}function al(r){let e=ol;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function en(){return wi()}function ul(){return wi()}function wi(){return new cn(r=>r.toString(),(r,e)=>r.isEqual(e))}const mm=new Be($.comparator),pm=new Ne($.comparator);function le(...r){let e=pm;for(const t of r)e=e.add(t);return e}const gm=new Ne(re);function Jo(){return gm}function cl(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:se(e)?"-0":e}}function ll(r){return{integerValue:""+r}}function hl(r,e){return Le(e)?ll(e):cl(r,e)}class Ds{constructor(){this._=void 0}}function _m(r,e,t){return r instanceof xr?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ws(s)&&(s=bs(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Jn?fl(r,e):r instanceof Yn?ml(r,e):function(i,s){const a=dl(i,s),u=pl(a)+pl(i.Pe);return jo(a)&&jo(i.Pe)?ll(u):cl(i.serializer,u)}(r,e)}function ym(r,e,t){return r instanceof Jn?fl(r,e):r instanceof Yn?ml(r,e):t}function dl(r,e){return r instanceof Cr?jo(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class xr extends Ds{}class Jn extends Ds{constructor(e){super(),this.elements=e}}function fl(r,e){const t=gl(e);for(const n of r.elements)t.some(i=>Zt(i,n))||t.push(n);return{arrayValue:{values:t}}}class Yn extends Ds{constructor(e){super(),this.elements=e}}function ml(r,e){let t=gl(e);for(const n of r.elements)t=t.filter(i=>!Zt(i,n));return{arrayValue:{values:t}}}class Cr extends Ds{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function pl(r){return Je(r.integerValue||r.doubleValue)}function gl(r){return _i(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class bi{constructor(e,t){this.field=e,this.transform=t}}class Em{constructor(e,t){this.version=e,this.transformResults=t}}class Qe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Qe}static exists(e){return new Qe(void 0,e)}static updateTime(e){return new Qe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ns(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class ks{}function _l(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Nr(r.key,Qe.none()):new Dr(r.key,r.data,Qe.none());{const t=r.data,n=mt.empty();let i=new Ne(De.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new ln(r.key,n,new Ft(i.toArray()),Qe.none())}}function Tm(r,e,t){r instanceof Dr?function(i,s,a){const u=i.value.clone(),c=El(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof ln?function(i,s,a){if(!Ns(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=El(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Il(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ri(r,e,t,n){return r instanceof Dr?function(s,a,u,c){if(!Ns(s.precondition,a))return u;const h=s.value.clone(),f=Tl(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof ln?function(s,a,u,c){if(!Ns(s.precondition,a))return u;const h=Tl(s.fieldTransforms,c,a),f=a.data;return f.setAll(Il(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,e,t,n):(u=t,Ns(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function vm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=dl(n.transform,i||null);null!=s&&(null===t&&(t=mt.empty()),t.set(n.field,s))}return t||null}function yl(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&sn(n,i,(s,a)=>function Im(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Jn&&i instanceof Jn||n instanceof Yn&&i instanceof Yn?sn(n.elements,i.elements,Zt):n instanceof Cr&&i instanceof Cr?Zt(n.Pe,i.Pe):n instanceof xr&&i instanceof xr);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Dr extends ks{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ln extends ks{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Il(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function El(r,e,t){const n=new Map;J(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,ym(a,u,t[i]))}return n}function Tl(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,_m(s,a,e))}return n}class Nr extends ks{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Yo extends ks{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Xo{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Tm(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ri(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ri(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ul();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=_l(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(Z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),le())}isEqual(e){return this.batchId===e.batchId&&sn(this.mutations,e.mutations,(t,n)=>yl(t,n))&&sn(this.baseMutations,e.baseMutations,(t,n)=>yl(t,n))}}class Zo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){J(e.mutations.length===n.length);let i=function(){return mm}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Zo(e,t,n,i)}}class ea{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Am{constructor(e,t){this.count=e,this.unchangedNames=t}}var et,Ae;function Al(r){switch(r){default:return W();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function wl(r){if(void 0===r)return Pe("GRPC error has no .code"),N.UNKNOWN;switch(r){case et.OK:return N.OK;case et.CANCELLED:return N.CANCELLED;case et.UNKNOWN:return N.UNKNOWN;case et.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case et.INTERNAL:return N.INTERNAL;case et.UNAVAILABLE:return N.UNAVAILABLE;case et.UNAUTHENTICATED:return N.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case et.NOT_FOUND:return N.NOT_FOUND;case et.ALREADY_EXISTS:return N.ALREADY_EXISTS;case et.PERMISSION_DENIED:return N.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case et.ABORTED:return N.ABORTED;case et.OUT_OF_RANGE:return N.OUT_OF_RANGE;case et.UNIMPLEMENTED:return N.UNIMPLEMENTED;case et.DATA_LOSS:return N.DATA_LOSS;default:return W()}}(Ae=et||(et={}))[Ae.OK=0]="OK",Ae[Ae.CANCELLED=1]="CANCELLED",Ae[Ae.UNKNOWN=2]="UNKNOWN",Ae[Ae.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ae[Ae.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ae[Ae.NOT_FOUND=5]="NOT_FOUND",Ae[Ae.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ae[Ae.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ae[Ae.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ae[Ae.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ae[Ae.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ae[Ae.ABORTED=10]="ABORTED",Ae[Ae.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ae[Ae.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ae[Ae.INTERNAL=13]="INTERNAL",Ae[Ae.UNAVAILABLE=14]="UNAVAILABLE",Ae[Ae.DATA_LOSS=15]="DATA_LOSS";function bl(){return new TextEncoder}const wm=new we([4294967295,4294967295],0);function Rl(r){const e=bl().encode(r),t=new q;return t.update(e),new Uint8Array(t.digest())}function Pl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new we([t,n],0),new we([i,s],0)]}class ta{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Pi(`Invalid padding: ${t}`);if(n<0)throw new Pi(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Pi(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Pi(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=we.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(we.fromNumber(n)));return 1===i.compare(wm)&&(i=new we([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Rl(e),[n,i]=Pl(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new ta(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=Rl(e),[n,i]=Pl(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Pi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Si{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Vi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Si(Z.min(),i,new Be(re),Lt(),le())}}class Vi{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Vi(n,t,le(),le(),le())}}class Os{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class Sl{constructor(e,t){this.targetId=e,this.me=t}}class Vl{constructor(e,t,n=at.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class xl{constructor(){this.fe=0,this.ge=Dl(),this.pe=at.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=le(),t=le(),n=le();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:W()}}),new Vi(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=Dl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,J(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class bm{constructor(e){this.Le=e,this.Be=new Map,this.ke=Lt(),this.qe=Cl(),this.Qe=new Be(re)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:W()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Vs(s))if(0===n){const a=new $(s.path);this.Ue(t,a,qe.newNoDocument(a,Z.min()))}else J(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=an(n).toUint8Array()}catch(c){if(c instanceof kc)return it("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new ta(a,i,s)}catch(c){return it(c instanceof Pi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Vs(u.target)){const c=new $(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,qe.newNoDocument(c,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let n=le();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Si(e,t,this.Qe,this.ke,n);return this.ke=Lt(),this.qe=Cl(),this.Qe=new Be(re),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new xl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ne(re),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||F("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new xl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Cl(){return new Be($.comparator)}function Dl(){return new Be($.comparator)}const Rm={asc:"ASCENDING",desc:"DESCENDING"},Pm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sm={and:"AND",or:"OR"};class Vm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function na(r,e){return r.useProto3Json||Y(e)?e:{value:e}}function kr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Nl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function xm(r,e){return kr(r,e.toTimestamp())}function Xe(r){return J(!!r),Z.fromTimestamp(function(t){const n=on(t);return new Me(n.seconds,n.nanos)}(r))}function ra(r,e){return ia(r,e).canonicalString()}function ia(r,e){const t=(i=r,new he(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function kl(r){const e=he.fromString(r);return J(Kl(e)),e}function xi(r,e){return ra(r.databaseId,e.path)}function tn(r,e){const t=kl(e);if(t.get(1)!==r.databaseId.projectId)throw new U(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new U(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new $(Fl(t))}function Ml(r,e){return ra(r.databaseId,e)}function Ol(r){const e=kl(r);return 4===e.length?he.emptyPath():Fl(e)}function sa(r){return new he(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Fl(r){return J(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function Ll(r,e,t){return{name:xi(r,e),fields:t.value.mapValue.fields}}function Bl(r,e,t){const n=tn(r,e.name),i=Xe(e.updateTime),s=e.createTime?Xe(e.createTime):Z.min(),a=new mt({mapValue:{fields:e.fields}}),u=qe.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Ci(r,e){let t;if(e instanceof Dr)t={update:Ll(r,e.key,e.value)};else if(e instanceof Nr)t={delete:xi(r,e.key)};else if(e instanceof ln)t={update:Ll(r,e.key,e.data),updateMask:Lm(e.fieldMask)};else{if(!(e instanceof Yo))return W();t={verify:xi(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof xr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Jn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Cr)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw W()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:xm(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:W()),t;var s}function oa(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Qe.updateTime(Xe(s.updateTime)):void 0!==s.exists?Qe.exists(s.exists):Qe.none():Qe.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(J("REQUEST_TIME"===u.setToServerValue),c=new xr):"appendMissingElements"in u?c=new Jn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Yn(u.removeAllFromArray.values||[]):"increment"in u?c=new Cr(a,u.increment):W();const h=De.fromServerFormat(u.fieldPath);return new bi(h,c)}(r,i)):[];var s;if(e.update){const i=tn(r,e.update.name),s=new mt({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new Ft((e.updateMask.fieldPaths||[]).map(f=>De.fromServerFormat(f)));return new ln(i,s,a,t,n)}return new Dr(i,s,t,n)}if(e.delete){const i=tn(r,e.delete);return new Nr(i,t)}if(e.verify){const i=tn(r,e.verify);return new Yo(i,t)}return W()}function Ul(r,e){return{documents:[Ml(r,e.path)]}}function Fs(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ml(r,i);const s=function(h){if(0!==h.length)return Gl(xe.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:Sn((y=f).field),direction:Mm(y.dir)};var y})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=na(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function zl(r){let e=Ol(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){J(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){const y=jl(p);return y instanceof xe&&Ko(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(y=>{return new Ii(Mr((L=y).field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction));var L}));let u=null;t.limit&&(u=function(p){let y;return y="object"==typeof p?p.value:p,Y(y)?null:y}(t.limit));let c=null;var p;t.startAt&&(c=new Pn((p=t.startAt).values||[],!!p.before));let h=null;return t.endAt&&(h=function(p){return new Pn(p.values||[],!p.before)}(t.endAt)),Zc(e,i,a,s,u,"F",c,h)}function jl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Mr(t.unaryFilter.field);return Ee.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Mr(t.unaryFilter.field);return Ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Mr(t.unaryFilter.field);return Ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Mr(t.unaryFilter.field);return Ee.create(a,"!=",{nullValue:"NULL_VALUE"});default:return W()}}(r):void 0!==r.fieldFilter?Ee.create(Mr((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return W()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return xe.create(t.compositeFilter.filters.map(n=>jl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return W()}}(t.compositeFilter.op))}(r):W();var t}function Mm(r){return Rm[r]}function Om(r){return Pm[r]}function Fm(r){return Sm[r]}function Sn(r){return{fieldPath:r.canonicalString()}}function Mr(r){return De.fromServerFormat(r.fieldPath)}function Gl(r){return r instanceof Ee?function(t){if("=="===t.op){if(Fc(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Fc(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NAN"}};if(Oc(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sn(t.field),op:Om(t.op),value:t.value}}}(r):r instanceof xe?function(t){const n=t.getFilters().map(i=>Gl(i));return 1===n.length?n[0]:{compositeFilter:{op:Fm(t.op),filters:n}}}(r):W()}function Lm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Kl(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class hn{constructor(e,t,n,i,s=Z.min(),a=Z.min(),u=at.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new hn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class $l{constructor(e){this.ct=e}}function Ql(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ls(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:xi(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:kr(s,a.version.toTimestamp()),createTime:kr(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Xn(e.version)};else{if(!e.isUnknownDocument())return W();n.unknownDocument={path:t.path.toArray(),version:Xn(e.version)}}var s,a;return n}function Ls(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Xn(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Zn(r){const e=new Me(r.seconds,r.nanoseconds);return Z.fromTimestamp(e)}function er(r,e){const t=(e.baseMutations||[]).map(s=>oa(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>oa(r.ct,s)),i=Me.fromMillis(e.localWriteTimeMs);return new Xo(e.batchId,i,t,n)}function Di(r){const e=Zn(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Zn(r.lastLimboFreeSnapshotVersion):Z.min();let n;return n=void 0!==r.query.documents?(J(1===(s=r.query).documents.length),yt(Pr(Ol(s.documents[0])))):function(s){return yt(zl(s))}(r.query),new hn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,at.fromBase64String(r.resumeToken));var s}function Wl(r,e){const t=Xn(e.snapshotVersion),n=Xn(e.lastLimboFreeSnapshotVersion);let i;i=Vs(e.target)?Ul(r.ct,e.target):Fs(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Hn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function aa(r){const e=zl({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Cs(e,e.limit,"L"):e}function ua(r,e){return new ea(e.largestBatchId,oa(r.ct,e.overlayMutation))}function Hl(r,e){const t=e.path.lastSegment();return[r,Ve(e.path.popLast()),t]}function Jl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Xn(n.readTime),documentKey:Ve(n.documentKey.path),largestBatchId:n.largestBatchId}}class Um{getBundleMetadata(e,t){return Yl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Zn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Yl(e).put({bundleId:(i=t).id,createTime:Xn(Xe(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Xl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:aa(s.bundledQuery),readTime:Zn(s.readTime)};var s})}saveNamedQuery(e,t){return Xl(e).put({name:(i=t).name,readTime:Xn(Xe(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Yl(r){return ut(r,"bundles")}function Xl(r){return ut(r,"namedQueries")}class Bs{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Bs(e,t.uid||"")}getOverlay(e,t){return Ni(e).get(Hl(this.userId,t)).next(n=>n?ua(this.serializer,n):null)}getOverlays(e,t){const n=en();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new ea(t,a);i.push(this.ht(e,u))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(Ve(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Ni(e).j("collectionPathOverlayIndex",u))}),P.waitFor(s)}getOverlaysForCollection(e,t,n){const i=en(),s=Ve(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ni(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=ua(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=en();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ni(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const p=ua(this.serializer,h);s.size()<i||p.largestBatchId===a?(s.set(p.getKey(),p),a=p.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Ni(e).put(function(i,s,a){const[u,c,h]=Hl(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ci(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function Ni(r){return ut(r,"documentOverlays")}class tr{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Je(e.integerValue));else if("doubleValue"in e){const n=Je(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),se(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=on(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(an(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Lc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):W()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),$.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function qm(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Zl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=qm(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}tr.bt=new tr;class zm{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{const i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){const t=this.Bt(e),n=Zl(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Bt(e),n=Zl(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class jm{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class Gm{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class ki{constructor(){this.Gt=new zm,this.zt=new jm(this.Gt),this.jt=new Gm(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class nr{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new nr(this.indexId,this.documentKey,this.arrayValue,n)}}function Vn(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=eh(r.arrayValue,e.arrayValue),0!==t?t:(t=eh(r.directionalValue,e.directionalValue),0!==t?t:$.comparator(r.documentKey,e.documentKey)))}function eh(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class th{constructor(e){this.Yt=new Ne((t,n)=>De.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const n=t;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(e){if(J(e.collectionGroup===this.collectionId),this.en)return!1;const t=Gn(e);if(void 0!==t&&!this.nn(t))return!1;const n=ht(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){const u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.rn(u,c)||!this.sn(this.Zt[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.Zt.length||!this.sn(this.Zt[a++],n[s]))return!1;return!0}on(){if(this.en)return null;let e=new Ne(De.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new _t(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new _t(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new _t(n.field,"asc"===n.dir?0:1)));return new Nt(Nt.UNKNOWN_ID,this.collectionId,t,Xt.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function nh(r){var e,t;if(J(r instanceof Ee||r instanceof xe),r instanceof Ee){if(r instanceof Jc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Ee.create(r.field,"==",s)))||[];return xe.create(i,"or")}return r}const n=r.filters.map(i=>nh(i));return xe.create(n,r.op)}function Km(r){if(0===r.getFilters().length)return[];const e=ha(nh(r));return J(rh(e)),ca(e)||la(e)?[e]:e.getFilters()}function ca(r){return r instanceof Ee}function la(r){return r instanceof xe&&Ko(r)}function rh(r){return ca(r)||la(r)||function(t){if(t instanceof xe&&Go(t)){for(const n of t.getFilters())if(!ca(n)&&!la(n))return!1;return!0}return!1}(r)}function ha(r){if(J(r instanceof Ee||r instanceof xe),r instanceof Ee)return r;if(1===r.filters.length)return ha(r.filters[0]);const e=r.filters.map(n=>ha(n));let t=xe.create(e,r.op);return t=Us(t),rh(t)?t:(J(t instanceof xe),J(Rr(t)),J(t.filters.length>1),t.filters.reduce((n,i)=>da(n,i)))}function da(r,e){let t;return J(r instanceof Ee||r instanceof xe),J(e instanceof Ee||e instanceof xe),t=r instanceof Ee?e instanceof Ee?xe.create([r,e],"and"):ih(r,e):e instanceof Ee?ih(e,r):function(i,s){if(J(i.filters.length>0&&s.filters.length>0),Rr(i)&&Rr(s))return Qc(i,s.getFilters());const a=Go(i)?i:s,u=Go(i)?s:i,c=a.filters.map(h=>da(h,u));return xe.create(c,"or")}(r,e),Us(t)}function ih(r,e){if(Rr(e))return Qc(e,r.getFilters());{const t=e.filters.map(n=>da(r,n));return xe.create(t,"or")}}function Us(r){if(J(r instanceof Ee||r instanceof xe),r instanceof Ee)return r;const e=r.getFilters();if(1===e.length)return Us(e[0]);if(Kc(r))return r;const t=e.map(i=>Us(i)),n=[];return t.forEach(i=>{i instanceof Ee?n.push(i):i instanceof xe&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:xe.create(n,r.op)}class $m{constructor(){this._n=new fa}addToCollectionParentIndex(e,t){return this._n.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(st.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(st.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class fa{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ne(he.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ne(he.comparator)).toArray()}}const qs=new Uint8Array(0);class Qm{constructor(e,t){this.databaseId=t,this.an=new fa,this.un=new cn(n=>Hn(n),(n,i)=>Ei(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});const s={collectionId:n,parent:Ve(i)};return sh(e).put(s)}return P.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[yr(t),""],!1,!0);return sh(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(ce(a.parent))}return n})}addFieldIndex(e,t){const n=Mi(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Fr(e);return s.next(u=>{a.put(Jl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Mi(e),i=Fr(e),s=Or(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Mi(e),n=Or(e),i=Fr(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return P.forEach(this.cn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new th(n).on();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Or(e);let i=!0;const s=new Map;return P.forEach(this.cn(t),a=>this.ln(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=le();const u=[];return P.forEach(s,(c,h)=>{var te;F("IndexedDbIndexManager",`Using index ${te=c,`id=${te.indexId}|cg=${te.collectionGroup}|f=${te.fields.map(ae=>`${ae.fieldPath}:${ae.kind}`).join(",")}`} to execute ${Hn(t)}`);const f=function(te,ae){const be=Gn(ae);if(void 0===be)return null;for(const de of xs(te,be.fieldPath))switch(de.op){case"array-contains-any":return de.value.arrayValue.values||[];case"array-contains":return[de.value]}return null}(h,c),p=function(te,ae){const be=new Map;for(const de of ht(ae))for(const A of xs(te,de.fieldPath))switch(A.op){case"==":case"in":be.set(de.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return be.set(de.fieldPath.canonicalString(),A.value),Array.from(be.values())}return null}(h,c),y=function(te,ae){const be=[];let de=!0;for(const A of ht(ae)){const g=0===A.kind?Yc(te,A.fieldPath,te.startAt):Xc(te,A.fieldPath,te.startAt);be.push(g.value),de&&(de=g.inclusive)}return new Pn(be,de)}(h,c),x=function(te,ae){const be=[];let de=!0;for(const A of ht(ae)){const g=0===A.kind?Xc(te,A.fieldPath,te.endAt):Yc(te,A.fieldPath,te.endAt);be.push(g.value),de&&(de=g.inclusive)}return new Pn(be,de)}(h,c),L=this.hn(c,h,y),G=this.hn(c,h,x),z=this.Pn(c,h,p),X=this.In(c.indexId,f,L,y.inclusive,G,x.inclusive,z);return P.forEach(X,ne=>n.G(ne,t.limit).next(te=>{te.forEach(ae=>{const be=$.fromSegments(ae.documentKey);a.has(be)||(a=a.add(be),u.push(be))})}))}).next(()=>u)}return P.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Km(xe.create(e.filters,"and")).map(n=>Qo(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let p=0;p<c;++p){const y=t?this.Tn(t[p/h]):qs,x=this.En(e,y,n[p%h],i),L=this.dn(e,y,s[p%h],a),G=u.map(z=>this.En(e,y,z,!0));f.push(...this.createRange(x,L,G))}return f}En(e,t,n,i){const s=new nr(e,$.empty(),t,n);return i?s:s.Jt()}dn(e,t,n,i){const s=new nr(e,$.empty(),t,n);return i?s.Jt():s}ln(e,t){const n=new th(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.cn(t);return P.forEach(i,s=>this.ln(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new Ne(De.comparator),f=!1;for(const p of c.filters)for(const y of p.getFlattenedFilters())y.field.isKeyField()||("array-contains"===y.op||"array-contains-any"===y.op?f=!0:h=h.add(y.field));for(const p of c.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}An(e,t){const n=new ki;for(const i of ht(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Ht(i.kind);tr.bt.Pt(s,a)}return n.Wt()}Tn(e){const t=new ki;return tr.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new ki;return tr.bt.Pt(Wn(this.databaseId,t),n.Ht(function(s){const a=ht(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let i=[];i.push(new ki);let s=0;for(const a of ht(e)){const u=n[s++];for(const c of i)if(this.Vn(t,a.fieldPath)&&_i(u))i=this.mn(i,a,u);else{const h=c.Ht(a.kind);tr.bt.Pt(u,h)}}return this.fn(i)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new ki;c.seed(u.Wt()),tr.bt.Pt(a,c.Ht(t.kind)),s.push(c)}return s}Vn(e,t){return!!e.filters.find(n=>n instanceof Ee&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Mi(e),i=Fr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return P.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,p){const y=p?new Xt(p.sequenceNumber,new st(Zn(p.readTime),new $(ce(p.documentKey)),p.largestBatchId)):Xt.empty(),x=f.fields.map(([L,G])=>new _t(De.fromServerFormat(L),G));return new Nt(f.indexId,f.collectionGroup,x,y)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:re(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Mi(e),s=Fr(e);return this.gn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>P.forEach(u,c=>s.put(Jl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return P.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?P.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),P.forEach(u,c=>this.pn(e,i,c).next(h=>{const f=this.yn(s,c);return h.isEqual(f)?P.resolve():this.wn(e,s,c,h,f)}))))})}Sn(e,t,n,i){return Or(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,i){return Or(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const i=Or(e);let s=new Ne(Vn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(a,u)=>{s=s.add(new nr(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(e,t){let n=new Ne(Vn);const i=this.An(t,e);if(null==i)return n;const s=Gn(t);if(null!=s){const a=e.data.field(s.fieldPath);if(_i(a))for(const u of a.arrayValue.values||[])n=n.add(new nr(t.indexId,e.key,this.Tn(u),i))}else n=n.add(new nr(t.indexId,e.key,qs,i));return n}wn(e,t,n,i,s){F("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,p,y){const x=c.getIterator(),L=h.getIterator();let G=wr(x),z=wr(L);for(;G||z;){let X=!1,ne=!1;if(G&&z){const te=f(G,z);te<0?ne=!0:te>0&&(X=!0)}else null!=G?ne=!0:X=!0;X?(p(z),z=wr(L)):ne?(y(G),G=wr(x)):(G=wr(x),z=wr(L))}}(i,s,Vn,u=>{a.push(this.Sn(e,t,n,u))},u=>{a.push(this.bn(e,t,n,u))}),P.waitFor(a)}gn(e){let t=1;return Fr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>Vn(a,u)).filter((a,u,c)=>!u||0!==Vn(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=Vn(a,e),c=Vn(a,t);if(0===u)i[0]=e.Jt();else if(u>0&&c<0)i.push(a),i.push(a.Jt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,qs,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,qs,[]]))}return s}Dn(e,t){return Vn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oh)}getMinOffset(e,t){return P.mapArray(this.cn(t),n=>this.ln(e,n).next(i=>i||W())).next(oh)}}function sh(r){return ut(r,"collectionParents")}function Or(r){return ut(r,"indexEntries")}function Mi(r){return ut(r,"indexConfiguration")}function Fr(r){return ut(r,"indexState")}function oh(r){J(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Kn(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new st(e.readTime,e.documentKey,t)}const ah={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class It{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new It(e,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function uh(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,p,y)=>(u++,y.delete()));s.push(c.next(()=>{J(1===u)}));const h=[];for(const f of t.mutations){const p=Ar(e,f.key.path,t.batchId);s.push(i.delete(p)),h.push(f.key)}return P.waitFor(s).next(()=>h)}function zs(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw W();e=r.noDocument}return JSON.stringify(e).length}It.DEFAULT_COLLECTION_PERCENTILE=10,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,It.DEFAULT=new It(41943040,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),It.DISABLED=new It(-1,0,0);class js{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(e,t,n,i){J(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new js(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xn(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=Lr(e),a=xn(e);return a.add({}).next(u=>{J("number"==typeof u);const c=new Xo(u,t,n,i),h=function(x,L,G){const z=G.baseMutations.map(ne=>Ci(x.ct,ne)),X=G.mutations.map(ne=>Ci(x.ct,ne));return{userId:L,batchId:G.batchId,localWriteTimeMs:G.localWriteTime.toMillis(),baseMutations:z,mutations:X}}(this.serializer,this.userId,c),f=[];let p=new Ne((y,x)=>re(y.canonicalString(),x.canonicalString()));for(const y of i){const x=Ar(this.userId,y.key.path,u);p=p.add(y.key.path.popLast()),f.push(a.put(h)),f.push(s.put(x,Fo))}return p.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.Cn[u]=c.keys()}),P.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return xn(e).get(t).next(n=>n?(J(n.userId===this.userId),er(this.serializer,n)):null)}vn(e,t){return this.Cn[t]?P.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return xn(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(J(u.batchId>=n),s=er(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return xn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xn(e).U("userMutationsIndex",t).next(n=>n.map(i=>er(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Qt(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return Lr(e).J({range:i},(a,u,c)=>{const[h,f,p]=a,y=ce(f);if(h===this.userId&&t.path.isEqual(y))return xn(e).get(p).next(x=>{if(!x)throw W();J(x.userId===this.userId),s.push(er(this.serializer,x))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ne(re);const i=[];return t.forEach(s=>{const a=Qt(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=Lr(e).J({range:u},(h,f,p)=>{const[y,x,L]=h,G=ce(x);y===this.userId&&s.path.isEqual(G)?n=n.add(L):p.done()});i.push(c)}),P.waitFor(i).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Qt(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new Ne(re);return Lr(e).J({range:a},(c,h,f)=>{const[p,y,x]=c,L=ce(y);p===this.userId&&n.isPrefixOf(L)?L.length===i&&(u=u.add(x)):f.done()}).next(()=>this.Fn(e,u))}Fn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(xn(e).get(s).next(a=>{if(null===a)throw W();J(a.userId===this.userId),n.push(er(this.serializer,a))}))}),P.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return uh(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),P.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Lr(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=ce(s[1]);i.push(c)}else u.done()}).next(()=>{J(0===i.length)})})}containsKey(e,t){return ch(e,this.userId,t)}xn(e){return lh(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ch(r,e,t){const n=Qt(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return Lr(r).J({range:s,H:!0},(u,c,h)=>{const[f,p,y]=u;f===e&&p===i&&(a=!0),h.done()}).next(()=>a)}function xn(r){return ut(r,"mutations")}function Lr(r){return ut(r,"documentMutations")}function lh(r){return ut(r,"mutationQueues")}class rr{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new rr(0)}static Ln(){return new rr(-1)}}class Wm{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const n=new rr(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>Z.fromTimestamp(new Me(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Br(e).delete(t.targetId)).next(()=>this.Bn(e)).next(n=>(J(n.targetCount>0),n.targetCount-=1,this.kn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Br(e).J((a,u)=>{const c=Di(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Br(e).J((n,i)=>{const s=Di(i);t(s)})}Bn(e){return hh(e).get("targetGlobalKey").next(t=>(J(null!==t),t))}kn(e,t){return hh(e).put("targetGlobalKey",t)}qn(e,t){return Br(e).put(Wl(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Hn(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Br(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Di(u);Ei(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Cn(e);return t.forEach(a=>{const u=Ve(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),P.waitFor(i)}removeMatchingKeys(e,t,n){const i=Cn(e);return P.forEach(t,s=>{const a=Ve(s.path);return P.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Cn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Cn(e);let s=le();return i.J({range:n,H:!0},(a,u,c)=>{const h=ce(a[1]),f=new $(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=Ve(t.path),i=IDBKeyRange.bound([n],[yr(n)],!1,!0);let s=0;return Cn(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Br(e).get(t).next(n=>n?Di(n):null)}}function Br(r){return ut(r,"targets")}function hh(r){return ut(r,"targetGlobal")}function Cn(r){return ut(r,"targetDocuments")}function dh([r,e],[t,n]){const i=re(r,t);return 0===i?re(e,n):i}class Hm{constructor(e){this.Kn=e,this.buffer=new Ne(dh),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();dh(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var t=this;F("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,V.A)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){$t(n)?F("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Kt(n)}yield t.zn(3e5)}))}}class Jm{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return P.resolve(C.oe);const n=new Hm(t);return this.jn.forEachTarget(e,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(ah)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ah):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),rt()<=Ge.$b.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${p} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}}class Ym{constructor(e,t){this.db=e,this.garbageCollector=function mh(r,e){return new Jm(r,e)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Zn(e){let t=0;return this.Jn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(n,i)=>t(i))}addReference(e,t,n){return Gs(e,n)}removeReference(e,t,n){return Gs(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Gs(e,t)}er(e,t){return function(i,s){let a=!1;return lh(i).Y(u=>ch(i,u,s).next(c=>(c&&(a=!0),P.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(e,(a,u)=>{if(u<=t){const c=this.er(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,Z.min()),Cn(e).delete([0,Ve(a.path)])))});i.push(c)}}).next(()=>P.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Gs(e,t)}Xn(e,t){const n=Cn(e);let i,s=C.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==C.oe&&t(new $(ce(i)),s),s=h,i=c):s=C.oe}).next(()=>{s!==C.oe&&t(new $(ce(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Gs(r,e){return Cn(r).put((i=r.currentSequenceNumber,{targetId:0,path:Ve(e.path),sequenceNumber:i}));var i}class ph{constructor(){this.changes=new cn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Xm{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ir(e).put(n)}removeEntry(e,t,n){return ir(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ls(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=qe.newInvalidDocument(t);return ir(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Oi(t))},(i,s)=>{n=this.nr(t,s)}).next(()=>n)}rr(e,t){let n={size:0,document:qe.newInvalidDocument(t)};return ir(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Oi(t))},(i,s)=>{n={document:this.nr(t,s),size:zs(s)}}).next(()=>n)}getEntries(e,t){let n=Lt();return this.ir(e,t,(i,s)=>{const a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(e,t){let n=Lt(),i=new Be($.comparator);return this.ir(e,t,(s,a)=>{const u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,zs(a))}).next(()=>({documents:n,_r:i}))}ir(e,t,n){if(t.isEmpty())return P.resolve();let i=new Ne(Ih);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(Oi(i.first()),Oi(i.last())),a=i.getIterator();let u=a.getNext();return ir(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const p=$.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Ih(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(Oi(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Ls(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ir(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Lt();for(const p of h){const y=this.nr($.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);y.isFoundDocument()&&(vi(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=Lt();const a=yh(t,n),u=yh(t,st.max());return ir(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const p=this.nr($.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Zm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _h(e).get("remoteDocumentGlobalKey").next(t=>(J(!!t),t))}tr(e,t){return _h(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const n=function Bm(r,e){let t;if(e.document)t=Bl(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=$.fromSegments(e.noDocument.path),i=Zn(e.noDocument.readTime);t=qe.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return W();{const n=$.fromSegments(e.unknownDocument.path),i=Zn(e.unknownDocument.version);t=qe.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Me(i[0],i[1]);return Z.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(Z.min()))return n}return qe.newInvalidDocument(e)}}function gh(r){return new Xm(r)}class Zm extends ph{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new cn(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new Ne((s,a)=>re(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=Ql(this.ar.serializer,a);i=i.add(s.path.popLast());const h=zs(c);n+=h-u.size,t.push(this.ar.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=Ql(this.ar.serializer,a.convertToNoDocument(Z.min()));t.push(this.ar.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,n)),P.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(n=>(this.ur.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function _h(r){return ut(r,"remoteDocumentGlobal")}function ir(r){return ut(r,"remoteDocumentsV14")}function Oi(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yh(r,e){const t=e.documentKey.path.toArray();return[r,Ls(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Ih(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=re(t[s],n[s]),i)return i;return i=re(t.length,n.length),i||(i=re(t[t.length-2],n[n.length-2]),i||re(t[t.length-1],n[n.length-1]))}class ep{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Eh{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Ri(n.mutation,i,Ft.empty(),Me.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,le()).next(()=>n))}getLocalViewOfDocuments(e,t,n=le()){const i=en();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Ai();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=en();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,le()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=Lt();const a=wi(),u=wi();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof ln)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Ri(f.mutation,h,f.mutation.getFieldMask(),Me.now())):a.set(h.key,Ft.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var p;return u.set(h,new ep(f,null!==(p=a.get(h))&&void 0!==p?p:null))}),u))}recalculateAndSaveOverlays(e,t){const n=wi();let i=new Be((a,u)=>a-u),s=le();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||Ft.empty();f=u.applyToLocalView(h,f),n.set(c,f);const p=(i.get(u.batchId)||le()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,p=ul();f.forEach(y=>{if(!s.has(y)){const x=_l(t.get(y),n.get(y));null!==x&&p.set(y,x),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,p))}return P.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return $.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Wo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):P.resolve(en());let u=-1,c=s;return a.next(h=>P.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,le())).next(f=>({batchId:u,changes:al(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $(t)).next(n=>{let i=Ai();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=Ai();return this.indexManager.getCollectionParents(e,s).next(u=>P.forEach(u,c=>{const h=(p=t,y=c.child(s),new un(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,y;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((p,y)=>{a=a.insert(p,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,qe.newInvalidDocument(f)))});let u=Ai();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Ri(f.mutation,h,Ft.empty(),Me.now()),vi(t,h)&&(u=u.insert(c,h))}),u})}}class tp{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return P.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:Xe(i.createTime)}),P.resolve();var i}getNamedQuery(e,t){return P.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:aa(i.bundledQuery),readTime:Xe(i.readTime)}),P.resolve();var i}}class np{constructor(){this.overlays=new Be($.comparator),this.hr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=en();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.hr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const i=en(),s=t.length+1,a=new $(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Be((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=en(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=en(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return P.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ea(t,n));let s=this.hr.get(t);void 0===s&&(s=le(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class ma{constructor(){this.Pr=new Ne(ct.Ir),this.Tr=new Ne(ct.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new ct(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new ct(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){const t=new $(new he([])),n=new ct(t,e),i=new ct(t,e+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new $(new he([])),n=new ct(t,e),i=new ct(t,e+1);let s=le();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new ct(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ct{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return $.comparator(e.key,t.key)||re(e.pr,t.pr)}static Er(e,t){return re(e.pr,t.pr)||$.comparator(e.key,t.key)}}class rp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ne(ct.Ir)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.yr;this.yr++;const a=new Xo(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.wr=this.wr.add(new ct(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ct(t,0),i=new ct(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{const u=this.Sr(a.pr);s.push(u)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ne(re);return t.forEach(i=>{const s=new ct(i,0),a=new ct(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),P.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;$.isDocumentKey(s)||(s=s.child(""));const a=new ct(new $(s),0);let u=new Ne(re);return this.wr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.pr)),!0)},a),P.resolve(this.Dr(u))}Dr(e){const t=[];return e.forEach(n=>{const i=this.Sr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){J(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return P.forEach(t.mutations,i=>{const s=new ct(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new ct(t,0),i=this.wr.firstAfterOrEqual(n);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return P.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ip{constructor(e){this.vr=e,this.docs=new Be($.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let n=Lt();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():qe.newInvalidDocument(i))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Lt();const a=t.path,u=new $(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Kn(Tr(f),n)<=0||(i.has(f.key)||vi(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,n,i){W()}Fr(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new sp(this)}getSize(e){return P.resolve(this.size)}}class sp extends ph{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class op{constructor(e){this.persistence=e,this.Mr=new cn(t=>Hn(t),Ei),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ma,this.targetCount=0,this.Lr=rr.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),P.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new rr(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.qn(t),P.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Nr.containsKey(t))}}class pa{constructor(e,t){this.Br={},this.overlays={},this.kr=new C(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new op(this),this.indexManager=new $m,this.remoteDocumentCache=new ip(n=>this.referenceDelegate.Kr(n)),this.serializer=new $l(t),this.$r=new tp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new np,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new rp(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){F("MemoryPersistence","Starting transaction:",e);const i=new ap(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return P.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class ap extends fi{constructor(e){super(),this.currentSequenceNumber=e}}class Ks{constructor(e){this.persistence=e,this.zr=new ma,this.jr=null}static Hr(e){return new Ks(e)}get Jr(){if(this.jr)return this.jr;throw W()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),P.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Jr,n=>{const i=$.fromPath(n);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,Z.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return P.or([()=>P.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class up{constructor(e){this.serializer=e}O(e,t,n,i){const s=new En("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Rt,{unique:!0}),c.createObjectStore("documentMutations"),Th(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=P.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Th(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Z.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Rt,{unique:!0});const p=h.store("mutations"),y=f.map(x=>p.put(x));return P.waitFor(y)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:me});h.createIndex("collectionPathOverlayIndex",Ke,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",$e,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:Es});h.createIndex("documentKeyIndex",Lo),h.createIndex("collectionGroupIndex",Bo)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:O}).createIndex("sequenceNumberIndex",H,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:oe}).createIndex("documentKeyIndex",ue,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),a}ei(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=zs(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>P.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>P.forEach(u,c=>{J(c.userId===s.userId);const h=er(this.serializer,c);return uh(e,s.userId,h).next(()=>{})}))}))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new he(a),h=[0,Ve(c)];s.push(t.get(h).next(f=>f?P.resolve():t.put({targetId:0,path:Ve(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>P.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:R});const n=t.store("collectionParents"),i=new fa,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Ve(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new he(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=ce(u);return s(f.popLast())}))}ri(e){const t=e.store("targets");return t.J((n,i)=>{const s=Di(i),a=Wl(this.serializer,s);return t.put(a)})}ii(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(p=a,p.document?new $(he.fromString(p.document.name).popFirst(5)):p.noDocument?$.fromSegments(p.noDocument.path):p.unknownDocument?$.fromSegments(p.unknownDocument.path):W()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var p;i.push(u.put(h))}).next(()=>P.waitFor(i))}si(e,t){const n=t.store("mutations"),i=gh(this.serializer),s=new pa(Ks.Hr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:le();er(this.serializer,c).keys().forEach(p=>f=f.add(p)),u.set(c.userId,f)}),P.forEach(u,(c,h)=>{const f=new Ue(h),p=Bs.lt(this.serializer,f),y=s.getIndexManager(f),x=js.lt(f,this.serializer,y,s.referenceDelegate);return new Eh(i,x,p,y).recalculateAndSaveOverlaysForDocumentKeys(new qo(t,C.oe),c).next()})})}}function Th(r){r.createObjectStore("targetDocuments",{keyPath:Uo}).createIndex("documentTargetsIndex",k,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ts,{unique:!0}),r.createObjectStore("targetGlobal")}const ga="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _a{constructor(e,t,n,i,s,a,u,c,h,f,p=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=h,this.ai=f,this.ui=p,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=y=>Promise.resolve(),!_a.D())throw new U(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ym(this,i),this.Ti=t+"main",this.serializer=new $l(c),this.Ei=new kt(this.Ti,this.ui,new up(this.serializer)),this.Qr=new Wm(this.referenceDelegate,this.serializer),this.remoteDocumentCache=gh(this.serializer),this.$r=new Um,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===f&&Pe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new U(N.FAILED_PRECONDITION,ga);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new C(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var t=this;return this.Ii=function(){var n=(0,V.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(function(){var t=(0,V.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,V.A)(function*(){t.started&&(yield t.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Qs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if($t(e))return F("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return F("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Fi(e).get("owner").next(t=>P.resolve(this.Si(t)))}bi(e){return Qs(e).delete(this.clientId)}Di(){var e=this;return(0,V.A)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ut(n,"clientMetadata");return i.U().next(s=>{const a=e.vi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return P.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.di)for(const n of t)e.di.removeItem(e.Fi(n.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?P.resolve(!0):Fi(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new U(N.FAILED_PRECONDITION,ga);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qs(e).U().next(n=>void 0===this.vi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&F("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,V.A)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new qo(t,C.oe);return e.yi(n).next(()=>e.bi(n))}),e.Ei.close(),e.Li()})()}vi(e,t){return e.filter(n=>this.Ci(n.updateTimeMs,t)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Qs(e).U().next(t=>this.vi(t,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return js.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Qm(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Bs.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){F("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(c=this.ui)?Xf:15===c?Vc:14===c?Sc:13===c?vs:12===c?Qn:11===c?Ot:void W();var c;let a;return this.Ei.runTransaction(e,i,s,u=>(a=new qo(u,this.kr?this.kr.next():C.oe),"readwrite-primary"===t?this.gi(a).next(c=>!!c||this.pi(a)).next(c=>{if(!c)throw Pe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new U(N.FAILED_PRECONDITION,di);return n(a)}).next(c=>this.wi(a).next(()=>c)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(e){return Fi(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new U(N.FAILED_PRECONDITION,ga)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fi(e).put("owner",t)}static D(){return kt.D()}yi(e){const t=Fi(e);return t.get("owner").next(n=>this.Si(n)?(F("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(Pe(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,ie.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return F("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Pe("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Pe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Fi(r){return ut(r,"owner")}function Qs(r){return ut(r,"clientMetadata")}function ya(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Ia{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=le(),i=le();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ia(e,t.fromCache,n,i)}}class cp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,ie.nr)()?8:$n((0,ie.ZQ)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ji(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new cp;return this.Ji(e,t,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(e,t,a,u.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(rt()<=Ge.$b.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",Vr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),P.resolve()):(rt()<=Ge.$b.DEBUG&&F("QueryEngine","Query:",Vr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(rt()<=Ge.$b.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",Vr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yt(t))):P.resolve())}ji(e,t){if(el(t))return P.resolve(null);let n=yt(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Cs(t,null,"F"),n=yt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=le(...s);return this.zi.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.Zi(t,u);return this.Xi(t,h,a,c.readTime)?this.ji(e,Cs(t,null,"F")):this.es(e,h,t,c)}))})))}Hi(e,t,n,i){return el(t)||i.isEqual(Z.min())?P.resolve(null):this.zi.getDocuments(e,n).next(s=>{const a=this.Zi(t,s);return this.Xi(t,a,n,i)?P.resolve(null):(rt()<=Ge.$b.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Vr(t)),this.es(e,a,t,Gt(i,-1)).next(u=>u))})}Zi(e,t){let n=new Ne(sl(e));return t.forEach((i,s)=>{vi(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return rt()<=Ge.$b.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",Vr(t)),this.zi.getDocumentsMatchingQuery(e,t,st.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class lp{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new Be(re),this.rs=new cn(s=>Hn(s),Ei),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Eh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function Ah(r,e,t,n){return new lp(r,e,t,n)}function wh(r,e){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,V.A)(function*(r,e){const t=K(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=le();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({us:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function bh(r){const e=K(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function Rh(r,e,t){let n=le(),i=le();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Lt();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(Z.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):F("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{cs:a,ls:i}})}function fp(r,e){const t=K(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ur(r,e){const t=K(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(s=>s?(i=s,P.resolve(i)):t.Qr.allocateTargetId(n).next(a=>(i=new hn(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ns.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}function qr(r,e,t){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,V.A)(function*(r,e,t){const n=K(r),i=n.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!$t(a))throw a;F("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})).apply(this,arguments)}function Ws(r,e,t){const n=K(r);let i=Z.min(),s=le();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const p=K(c),y=p.rs.get(f);return void 0!==y?P.resolve(p.ns.get(y)):p.Qr.getTargetData(h,f)}(n,a,yt(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ts.getDocumentsMatchingQuery(a,e,t?i:Z.min(),t?s:le())).next(u=>(Vh(n,il(e),u),{documents:u,hs:s})))}function Ph(r,e){const t=K(r),n=K(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function Sh(r,e){const t=K(r),n=t.ss.get(e)||Z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,Gt(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Vh(t,e,i),i))}function Vh(r,e,t){let n=r.ss.get(e)||Z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(e,n)}function va(){return(va=(0,V.A)(function*(r,e,t,n){const i=K(r);let s=le(),a=Lt();for(const h of t){const f=e.Ps(h.metadata.name);h.document&&(s=s.add(f));const p=e.Is(h);p.setReadTime(e.Ts(h.metadata.readTime)),a=a.insert(f,p)}const u=i.os.newChangeBuffer({trackRemovals:!0}),c=yield Ur(i,(f=n,yt(Pr(he.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Rh(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Qr.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.cs,f.ls)).next(()=>f.cs)))})).apply(this,arguments)}function pp(r,e){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,V.A)(function*(r,e,t=le()){const n=yield Ur(r,yt(aa(e.bundledQuery))),i=K(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Xe(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.$r.saveNamedQuery(s,e);const u=n.withResumeToken(at.EMPTY_BYTE_STRING,a);return i.ns=i.ns.insert(u.targetId,u),i.Qr.updateTargetData(s,u).next(()=>i.Qr.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Qr.addMatchingKeys(s,t,n.targetId)).next(()=>i.$r.saveNamedQuery(s,e))})})).apply(this,arguments)}function xh(r,e){return`firestore_clients_${r}_${e}`}function Ch(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function wa(r,e){return`firestore_targets_${r}_${e}`}class Hs{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Es(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new U(i.error.code,i.error.message))),a?new Hs(e,t,i.state,s):(Pe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Li{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new U(n.error.code,n.error.message))),s?new Li(e,n.state,i):(Pe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Js{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Jo();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Le(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new Js(e,s):(Pe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ba{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ba(t.clientId,t.onlineState):(Pe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ra{constructor(){this.activeTargetIds=Jo()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pa{constructor(e,t,n,i,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Be(re),this.started=!1,this.ys=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=xh(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Ra),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,V.A)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Vs)continue;const s=e.getItem(xh(e.persistenceKey,i));if(s){const a=Js.Es(i,s);a&&(e.ps=e.ps.insert(a.clientId,a))}}e.Ms();const n=e.storage.getItem(e.vs);if(n){const i=e.xs(n);i&&e.Os(i)}for(const i of e.ys)e.gs(i);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(wa(this.persistenceKey,e));if(n){const i=Li.Es(e,n);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wa(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return F("SharedClientState","READ",e,t),t}setItem(e,t){F("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){F("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var t=this;const n=e;if(n.storageArea===this.storage){if(F("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ws)return void Pe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,V.A)(function*(){if(t.started){if(null!==n.key)if(t.bs.test(n.key)){if(null==n.newValue){const i=t.$s(n.key);return t.Us(i,null)}{const i=t.Ws(n.key,n.newValue);if(i)return t.Us(i.clientId,i)}}else if(t.Ds.test(n.key)){if(null!==n.newValue){const i=t.Gs(n.key,n.newValue);if(i)return t.zs(i)}}else if(t.Cs.test(n.key)){if(null!==n.newValue){const i=t.js(n.key,n.newValue);if(i)return t.Hs(i)}}else if(n.key===t.vs){if(null!==n.newValue){const i=t.xs(n.newValue);if(i)return t.Os(i)}}else if(n.key===t.Ss){const i=function(a){let u=C.oe;if(null!=a)try{const c=JSON.parse(a);J("number"==typeof c),u=c}catch(c){Pe("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==C.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Fs){const i=t.Js(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ys(s)))}}else t.ys.push(n)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){const i=new Hs(this.currentUser,e,t,n),s=Ch(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){const t=Ch(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,t,n){const i=wa(this.persistenceKey,e),s=new Li(e,t,n);this.setItem(i,s.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return Js.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),i=Number(n[1]);return Hs.Es(new Ue(void 0!==n[2]?n[2]:null),i,t)}js(e,t){const n=this.Cs.exec(e),i=Number(n[1]);return Li.Es(i,t)}xs(e){return ba.Es(e)}Js(e){return JSON.parse(e)}zs(e){var t=this;return(0,V.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Zs(e.batchId,e.state,e.error);F("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Jo();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Dh{constructor(){this.no=new Ra,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Ra,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gp{io(e){}shutdown(){}}class Nh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){F("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){F("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ys=null;function Sa(){return null===Ys?Ys=268435456+Math.round(2147483648*Math.random()):Ys++,"0x"+Ys.toString(16)}const _p={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class yp{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const Et="WebChannelConnection";class Ip extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,n,i,s,a){const u=Sa(),c=this.vo(t,n.toUriEncodedString());F("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(h,s,a),this.Mo(t,c,h,i).then(f=>(F("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw it("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}xo(t,n,i,s,a,u){return this.Co(t,n,i,s,a)}Fo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+jt,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}vo(t,n){return`${this.wo}/v1/${n}:${_p[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){const s=Sa();return new Promise((a,u)=>{const c=new _e;c.setWithCredentials(!0),c.listenOnce(Fe.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case fe.NO_ERROR:const f=c.getResponseJson();F(Et,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case fe.TIMEOUT:F(Et,`RPC '${e}' ${s} timed out`),u(new U(N.DEADLINE_EXCEEDED,"Request time out"));break;case fe.HTTP_ERROR:const p=c.getStatus();if(F(Et,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let y=c.getResponseJson();Array.isArray(y)&&(y=y[0]);const x=y?.error;if(x&&x.status&&x.message){const L=function(z){const X=z.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(X)>=0?X:N.UNKNOWN}(x.status);u(new U(L,x.message))}else u(new U(N.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new U(N.UNAVAILABLE,"Connection failed."));break;default:W()}}finally{F(Et,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);F(Et,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Oo(e,t,n){const i=Sa(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=bt(),u=Dt(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new Ce({})),this.Fo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");F(Et,`Creating RPC '${e}' stream ${i}: ${f}`,c);const p=a.createWebChannel(f,c);let y=!1,x=!1;const L=new yp({lo:z=>{x?F(Et,`Not sending because RPC '${e}' stream ${i} is closed:`,z):(y||(F(Et,`Opening RPC '${e}' stream ${i} transport.`),p.open(),y=!0),F(Et,`RPC '${e}' stream ${i} sending:`,z),p.send(z))},ho:()=>p.close()}),G=(z,X,ne)=>{z.listen(X,te=>{try{ne(te)}catch(ae){setTimeout(()=>{throw ae},0)}})};return G(p,nt.EventType.OPEN,()=>{x||(F(Et,`RPC '${e}' stream ${i} transport opened.`),L.mo())}),G(p,nt.EventType.CLOSE,()=>{x||(x=!0,F(Et,`RPC '${e}' stream ${i} transport closed`),L.po())}),G(p,nt.EventType.ERROR,z=>{x||(x=!0,it(Et,`RPC '${e}' stream ${i} transport errored:`,z),L.po(new U(N.UNAVAILABLE,"The operation could not be completed")))}),G(p,nt.EventType.MESSAGE,z=>{var X;if(!x){const ne=z.data[0];J(!!ne);const ae=ne.error||(null===(X=ne[0])||void 0===X?void 0:X.error);if(ae){F(Et,`RPC '${e}' stream ${i} received error:`,ae);const be=ae.status;let de=function(T){const w=et[T];if(void 0!==w)return wl(w)}(be),A=ae.message;void 0===de&&(de=N.INTERNAL,A="Unknown error status: "+be+" with message "+ae.message),x=!0,L.po(new U(de,A)),p.close()}else F(Et,`RPC '${e}' stream ${i} received:`,ne),L.yo(ne)}}),G(u,Bt.STAT_EVENT,z=>{z.stat===ge.PROXY?F(Et,`RPC '${e}' stream ${i} detected buffering proxy`):z.stat===ge.NOPROXY&&F(Et,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.fo()},0),L}}function kh(){return typeof window<"u"?window:null}function Xs(){return typeof document<"u"?document:null}function Bi(r){return new Vm(r,!0)}class Va{constructor(e,t,n=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&F("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class Mh{constructor(e,t,n,i,s,a,u,c){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Va(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}stop(){var e=this;return(0,V.A)(function*(){e.Zo()&&(yield e.close(0))})()}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){var e=this;return(0,V.A)(function*(){if(e.Xo())return e.close(0)})()}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){var n=this;return(0,V.A)(function*(){n.s_(),n.o_(),n.Yo.cancel(),n.jo++,4!==e?n.Yo.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(Pe(t.toString()),Pe("Using maximum backoff delay to prevent overloading the backend."),n.Yo.Ko()):t&&t.code===N.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.__(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ao(t)})()}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{const i=new U(N.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){var e=this;this.state=5,this.Yo.$o((0,V.A)(function*(){e.state=0,e.start()}))}c_(e){return F("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(F("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ep extends Mh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function Dm(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:W(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(J(void 0===f||"string"==typeof f),at.fromBase64String(f||"")):(J(void 0===f||f instanceof Buffer||f instanceof Uint8Array),at.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?N.UNKNOWN:wl(h.code);return new U(f,h.message||"")}(a);t=new Vl(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=tn(r,n.document.name),s=Xe(n.document.updateTime),a=n.document.createTime?Xe(n.document.createTime):Z.min(),u=new mt({mapValue:{fields:n.document.fields}}),c=qe.newFoundDocument(i,s,a,u);t=new Os(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=tn(r,n.document),s=n.readTime?Xe(n.readTime):Z.min(),a=qe.newNoDocument(i,s);t=new Os([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=tn(r,n.document);t=new Os([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return W();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new Am(i,s);t=new Sl(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return Z.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Z.min():a.readTime?Xe(a.readTime):Z.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=sa(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=Vs(c)?{documents:Ul(s,c)}:{query:Fs(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Nl(s,a.resumeToken);const h=na(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(Z.min())>0){u.readTime=kr(s,a.snapshotVersion.toTimestamp());const h=na(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function km(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=sa(this.serializer),t.removeTarget=e,this.i_(t)}}class Tp extends Mh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(J(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function Nm(r,e){return r&&r.length>0?(J(void 0!==e),r.map(t=>function(i,s){let a=Xe(i.updateTime?i.updateTime:s);return a.isEqual(Z.min())&&(a=Xe(s)),new Em(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Xe(e.commitTime);return this.listener.A_(n,t)}return J(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=sa(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Ci(this.serializer,n))};this.i_(t)}}class vp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new U(N.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,ia(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new U(N.UNKNOWN,s.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(e,ia(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new U(N.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class Ap{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Pe(t),this.y_=!1):F("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class wp{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(u=>{n.enqueueAndForget((0,V.A)(function*(){var c;Dn(a)&&(F("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,V.A)(function*(f){const p=K(f);p.M_.add(4),yield zr(p),p.N_.set("Unknown"),p.M_.delete(4),yield Ui(p)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.N_=new Ap(n,i)}}function Ui(r){return xa.apply(this,arguments)}function xa(){return(xa=(0,V.A)(function*(r){if(Dn(r))for(const e of r.x_)yield e(!0)})).apply(this,arguments)}function zr(r){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,V.A)(function*(r){for(const e of r.x_)yield e(!1)})).apply(this,arguments)}function Zs(r,e){const t=K(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),ka(t)?Na(t):Kr(t).Xo()&&Da(t,e))}function jr(r,e){const t=K(r),n=Kr(t);t.F_.delete(e),n.Xo()&&Oh(t,e),0===t.F_.size&&(n.Xo()?n.n_():Dn(t)&&t.N_.set("Unknown"))}function Da(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Z.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kr(r).P_(e)}function Oh(r,e){r.L_.xe(e),Kr(r).I_(e)}function Na(r){r.L_=new bm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Kr(r).start(),r.N_.w_()}function ka(r){return Dn(r)&&!Kr(r).Zo()&&r.F_.size>0}function Dn(r){return 0===K(r).M_.size}function Fh(r){r.L_=void 0}function bp(r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,V.A)(function*(r){r.N_.set("Online")})).apply(this,arguments)}function Rp(r){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,V.A)(function*(r){r.F_.forEach((e,t)=>{Da(r,e)})})).apply(this,arguments)}function Pp(r,e){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,V.A)(function*(r,e){Fh(r),ka(r)?(r.N_.D_(e),Na(r)):r.N_.set("Unknown")})).apply(this,arguments)}function Sp(r,e,t){return La.apply(this,arguments)}function La(){return La=(0,V.A)(function*(r,e,t){if(r.N_.set("Online"),e instanceof Vl&&2===e.state&&e.cause)try{yield(n=(0,V.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.F_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.F_.delete(c),s.L_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){F("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield eo(r,n)}else if(e instanceof Os?r.L_.Ke(e):e instanceof Sl?r.L_.He(e):r.L_.We(e),!t.isEqual(Z.min()))try{const n=yield bh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.L_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.F_.get(h);f&&s.F_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.F_.get(c);if(!f)return;s.F_.set(c,f.withResumeToken(at.EMPTY_BYTE_STRING,f.snapshotVersion)),Oh(s,c);const p=new hn(f.target,c,h,f.sequenceNumber);Da(s,p)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){F("RemoteStore","Failed to raise snapshot:",n),yield eo(r,n)}var n}),La.apply(this,arguments)}function eo(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,V.A)(function*(r,e,t){if(!$t(e))throw e;r.M_.add(1),yield zr(r),r.N_.set("Offline"),t||(t=()=>bh(r.localStore)),r.asyncQueue.enqueueRetryable((0,V.A)(function*(){F("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield Ui(r)}))})).apply(this,arguments)}function Lh(r,e){return e().catch(t=>eo(r,t,e))}function Gr(r){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,V.A)(function*(r){const e=K(r),t=Nn(e);let n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Vp(e);)try{const i=yield fp(e.localStore,n);if(null===i){0===e.v_.length&&t.n_();break}n=i.batchId,xp(e,i)}catch(i){yield eo(e,i)}Bh(e)&&Uh(e)})).apply(this,arguments)}function Vp(r){return Dn(r)&&r.v_.length<10}function xp(r,e){r.v_.push(e);const t=Nn(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function Bh(r){return Dn(r)&&!Nn(r).Zo()&&r.v_.length>0}function Uh(r){Nn(r).start()}function Cp(r){return qa.apply(this,arguments)}function qa(){return(qa=(0,V.A)(function*(r){Nn(r).V_()})).apply(this,arguments)}function Dp(r){return za.apply(this,arguments)}function za(){return(za=(0,V.A)(function*(r){const e=Nn(r);for(const t of r.v_)e.d_(t.mutations)})).apply(this,arguments)}function Np(r,e,t){return ja.apply(this,arguments)}function ja(){return(ja=(0,V.A)(function*(r,e,t){const n=r.v_.shift(),i=Zo.from(n,e,t);yield Lh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Gr(r)})).apply(this,arguments)}function kp(r,e){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,V.A)(function*(r,e){var t;e&&Nn(r).E_&&(yield(t=(0,V.A)(function*(i,s){if(Al(u=s.code)&&u!==N.ABORTED){const a=i.v_.shift();Nn(i).t_(),yield Lh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Gr(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),Bh(r)&&Uh(r)}),Ga.apply(this,arguments)}function qh(r,e){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,V.A)(function*(r,e){const t=K(r);t.asyncQueue.verifyOperationInProgress(),F("RemoteStore","RemoteStore received new credentials");const n=Dn(t);t.M_.add(3),yield zr(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Ui(t)})).apply(this,arguments)}function $a(r,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,V.A)(function*(r,e){const t=K(r);e?(t.M_.delete(2),yield Ui(t)):e||(t.M_.add(2),yield zr(t),t.N_.set("Unknown"))})).apply(this,arguments)}function Kr(r){return r.B_||(r.B_=function(t,n,i){const s=K(t);return s.f_(),new Ep(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:bp.bind(null,r),To:Rp.bind(null,r),Ao:Pp.bind(null,r),h_:Sp.bind(null,r)}),r.x_.push(function(){var e=(0,V.A)(function*(t){t?(r.B_.t_(),ka(r)?Na(r):r.N_.set("Unknown")):(yield r.B_.stop(),Fh(r))});return function(t){return e.apply(this,arguments)}}())),r.B_}function Nn(r){return r.k_||(r.k_=function(t,n,i){const s=K(t);return s.f_(),new Tp(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:Cp.bind(null,r),Ao:kp.bind(null,r),R_:Dp.bind(null,r),A_:Np.bind(null,r)}),r.x_.push(function(){var e=(0,V.A)(function*(t){t?(r.k_.t_(),yield Gr(r)):(yield r.k_.stop(),r.v_.length>0&&(F("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))});return function(t){return e.apply(this,arguments)}}())),r.k_}class Wa{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new He,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Wa(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new U(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $r(r,e){if(Pe("AsyncQueue",`${e}: ${r}`),$t(r))return new U(N.UNAVAILABLE,`${e}: ${r}`);throw r}class Qr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||$.comparator(t.key,n.key):(t,n)=>$.comparator(t.key,n.key),this.keyedMap=Ai(),this.sortedSet=new Be(this.comparator)}static emptySet(e){return new Qr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Qr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Qr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class zh{constructor(){this.q_=new Be($.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):W():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Wr{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new Wr(e,t,Qr.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ti(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class Mp{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class Op{constructor(){this.queries=new cn(e=>rl(e),Ti),this.onlineState="Unknown",this.z_=new Set}}function Ha(r,e){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,V.A)(function*(r,e){const t=K(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(n=2):(s=new Mp,n=e.G_()?0:1);try{switch(n){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=$r(a,`Initialization of query '${Vr(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Za(t)})).apply(this,arguments)}function Ya(r,e){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,V.A)(function*(r,e){const t=K(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.U_.indexOf(e);a>=0&&(s.U_.splice(a,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Fp(r,e){const t=K(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&Za(t)}function Lp(r,e,t){const n=K(r),i=n.queries.get(e);if(i)for(const s of i.U_)s.onError(t);n.queries.delete(e)}function Za(r){r.z_.forEach(e=>{e.next()})}var eu,jh;(jh=eu||(eu={})).J_="default",jh.Cache="cache";class tu{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Wr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Wr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==eu.Cache}}class Bp{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class Gh{constructor(e){this.serializer=e}Ps(e){return tn(this.serializer,e)}Is(e){return e.metadata.exists?Bl(this.serializer,e.document,!1):qe.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Xe(e)}}class Up{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Kh(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const n=he.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,n=new Gh(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Ps(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||le()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,V.A)(function*(){const t=yield function mp(r,e,t,n){return va.apply(this,arguments)}(e.localStore,new Gh(e.serializer),e.documents,e.oa.id),n=e.aa(e.documents);for(const i of e.queries)yield pp(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function Kh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class $h{constructor(e){this.key=e}}class Qh{constructor(e){this.key=e}}class Wh{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=le(),this.mutatedKeys=le(),this.Ia=sl(e),this.Ta=new Qr(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new zh,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{const y=i.get(f),x=vi(this.query,p)?p:null,L=!!y&&this.mutatedKeys.has(y.key),G=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let z=!1;y&&x?y.data.isEqual(x.data)?L!==G&&(n.track({type:3,doc:x}),z=!0):this.Ra(y,x)||(n.track({type:2,doc:x}),z=!0,(c&&this.Ia(x,c)>0||h&&this.Ia(x,h)<0)&&(u=!0)):!y&&x?(n.track({type:0,doc:x}),z=!0):y&&!x&&(n.track({type:1,doc:y}),z=!0,(c||h)&&(u=!0)),z&&(x?(a=a.add(x),s=G?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const a=e.Aa.Q_();a.sort((f,p)=>function(x,L){const G=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W()}};return G(x)-G(L)}(f.type,p.type)||this.Ia(f.doc,p.doc)),this.Va(n),i=null!=i&&i;const u=t&&!i?this.ma():[],c=0===this.Pa.size&&this.current&&!i?1:0,h=c!==this.ha;return this.ha=c,0!==a.length||h?{snapshot:new Wr(this.query,e.Ta,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new zh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=le(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});const t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new Qh(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new $h(n))}),t}pa(e){this.la=e.hs,this.Pa=le();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Wr.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class qp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class zp{constructor(e){this.key=e,this.wa=!1}}class jp{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new cn(u=>rl(u),Ti),this.Da=new Map,this.Ca=new Set,this.va=new Be($.comparator),this.Fa=new Map,this.Ma=new ma,this.xa={},this.Oa=new Map,this.Na=rr.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function Gp(r,e){return nu.apply(this,arguments)}function nu(){return(nu=(0,V.A)(function*(r,e,t=!0){const n=to(r);let i;const s=n.ba.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Hh(n,e,t,!0),i})).apply(this,arguments)}function Kp(r,e){return ru.apply(this,arguments)}function ru(){return(ru=(0,V.A)(function*(r,e){const t=to(r);yield Hh(t,e,!0,!1)})).apply(this,arguments)}function Hh(r,e,t,n){return iu.apply(this,arguments)}function iu(){return(iu=(0,V.A)(function*(r,e,t,n){const i=yield Ur(r.localStore,yt(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield su(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Zs(r.remoteStore,i),u})).apply(this,arguments)}function su(r,e,t,n,i){return ou.apply(this,arguments)}function ou(){return ou=(0,V.A)(function*(r,e,t,n,i){r.Ba=(p,y,x)=>{return(L=(0,V.A)(function*(z,X,ne,te){let ae=X.view.da(ne);ae.Xi&&(ae=yield Ws(z.localStore,X.query,!1).then(({documents:g})=>X.view.da(g,ae)));const be=te&&te.targetChanges.get(X.targetId),de=te&&null!=te.targetMismatches.get(X.targetId),A=X.view.applyChanges(ae,z.isPrimaryClient,be,de);return _u(z,X.targetId,A.fa),A.snapshot}),function G(z,X,ne,te){return L.apply(this,arguments)})(r,p,y,x);var L};const s=yield Ws(r.localStore,e,!0),a=new Wh(e,s.hs),u=a.da(s.documents),c=Vi.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);_u(r,t,h.fa);const f=new qp(e,t,a);return r.ba.set(e,f),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),h.snapshot}),ou.apply(this,arguments)}function $p(r,e,t){return au.apply(this,arguments)}function au(){return(au=(0,V.A)(function*(r,e,t){const n=K(r),i=n.ba.get(e),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!Ti(a,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield qr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&jr(n.remoteStore,i.targetId),Hr(n,i.targetId)}).catch(Kt))):(Hr(n,i.targetId),yield qr(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Qp(r,e){return uu.apply(this,arguments)}function uu(){return(uu=(0,V.A)(function*(r,e){const t=K(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),jr(t.remoteStore,n.targetId))})).apply(this,arguments)}function cu(){return(cu=(0,V.A)(function*(r,e,t){const n=Su(r);try{const i=yield function(a,u){const c=K(a),h=Me.now(),f=u.reduce((x,L)=>x.add(L.key),le());let p,y;return c.persistence.runTransaction("Locally write mutations","readwrite",x=>{let L=Lt(),G=le();return c.os.getEntries(x,f).next(z=>{L=z,L.forEach((X,ne)=>{ne.isValidDocument()||(G=G.add(X))})}).next(()=>c.localDocuments.getOverlayedDocuments(x,L)).next(z=>{p=z;const X=[];for(const ne of u){const te=vm(ne,p.get(ne.key).overlayedDocument);null!=te&&X.push(new ln(ne.key,te,qc(te.value.mapValue),Qe.exists(!0)))}return c.mutationQueue.addMutationBatch(x,h,X,u)}).next(z=>{y=z;const X=z.applyToLocalDocumentSet(p,G);return c.documentOverlayCache.saveOverlays(x,z.batchId,X)})}).then(()=>({batchId:y.batchId,changes:al(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.xa[a.currentUser.toKey()];h||(h=new Be(re)),h=h.insert(u,c),a.xa[a.currentUser.toKey()]=h}(n,i.batchId,t),yield dn(n,i.changes),yield Gr(n.remoteStore)}catch(i){const s=$r(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Jh(r,e){return lu.apply(this,arguments)}function lu(){return(lu=(0,V.A)(function*(r,e){const t=K(r);try{const n=yield function dp(r,e){const t=K(r),n=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const u=[];e.targetChanges.forEach((f,p)=>{const y=i.get(p);if(!y)return;u.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,p)));let x=y.withSequenceNumber(s.currentSequenceNumber);var G,z,X;null!==e.targetMismatches.get(p)?x=x.withResumeToken(at.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):f.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(f.resumeToken,n)),i=i.insert(p,x),z=x,X=f,(0===(G=y).resumeToken.approximateByteSize()||z.snapshotVersion.toMicroseconds()-G.snapshotVersion.toMicroseconds()>=3e8||X.addedDocuments.size+X.modifiedDocuments.size+X.removedDocuments.size>0)&&u.push(t.Qr.updateTargetData(s,x))});let c=Lt(),h=le();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Rh(s,a,e.documentUpdates).next(f=>{c=f.cs,h=f.ls})),!n.isEqual(Z.min())){const f=t.Qr.getLastRemoteSnapshotVersion(s).next(p=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return P.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Fa.get(s);a&&(J(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?J(a.wa):i.removedDocuments.size>0&&(J(a.wa),a.wa=!1))}),yield dn(t,n,e)}catch(n){yield Kt(n)}})).apply(this,arguments)}function Yh(r,e,t){const n=K(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.ba.forEach((s,a)=>{const u=a.view.j_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=K(a);c.onlineState=u;let h=!1;c.queries.forEach((f,p)=>{for(const y of p.U_)y.j_(u)&&(h=!0)}),h&&Za(c)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Hp(r,e,t){return hu.apply(this,arguments)}function hu(){return(hu=(0,V.A)(function*(r,e,t){const n=K(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Fa.get(e),s=i&&i.key;if(s){let a=new Be($.comparator);a=a.insert(s,qe.newNoDocument(s,Z.min()));const u=le().add(s),c=new Si(Z.min(),new Map,new Be(re),a,u);yield Jh(n,c),n.va=n.va.remove(s),n.Fa.delete(e),yu(n)}else yield qr(n.localStore,e,!1).then(()=>Hr(n,e,t)).catch(Kt)})).apply(this,arguments)}function Jp(r,e){return du.apply(this,arguments)}function du(){return(du=(0,V.A)(function*(r,e){const t=K(r),n=e.batch.batchId;try{const i=yield function hp(r,e){const t=K(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const p=h.batch,y=p.keys();let x=P.resolve();return y.forEach(L=>{x=x.next(()=>f.getEntry(c,L)).next(G=>{const z=h.docVersions.get(L);J(null!==z),G.version.compareTo(z)<0&&(p.applyToRemoteDocument(G,h),G.isValidDocument()&&(G.setReadTime(h.commitVersion),f.addEntry(G)))})}),x.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=le();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);gu(t,n,null),pu(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield dn(t,i)}catch(i){yield Kt(i)}})).apply(this,arguments)}function Yp(r,e,t){return fu.apply(this,arguments)}function fu(){return(fu=(0,V.A)(function*(r,e,t){const n=K(r);try{const i=yield function(a,u){const c=K(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(p=>(J(null!==p),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);gu(n,e,t),pu(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield dn(n,i)}catch(i){yield Kt(i)}})).apply(this,arguments)}function mu(){return(mu=(0,V.A)(function*(r,e){const t=K(r);Dn(t.remoteStore)||F("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=K(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Oa.get(n)||[];i.push(e),t.Oa.set(n,i)}catch(n){const i=$r(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function pu(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function gu(r,e,t){const n=K(r);let i=n.xa[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function Hr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||Xh(r,n)})}function Xh(r,e){r.Ca.delete(e.path.canonicalString());const t=r.va.get(e);null!==t&&(jr(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),yu(r))}function _u(r,e,t){for(const n of t)n instanceof $h?(r.Ma.addReference(n.key,e),Zp(r,n)):n instanceof Qh?(F("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||Xh(r,n.key)):W()}function Zp(r,e){const t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(F("SyncEngine","New document in limbo: "+t),r.Ca.add(n),yu(r))}function yu(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){const e=r.Ca.values().next().value;r.Ca.delete(e);const t=new $(he.fromString(e)),n=r.Na.next();r.Fa.set(n,new zp(t)),r.va=r.va.insert(t,n),Zs(r.remoteStore,new hn(yt(Pr(t.path)),n,"TargetPurposeLimboResolution",C.oe))}}function dn(r,e,t){return Iu.apply(this,arguments)}function Iu(){return Iu=(0,V.A)(function*(r,e,t){const n=K(r),i=[],s=[],a=[];var u;n.ba.isEmpty()||(n.ba.forEach((u,c)=>{a.push(n.Ba(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const p=h?!h.fromCache:null===(f=t?.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(h){i.push(h);const p=Ia.Ki(c.targetId,h);s.push(p)}}))}),yield Promise.all(a),n.Sa.h_(i),yield(u=(0,V.A)(function*(h,f){const p=K(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>P.forEach(f,x=>P.forEach(x.qi,L=>p.persistence.referenceDelegate.addReference(y,x.targetId,L)).next(()=>P.forEach(x.Qi,L=>p.persistence.referenceDelegate.removeReference(y,x.targetId,L)))))}catch(y){if(!$t(y))throw y;F("LocalStore","Failed to update sequence numbers: "+y)}for(const y of f){const x=y.targetId;if(!y.fromCache){const L=p.ns.get(x),z=L.withLastLimboFreeSnapshotVersion(L.snapshotVersion);p.ns=p.ns.insert(x,z)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Iu.apply(this,arguments)}function eg(r,e){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,V.A)(function*(r,e){const t=K(r);if(!t.currentUser.isEqual(e)){F("SyncEngine","User change. New user:",e.toKey());const n=yield wh(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(u=>{u.forEach(c=>{c.reject(new U(N.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield dn(t,n.us)}var s})).apply(this,arguments)}function tg(r,e){const t=K(r),n=t.Fa.get(e);if(n&&n.wa)return le().add(n.key);{let i=le();const s=t.Da.get(e);if(!s)return i;for(const a of s){const u=t.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function ng(r,e){return Tu.apply(this,arguments)}function Tu(){return(Tu=(0,V.A)(function*(r,e){const t=K(r),n=yield Ws(t.localStore,e.query,!0),i=e.view.pa(n);return t.isPrimaryClient&&_u(t,e.targetId,i.fa),i})).apply(this,arguments)}function rg(r,e){return vu.apply(this,arguments)}function vu(){return(vu=(0,V.A)(function*(r,e){const t=K(r);return Sh(t.localStore,e).then(n=>dn(t,n))})).apply(this,arguments)}function ig(r,e,t,n){return Au.apply(this,arguments)}function Au(){return(Au=(0,V.A)(function*(r,e,t,n){const i=K(r),s=yield function(u,c){const h=K(u),f=K(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.vn(p,c).next(y=>y?h.localDocuments.getDocuments(p,y):P.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield Gr(i.remoteStore):"acknowledged"===t||"rejected"===t?(gu(i,e,n||null),pu(i,e),c=e,K(K(i.localStore).mutationQueue).Mn(c)):W(),yield dn(i,s)):F("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function wu(){return(wu=(0,V.A)(function*(r,e){const t=K(r);if(to(t),Su(t),!0===e&&!0!==t.La){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Zh(t,n.toArray());t.La=!0,yield $a(t.remoteStore,!0);for(const s of i)Zs(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const n=[];let i=Promise.resolve();t.Da.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Hr(t,a),qr(t.localStore,a,!0))),jr(t.remoteStore,a)}),yield i,yield Zh(t,n),function(a){const u=K(a);u.Fa.forEach((c,h)=>{jr(u.remoteStore,h)}),u.Ma.mr(),u.Fa=new Map,u.va=new Be($.comparator)}(t),t.La=!1,yield $a(t.remoteStore,!1)}})).apply(this,arguments)}function Zh(r,e,t){return bu.apply(this,arguments)}function bu(){return(bu=(0,V.A)(function*(r,e,t){const n=K(r),i=[],s=[];for(const a of e){let u;const c=n.Da.get(a);if(c&&0!==c.length){u=yield Ur(n.localStore,yt(c[0]));for(const h of c){const f=n.ba.get(h),p=yield ng(n,f);p.snapshot&&s.push(p.snapshot)}}else{const h=yield Ph(n.localStore,a);u=yield Ur(n.localStore,h),yield su(n,ed(h),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})).apply(this,arguments)}function ed(r){return Zc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function og(r){return t=K(r).localStore,K(K(t).persistence).Bi();var t}function ag(r,e,t,n){return Ru.apply(this,arguments)}function Ru(){return(Ru=(0,V.A)(function*(r,e,t,n){const i=K(r);if(i.La)return void F("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield Sh(i.localStore,il(s[0])),u=Si.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,at.EMPTY_BYTE_STRING);yield dn(i,a,u);break}case"rejected":yield qr(i.localStore,e,!0),Hr(i,e,n);break;default:W()}})).apply(this,arguments)}function ug(r,e,t){return Pu.apply(this,arguments)}function Pu(){return(Pu=(0,V.A)(function*(r,e,t){const n=to(r);if(n.La){for(const i of e){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){F("SyncEngine","Adding an already active target "+i);continue}const s=yield Ph(n.localStore,i),a=yield Ur(n.localStore,s);yield su(n,ed(s),a.targetId,!1,a.resumeToken),Zs(n.remoteStore,a)}for(const i of t)n.Da.has(i)&&(yield qr(n.localStore,i,!1).then(()=>{jr(n.remoteStore,i),Hr(n,i)}).catch(Kt))}})).apply(this,arguments)}function to(r){const e=K(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hp.bind(null,e),e.Sa.h_=Fp.bind(null,e.eventManager),e.Sa.ka=Lp.bind(null,e.eventManager),e}function Su(r){const e=K(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Jp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Yp.bind(null,e),e}class Jr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,V.A)(function*(){t.serializer=Bi(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Ah(this.persistence,new vh,e.initialUser,this.serializer)}createPersistence(e){return new pa(Ks.Hr,this.serializer)}createSharedClientState(e){return new Dh}terminate(){var e=this;return(0,V.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Vu extends Jr{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,V.A)(function*(){yield t().call(n,e),yield n.Qa.initialize(n,e),yield Su(n.Qa.syncEngine),yield Gr(n.Qa.remoteStore),yield n.persistence.fi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Ah(this.persistence,new vh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new fh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new B(t,this.persistence);return new v(e.asyncQueue,n)}createPersistence(e){const t=ya(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new _a(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,kh(),Xs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Dh}}class td extends Vu{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,V.A)(function*(){yield t().call(n,e);const i=n.Qa.syncEngine;n.sharedClientState instanceof Pa&&(n.sharedClientState.syncEngine={Zs:ig.bind(null,i),Xs:ag.bind(null,i),eo:ug.bind(null,i),Bi:og.bind(null,i),Ys:rg.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.fi(function(){var s=(0,V.A)(function*(a){yield function sg(r,e){return wu.apply(this,arguments)}(n.Qa.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=kh();if(!Pa.D(t))throw new U(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=ya(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Pa(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Yr{initialize(e,t){var n=this;return(0,V.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Yh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=eg.bind(null,n.syncEngine),yield $a(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Op}createDatastore(e){const t=Bi(e.databaseInfo.databaseId),n=new Ip(e.databaseInfo);return new vp(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Yh(this.syncEngine,t,0),u=Nh.D()?new Nh:new gp,new wp(n,i,s,a,u);var n,i,s,a,u}createSyncEngine(e,t){return function(i,s,a,u,c,h,f){const p=new jp(i,s,a,u,c,h);return f&&(p.La=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,V.A)(function*(){var t,n;yield(n=(0,V.A)(function*(s){const a=K(s);F("RemoteStore","RemoteStore shutting down."),a.M_.add(5),yield zr(a),a.O_.shutdown(),a.N_.set("Unknown")}),function i(s){return n.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function nd(r,e=10240){let t=0;return{read:()=>(0,V.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,V.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class no{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Pe("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hg{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new He,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,V.A)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,V.A)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,V.A)(function*(){const t=yield e.za();if(null===t)return null;const n=e.Wa.decode(t),i=Number(n);isNaN(i)&&e.ja(`length string (${n}) is not valid number`);const s=yield e.Ha(i);return new Bp(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>123===e)}za(){var e=this;return(0,V.A)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Ha(e){var t=this;return(0,V.A)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const n=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,V.A)(function*(){const t=yield e.Ua.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class dg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,V.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new U(N.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,V.A)(function*(a,u){const c=K(a),h={documents:u.map(x=>xi(c.serializer,x))},f=yield c.xo("BatchGetDocuments",c.serializer.databaseId,he.emptyPath(),h,u.length),p=new Map;f.forEach(x=>{const L=function Cm(r,e){return"found"in e?function(n,i){J(!!i.found);const s=tn(n,i.found.name),a=Xe(i.found.updateTime),u=i.found.createTime?Xe(i.found.createTime):Z.min(),c=new mt({mapValue:{fields:i.found.fields}});return qe.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){J(!!i.missing),J(!!i.readTime);const s=tn(n,i.missing),a=Xe(i.readTime);return qe.newNoDocument(s,a)}(r,e):W()}(c.serializer,x);p.set(L.key.toString(),L)});const y=[];return u.forEach(x=>{const L=p.get(x.toString());J(!!L),y.push(L)}),y}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Nr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,V.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=$.fromPath(i);e.mutations.push(new Yo(s,e.precondition(s)))}),yield(n=(0,V.A)(function*(s,a){const u=K(s),c={writes:a.map(h=>Ci(u.serializer,h))};yield u.Co("Commit",u.serializer.databaseId,he.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw W();t=Z.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new U(N.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Z.min())?Qe.exists(!1):Qe.updateTime(t):Qe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Z.min()))throw new U(N.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qe.updateTime(t)}return Qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class fg{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new Va(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Yo.$o((0,V.A)(function*(){const t=new dg(e.datastore),n=e.tu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!Y(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Al(t)}return!1}}class mg{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ue.UNAUTHENTICATED,this.clientId=hi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var a=(0,V.A)(function*(u){F("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(n,a=>(F("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new U(N.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new He;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,V.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=$r(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ro(r,e){return xu.apply(this,arguments)}function xu(){return xu=(0,V.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),F("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,V.A)(function*(s){n.isEqual(s)||(yield wh(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),xu.apply(this,arguments)}function Cu(r,e){return Du.apply(this,arguments)}function Du(){return(Du=(0,V.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Nu(r);F("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>qh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>qh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function rd(r){return"FirebaseError"===r.name?r.code===N.FAILED_PRECONDITION||r.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Nu(r){return ku.apply(this,arguments)}function ku(){return(ku=(0,V.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){F("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ro(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!rd(t))throw t;it("Error using user provided cache. Falling back to memory cache: "+t),yield ro(r,new Jr)}}else F("FirestoreClient","Using default OfflineComponentProvider"),yield ro(r,new Jr);return r._offlineComponents})).apply(this,arguments)}function io(r){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,V.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(F("FirestoreClient","Using user provided OnlineComponentProvider"),yield Cu(r,r._uninitializedComponentsProvider._online)):(F("FirestoreClient","Using default OnlineComponentProvider"),yield Cu(r,new Yr))),r._onlineComponents})).apply(this,arguments)}function id(r){return Nu(r).then(e=>e.persistence)}function Xr(r){return Nu(r).then(e=>e.localStore)}function sd(r){return io(r).then(e=>e.remoteStore)}function Ou(r){return io(r).then(e=>e.syncEngine)}function Zr(r){return Fu.apply(this,arguments)}function Fu(){return(Fu=(0,V.A)(function*(r){const e=yield io(r),t=e.eventManager;return t.onListen=Gp.bind(null,e.syncEngine),t.onUnlisten=$p.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Kp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Qp.bind(null,e.syncEngine),t})).apply(this,arguments)}function ad(r,e,t={}){const n=new He;return r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return function(s,a,u,c,h){const f=new no({next:y=>{a.enqueueAndForget(()=>Ya(s,p));const x=y.docs.has(u);!x&&y.fromCache?h.reject(new U(N.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&y.fromCache&&c&&"server"===c.source?h.reject(new U(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),p=new tu(Pr(u.path),f,{includeMetadataChanges:!0,ra:!0});return Ha(s,p)}(yield Zr(r),r.asyncQueue,e,t,n)})),n.promise}function ud(r,e,t={}){const n=new He;return r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return function(s,a,u,c,h){const f=new no({next:y=>{a.enqueueAndForget(()=>Ya(s,p)),y.fromCache&&"server"===c.source?h.reject(new U(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),p=new tu(u,f,{includeMetadataChanges:!0,ra:!0});return Ha(s,p)}(yield Zr(r),r.asyncQueue,e,t,n)})),n.promise}function cd(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const ld=new Map;function Lu(r,e,t){if(!t)throw new U(N.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function hd(r,e,t,n){if(!0===e&&!0===n)throw new U(N.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function dd(r){if(!$.isDocumentKey(r))throw new U(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function fd(r){if($.isDocumentKey(r))throw new U(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function so(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":W()}function pe(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new U(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=so(r);throw new U(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function md(r,e){if(e<=0)throw new U(N.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class pd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new U(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new U(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=cd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new U(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new U(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new U(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qi{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new U(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new U(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new ui;switch(n.type){case"firstParty":return new li(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new U(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ld.get(t);n&&(F("ComponentProvider","Removing Datastore"),ld.delete(t),n.terminate())}(this),Promise.resolve()}}class pt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pt(this.firestore,e,this._query)}}class ze{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ze(this.firestore,e,this._key)}}class nn extends pt{constructor(e,t,n){super(e,t,Pr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ze(this.firestore,null,new $(e))}withConverter(e){return new nn(this.firestore,e,this._path)}}function _d(r,e,...t){if(r=(0,ie.Ku)(r),Lu("collection","path",e),r instanceof qi){const n=he.fromString(e,...t);return fd(n),new nn(r,null,n)}{if(!(r instanceof ze||r instanceof nn))throw new U(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(he.fromString(e,...t));return fd(n),new nn(r.firestore,null,n)}}function oo(r,e,...t){if(r=(0,ie.Ku)(r),1===arguments.length&&(e=hi.newId()),Lu("doc","path",e),r instanceof qi){const n=he.fromString(e,...t);return dd(n),new ze(r,null,new $(n))}{if(!(r instanceof ze||r instanceof nn))throw new U(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(he.fromString(e,...t));return dd(n),new ze(r.firestore,r instanceof nn?r.converter:null,new $(n))}}function yd(r,e){return r=(0,ie.Ku)(r),e=(0,ie.Ku)(e),(r instanceof ze||r instanceof nn)&&(e instanceof ze||e instanceof nn)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Bu(r,e){return r=(0,ie.Ku)(r),e=(0,ie.Ku)(e),r instanceof pt&&e instanceof pt&&r.firestore===e.firestore&&Ti(r._query,e._query)&&r.converter===e.converter}class Pg{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Va(this,"async_queue_retry"),this.hu=()=>{const t=Xs();t&&F("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const e=Xs();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Xs();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new He;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,V.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Yo.reset()}catch(t){if(!$t(t))throw t;F("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Yo.$o(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{throw this.au=n,this.uu=!1,Pe("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=Wa.createAndSchedule(this,e,t,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&W()}verifyOperationInProgress(){}du(){var e=this;return(0,V.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Uu(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class Sg{constructor(){this._progressObserver={},this._taskCompletionResolver=new He,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ke extends qi{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Pg,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Id(this),this._firestoreClient.terminate()}}function We(r){return r._firestoreClient||Id(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Id(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new tm(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,cd(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new mg(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Ed(r,e,t){const n=new He;return r.asyncQueue.enqueue((0,V.A)(function*(){try{yield ro(r,t),yield Cu(r,e),n.resolve()}catch(i){const s=i;if(!rd(s))throw s;it("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Td(r){if(r._initialized||r._terminated)throw new U(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class rn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rn(at.fromBase64String(e))}catch(t){throw new U(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new rn(at.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new U(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new De(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class sr{constructor(e){this._methodName=e}}class ao{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return re(this._lat,e._lat)||re(this._long,e._long)}}const Bg=/^__.*__$/;class Ug{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ln(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dr(e,this.data,t,this.fieldTransforms)}}class vd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ln(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ad(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W()}}class uo{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new uo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return ho(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(Ad(this.fu)&&Bg.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class qg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Bi(e)}Fu(e,t,n,i=!1){return new uo({fu:e,methodName:t,vu:n,path:De.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function or(r){const e=r._freezeSettings(),t=Bi(r._databaseId);return new qg(r._databaseId,!!e.ignoreUndefinedProperties,t)}function co(r,e,t,n,i,s={}){const a=r.Fu(s.merge||s.mergeFields?2:0,e,t,i);Qu("Data must be an object, but it was:",a,n);const u=Rd(n,a);let c,h;if(s.merge)c=new Ft(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const p of s.mergeFields){const y=Gi(e,p,t);if(!a.contains(y))throw new U(N.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Sd(f,y)||f.push(y)}c=new Ft(f),h=a.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=a.fieldTransforms;return new Ug(new mt(u),c,h)}class ji extends sr{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ji}}function wd(r,e,t){return new uo({fu:3,vu:e.settings.vu,methodName:r._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class qu extends sr{_toFieldTransform(e){return new bi(e.path,new xr)}isEqual(e){return e instanceof qu}}class zu extends sr{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=wd(this,e,!0),n=this.Mu.map(s=>ar(s,t)),i=new Jn(n);return new bi(e.path,i)}isEqual(e){return e instanceof zu&&(0,ie.bD)(this.Mu,e.Mu)}}class ju extends sr{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=wd(this,e,!0),n=this.Mu.map(s=>ar(s,t)),i=new Yn(n);return new bi(e.path,i)}isEqual(e){return e instanceof ju&&(0,ie.bD)(this.Mu,e.Mu)}}class Gu extends sr{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new Cr(e.serializer,hl(e.serializer,this.xu));return new bi(e.path,t)}isEqual(e){return e instanceof Gu&&this.xu===e.xu}}function Ku(r,e,t,n){const i=r.Fu(1,e,t);Qu("Data must be an object, but it was:",i,n);const s=[],a=mt.empty();vn(n,(c,h)=>{const f=lo(e,c,t);h=(0,ie.Ku)(h);const p=i.Su(f);if(h instanceof ji)s.push(f);else{const y=ar(h,p);null!=y&&(s.push(f),a.set(f,y))}});const u=new Ft(s);return new vd(a,u,i.fieldTransforms)}function $u(r,e,t,n,i,s){const a=r.Fu(1,e,t),u=[Gi(e,n,t)],c=[i];if(s.length%2!=0)throw new U(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)u.push(Gi(e,s[y])),c.push(s[y+1]);const h=[],f=mt.empty();for(let y=u.length-1;y>=0;--y)if(!Sd(h,u[y])){const x=u[y];let L=c[y];L=(0,ie.Ku)(L);const G=a.Su(x);if(L instanceof ji)h.push(x);else{const z=ar(L,G);null!=z&&(h.push(x),f.set(x,z))}}const p=new Ft(h);return new vd(f,p,a.fieldTransforms)}function bd(r,e,t,n=!1){return ar(t,r.Fu(n?4:3,e))}function ar(r,e){if(Pd(r=(0,ie.Ku)(r)))return Qu("Unsupported field value:",e,r),Rd(r,e);if(r instanceof sr)return function(n,i){if(!Ad(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=ar(u,i.bu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ie.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return hl(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=Me.fromDate(n);return{timestampValue:kr(i.serializer,s)}}if(n instanceof Me){const s=new Me(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:kr(i.serializer,s)}}if(n instanceof ao)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof rn)return{bytesValue:Nl(i.serializer,n._byteString)};if(n instanceof ze){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ra(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${so(n)}`)}(r,e)}function Rd(r,e){const t={};return Dc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vn(r,(n,i)=>{const s=ar(i,e.pu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function Pd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Me||r instanceof ao||r instanceof rn||r instanceof ze||r instanceof sr)}function Qu(r,e,t){if(!Pd(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=so(t);throw e.Du("an object"===n?r+" a custom object":r+" "+n)}var i}function Gi(r,e,t){if((e=(0,ie.Ku)(e))instanceof fn)return e._internalPath;if("string"==typeof e)return lo(r,e);throw ho("Field path arguments must be of type string or ",r,!1,void 0,t)}const zg=new RegExp("[~\\*/\\[\\]]");function lo(r,e,t){if(e.search(zg)>=0)throw ho(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new fn(...e.split("."))._internalPath}catch{throw ho(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ho(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new U(N.INVALID_ARGUMENT,u+r+c)}function Sd(r,e){return r.some(t=>t.isEqual(e))}class Ki{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ze(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new jg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(fo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class jg extends Ki{data(){return super.data()}}function fo(r,e){return"string"==typeof e?lo(r,e):e instanceof fn?e._internalPath:e._delegate._internalPath}function Vd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new U(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wu{}class $i extends Wu{}function kn(r,e,...t){let n=[];e instanceof Wu&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof ei).length,u=s.filter(c=>c instanceof Qi).length;if(a>1||a>0&&u>0)throw new U(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Qi extends $i{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Qi(e,t,n)}_apply(e){const t=this._parse(e);return Nd(e._query,t),new pt(e.firestore,e.converter,Ho(e._query,t))}_parse(e){const t=or(e.firestore);return function(s,a,u,c,h,f,p){let y;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new U(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){Dd(p,f);const x=[];for(const L of p)x.push(Cd(c,s,L));y={arrayValue:{values:x}}}else y=Cd(c,s,p)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||Dd(p,f),y=bd(u,"where",p,"in"===f||"not-in"===f);return Ee.create(h,f,y)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class ei extends Wu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ei(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:xe.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)Nd(a,c),a=Ho(a,c)}(e._query,t),new pt(e.firestore,e.converter,Ho(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Hu extends $i{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Hu(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new U(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new U(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ii(s,a)}(e._query,this._field,this._direction);return new pt(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new un(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class mo extends $i{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new mo(e,t,n)}_apply(e){return new pt(e.firestore,e.converter,Cs(e._query,this._limit,this._limitType))}}class po extends $i{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new po(e,t,n)}_apply(e){const t=xd(e,this.type,this._docOrFields,this._inclusive);return new pt(e.firestore,e.converter,(s=t,new un((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class go extends $i{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new go(e,t,n)}_apply(e){const t=xd(e,this.type,this._docOrFields,this._inclusive);return new pt(e.firestore,e.converter,(s=t,new un((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function xd(r,e,t,n){if(t[0]=(0,ie.Ku)(t[0]),t[0]instanceof Ki)return function(s,a,u,c,h){if(!c)throw new U(N.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const p of Sr(s))if(p.field.isKeyField())f.push(Wn(a,c.key));else{const y=c.data.field(p.field);if(ws(y))throw new U(N.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===y){const x=p.field.canonicalString();throw new U(N.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${x}' (used as the orderBy) does not exist.`)}f.push(y)}return new Pn(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=or(r.firestore);return function(a,u,c,h,f,p){const y=a.explicitOrderBy;if(f.length>y.length)throw new U(N.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const x=[];for(let L=0;L<f.length;L++){const G=f[L];if(y[L].field.isKeyField()){if("string"!=typeof G)throw new U(N.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof G}`);if(!Wo(a)&&-1!==G.indexOf("/"))throw new U(N.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${G}' contains a slash.`);const z=a.path.child(he.fromString(G));if(!$.isDocumentKey(z))throw new U(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${z}' is not because it contains an odd number of segments.`);const X=new $(z);x.push(Wn(u,X))}else{const z=bd(c,h,G);x.push(z)}}return new Pn(x,p)}(r._query,r.firestore._databaseId,i,e,t,n)}}function Cd(r,e,t){if("string"==typeof(t=(0,ie.Ku)(t))){if(""===t)throw new U(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wo(e)&&-1!==t.indexOf("/"))throw new U(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(he.fromString(t));if(!$.isDocumentKey(n))throw new U(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Wn(r,new $(n))}if(t instanceof ze)return Wn(r,t._key);throw new U(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${so(t)}.`)}function Dd(r,e){if(!Array.isArray(r)||0===r.length)throw new U(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Nd(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new U(N.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Ju{convertValue(e,t="none"){switch(bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Je(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(an(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw W()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return vn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new ao(Je(e.latitude),Je(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=bs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(pi(e));default:return null}}convertTimestamp(e){const t=on(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=he.fromString(e);J(Kl(n));const i=new An(n.get(1),n.get(3)),s=new $(n.popFirst(5));return i.isEqual(t)||Pe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function _o(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class Xg extends Ju{constructor(e){super(),this.firestore=e}convertBytes(e){return new rn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ze(this.firestore,null,t)}}class ur{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mn extends Ki{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Wi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(fo("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Wi extends mn{data(e={}){return super.data(e)}}class Mn{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ur(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Wi(this._firestore,this._userDataWriter,n.key,n,new ur(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Wi(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ur(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Wi(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ur(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:e_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function e_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W()}}function Md(r,e){return r instanceof mn&&e instanceof mn?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Mn&&e instanceof Mn&&r._firestore===e._firestore&&Bu(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class On extends Ju{constructor(e){super(),this.firestore=e}convertBytes(e){return new rn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ze(this.firestore,null,t)}}function Od(r,e,t){r=pe(r,ze);const n=pe(r.firestore,ke),i=_o(r.converter,e,t);return ti(n,[co(or(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Qe.none())])}function Fd(r,e,t,...n){r=pe(r,ze);const i=pe(r.firestore,ke),s=or(i);let a;return a="string"==typeof(e=(0,ie.Ku)(e))||e instanceof fn?$u(s,"updateDoc",r._key,e,t,n):Ku(s,"updateDoc",r._key,e),ti(i,[a.toMutation(r._key,Qe.exists(!0))])}function Ld(r,...e){var t,n,i;r=(0,ie.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Uu(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Uu(e[a])){const p=e[a];e[a]=null===(t=p.next)||void 0===t?void 0:t.bind(p),e[a+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),e[a+2]=null===(i=p.complete)||void 0===i?void 0:i.bind(p)}let c,h,f;if(r instanceof ze)h=pe(r.firestore,ke),f=Pr(r._key.path),c={next:p=>{e[a]&&e[a](Yu(h,r,p))},error:e[a+1],complete:e[a+2]};else{const p=pe(r,pt);h=pe(p.firestore,ke),f=p._query;const y=new On(h);c={next:x=>{e[a]&&e[a](new Mn(h,y,p,x))},error:e[a+1],complete:e[a+2]},Vd(r._query)}return function(y,x,L,G){const z=new no(G),X=new tu(x,z,L);return y.asyncQueue.enqueueAndForget((0,V.A)(function*(){return Ha(yield Zr(y),X)})),()=>{z.$a(),y.asyncQueue.enqueueAndForget((0,V.A)(function*(){return Ya(yield Zr(y),X)}))}}(We(h),f,u,c)}function ti(r,e){return function(n,i){const s=new He;return n.asyncQueue.enqueueAndForget((0,V.A)(function*(){return function Wp(r,e,t){return cu.apply(this,arguments)}(yield Ou(n),i,s)})),s.promise}(We(r),e)}function Yu(r,e,t){const n=t.docs.get(e._key),i=new On(r);return new mn(r,i,e._key,n,new ur(t.hasPendingWrites,t.fromCache),e.converter)}const y_={maxAttempts:5};class Bd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=or(e)}set(e,t,n){this._verifyNotCommitted();const i=Fn(e,this._firestore),s=_o(i.converter,t,n),a=co(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,Qe.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Fn(e,this._firestore);let a;return a="string"==typeof(t=(0,ie.Ku)(t))||t instanceof fn?$u(this._dataReader,"WriteBatch.update",s._key,t,n,i):Ku(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Qe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fn(e,this._firestore);return this._mutations=this._mutations.concat(new Nr(t._key,Qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new U(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fn(r,e){if((r=(0,ie.Ku)(r)).firestore!==e)throw new U(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class I_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=or(t)}get(t){const n=Fn(t,this._firestore),i=new Xg(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return W();const a=s[0];if(a.isFoundDocument())return new Ki(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Ki(this._firestore,i,n._key,null,n.converter);throw W()})}set(t,n,i){const s=Fn(t,this._firestore),a=_o(s.converter,n,i),u=co(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Fn(t,this._firestore);let u;return u="string"==typeof(n=(0,ie.Ku)(n))||n instanceof fn?$u(this._dataReader,"Transaction.update",a._key,n,i,s):Ku(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Fn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fn(e,this._firestore),n=new On(this._firestore);return super.get(e).then(i=>new mn(this._firestore,n,t._key,i._document,new ur(!1,!1),t.converter))}}function Zu(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new U("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function jd(){if(typeof Uint8Array>"u")throw new U("unimplemented","Uint8Arrays are not available in this environment.")}function Gd(){if(!function Zf(){return typeof atob<"u"}())throw new U("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){jt=ve.SDK_VERSION,(0,ve._registerComponent)(new Ie.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new ke(new _r(n.getProvider("auth-internal")),new ys(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new U(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new An(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,ve.registerVersion)(Ht,"4.6.4",e),(0,ve.registerVersion)(Ht,"4.6.4","esm2017")}();class Hi{constructor(e){this._delegate=e}static fromBase64String(e){return Gd(),new Hi(rn.fromBase64String(e))}static fromUint8Array(e){return jd(),new Hi(rn.fromUint8Array(e))}toBase64(){return Gd(),this._delegate.toBase64()}toUint8Array(){return jd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function ec(r){return function V_(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class x_{enableIndexedDbPersistence(e,t){return function xg(r,e){Td(r=pe(r,ke));const t=We(r);if(t._uninitializedComponentsProvider)throw new U(N.FAILED_PRECONDITION,"SDK cache is already specified.");it("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Yr;return Ed(t,i,new Vu(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Cg(r){Td(r=pe(r,ke));const e=We(r);if(e._uninitializedComponentsProvider)throw new U(N.FAILED_PRECONDITION,"SDK cache is already specified.");it("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Yr;return Ed(e,n,new td(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Dg(r){if(r._initialized&&!r._terminated)throw new U(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new He;return r._queue.enqueueAndForgetEvenWhileRestricted((0,V.A)(function*(){try{yield(t=(0,V.A)(function*(i){if(!kt.D())return Promise.resolve();const s=i+"main";yield kt.delete(s)}),function n(i){return t.apply(this,arguments)})(ya(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Kd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof An||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&it("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function gd(r,e,t,n={}){var i;const s=(r=pe(r,qi))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&it("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ue.MOCK_USER;else{u=(0,ie.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new U(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ue(h)}r._authCredentials=new yn(new ai(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function kg(r){return function pg(r){return r.asyncQueue.enqueue((0,V.A)(function*(){const e=yield id(r),t=yield sd(r);return e.setNetworkEnabled(!0),function(i){const s=K(i);return s.M_.delete(0),Ui(s)}(t)}))}(We(r=pe(r,ke)))}(this._delegate)}disableNetwork(){return function Mg(r){return function gg(r){return r.asyncQueue.enqueue((0,V.A)(function*(){const e=yield id(r),t=yield sd(r);return e.setNetworkEnabled(!1),(n=(0,V.A)(function*(s){const a=K(s);a.M_.add(0),yield zr(a),a.N_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(We(r=pe(r,ke)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,hd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Ng(r){return function(t){const n=new He;return t.asyncQueue.enqueueAndForget((0,V.A)(function*(){return function Xp(r,e){return mu.apply(this,arguments)}(yield Ou(t),n)})),n.promise}(We(r=pe(r,ke)))}(this._delegate)}onSnapshotsInSync(e){return function c_(r,e){return function Eg(r,e){const t=new no(e);return r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return i=yield Zr(r),s=t,K(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return i=yield Zr(r),s=t,void K(i).z_.delete(s);var i,s}))}}(We(r=pe(r,ke)),Uu(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new U("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ni(this,_d(this._delegate,e))}catch(t){throw Pt(t,"collection()","Firestore.collection()")}}doc(e){try{return new zt(this,oo(this._delegate,e))}catch(t){throw Pt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new St(this,function Rg(r,e){if(r=pe(r,qi),Lu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new U(N.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pt(r,null,(n=e,new un(he.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Pt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function E_(r,e,t){r=pe(r,ke);const n=Object.assign(Object.assign({},y_),t);return function(s){if(s.maxAttempts<1)throw new U(N.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new He;return s.asyncQueue.enqueueAndForget((0,V.A)(function*(){const h=yield function od(r){return io(r).then(e=>e.datastore)}(s);new fg(s.asyncQueue,h,u,a,c).Xa()})),c.promise}(We(r),i=>e(new I_(r,i)),n)}(this._delegate,t=>e(new $d(this,t)))}batch(){return We(this._delegate),new Qd(new Bd(this._delegate,e=>ti(this._delegate,e)))}loadBundle(e){return function Og(r,e){const t=We(r=pe(r,ke)),n=new Sg;return function Tg(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?bl().encode(a):a,f=function(f,p){if(f instanceof Uint8Array)return nd(f,p);if(f instanceof ArrayBuffer)return nd(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new hg(f,u);var f}(t,Bi(e));r.asyncQueue.enqueueAndForget((0,V.A)(function*(){!function cg(r,e,t){const n=K(r);var i;(i=(0,V.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(L,G){const z=K(L),X=Xe(G.createTime);return z.persistence.runTransaction("hasNewerBundle","readonly",ne=>z.$r.getBundleMetadata(ne,G.id)).then(ne=>!!ne&&ne.createTime.compareTo(X)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(L=h).totalDocuments,bytesLoaded:L.totalBytes,totalDocuments:L.totalDocuments,totalBytes:L.totalBytes}),Promise.resolve(new Set);c._updateProgress(Kh(h));const f=new Up(h,a.localStore,u.serializer);let p=yield u.qa();for(;p;){const x=yield f._a(p);x&&c._updateProgress(x),p=yield u.qa()}const y=yield f.complete();return yield dn(a,y.ca,void 0),yield function(L,G){const z=K(L);return z.persistence.runTransaction("Save bundle","readwrite",X=>z.$r.saveBundleMetadata(X,G))}(a.localStore,h),c._completeWith(y.progress),Promise.resolve(y.ua)}catch(h){return it("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var L}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield Ou(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function Fg(r,e){return function vg(r,e){return r.asyncQueue.enqueue((0,V.A)(function*(){return function(n,i){const s=K(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield Xr(r),e)}))}(We(r=pe(r,ke)),e).then(t=>t?new pt(r,null,t.query):null)}(this._delegate,e).then(t=>t?new St(this,t):null)}}class Io extends Ju{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hi(new rn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return zt.forKey(t,this.firestore,null)}}class $d{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Io(e)}get(e){const t=lr(e);return this._delegate.get(t).then(n=>new Ji(this._firestore,new mn(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=lr(e);return n?(Zu("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=lr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=lr(e);return this._delegate.delete(t),this}}class Qd{constructor(e){this._delegate=e}set(e,t,n){const i=lr(e);return n?(Zu("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=lr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=lr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class cr{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Wi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Yi(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=cr.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new cr(e,new Io(e),t),i.set(t,s)),s}}cr.INSTANCES=new WeakMap;class zt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Io(e)}static forPath(e,t,n){if(e.length%2!=0)throw new U("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new zt(t,new ze(t._delegate,n,new $(e)))}static forKey(e,t,n){return new zt(t,new ze(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ni(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ni(this.firestore,_d(this._delegate,e))}catch(t){throw Pt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ie.Ku)(e))instanceof ze&&yd(this._delegate,e)}set(e,t){t=Zu("DocumentReference.set",t);try{return t?Od(this._delegate,e,t):Od(this._delegate,e)}catch(n){throw Pt(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Fd(this._delegate,e):Fd(this._delegate,e,t,...n)}catch(i){throw Pt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function a_(r){return ti(pe(r.firestore,ke),[new Nr(r._key,Qe.none())])}(this._delegate)}onSnapshot(...e){const t=Wd(e),n=Hd(e,i=>new Ji(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Ld(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function n_(r){r=pe(r,ze);const e=pe(r.firestore,ke),t=We(e),n=new On(e);return function _g(r,e){const t=new He;return r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return(n=(0,V.A)(function*(s,a,u){try{const c=yield function(f,p){const y=K(f);return y.persistence.runTransaction("read document","readonly",x=>y.localDocuments.getDocument(x,p))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new U(N.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=$r(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Xr(r),e,t);var n})),t.promise}(t,r._key).then(i=>new mn(e,n,r._key,i,new ur(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function r_(r){r=pe(r,ze);const e=pe(r.firestore,ke);return ad(We(e),r._key,{source:"server"}).then(t=>Yu(e,r,t))}(this._delegate):function t_(r){r=pe(r,ze);const e=pe(r.firestore,ke);return ad(We(e),r._key).then(t=>Yu(e,r,t))}(this._delegate),t.then(n=>new Ji(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new zt(this.firestore,this._delegate.withConverter(e?cr.getInstance(this.firestore,e):null))}}function Pt(r,e,t){return r.message=r.message.replace(e,t),r}function Wd(r){for(const e of r)if("object"==typeof e&&!ec(e))return e;return{}}function Hd(r,e){var t,n;let i;return i=ec(r[0])?r[0]:ec(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Ji{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new zt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Md(this._delegate,e._delegate)}}class Yi extends Ji{data(e){const t=this._delegate.data(e);return this._delegate._converter||function _s(r,e){r||W()}(void 0!==t),t}}class St{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Io(e)}where(e,t,n){try{return new St(this.firestore,kn(this._delegate,function Gg(r,e,t){const n=e,i=fo("where",r);return Qi._create(i,n,t)}(e,t,n)))}catch(i){throw Pt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new St(this.firestore,kn(this._delegate,function Kg(r,e="asc"){const t=e,n=fo("orderBy",r);return Hu._create(n,t)}(e,t)))}catch(n){throw Pt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new St(this.firestore,kn(this._delegate,function $g(r){return md("limit",r),mo._create("limit",r,"F")}(e)))}catch(t){throw Pt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new St(this.firestore,kn(this._delegate,function Qg(r){return md("limitToLast",r),mo._create("limitToLast",r,"L")}(e)))}catch(t){throw Pt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new St(this.firestore,kn(this._delegate,function Wg(...r){return po._create("startAt",r,!0)}(...e)))}catch(t){throw Pt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new St(this.firestore,kn(this._delegate,function Hg(...r){return po._create("startAfter",r,!1)}(...e)))}catch(t){throw Pt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new St(this.firestore,kn(this._delegate,function Jg(...r){return go._create("endBefore",r,!1)}(...e)))}catch(t){throw Pt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new St(this.firestore,kn(this._delegate,function Yg(...r){return go._create("endAt",r,!0)}(...e)))}catch(t){throw Pt(t,"endAt()","Query.endAt()")}}isEqual(e){return Bu(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function s_(r){r=pe(r,pt);const e=pe(r.firestore,ke),t=We(e),n=new On(e);return function yg(r,e){const t=new He;return r.asyncQueue.enqueueAndForget((0,V.A)(function*(){return(n=(0,V.A)(function*(s,a,u){try{const c=yield Ws(s,a,!0),h=new Wh(a,c.hs),f=h.da(c.documents),p=h.applyChanges(f,!1);u.resolve(p.snapshot)}catch(c){const h=$r(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Xr(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Mn(e,n,r,i))}(this._delegate):"server"===e?.source?function o_(r){r=pe(r,pt);const e=pe(r.firestore,ke),t=We(e),n=new On(e);return ud(t,r._query,{source:"server"}).then(i=>new Mn(e,n,r,i))}(this._delegate):function i_(r){r=pe(r,pt);const e=pe(r.firestore,ke),t=We(e),n=new On(e);return Vd(r._query),ud(t,r._query).then(i=>new Mn(e,n,r,i))}(this._delegate),t.then(n=>new tc(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Wd(e),n=Hd(e,i=>new tc(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Ld(this._delegate,t,n)}withConverter(e){return new St(this.firestore,this._delegate.withConverter(e?cr.getInstance(this.firestore,e):null))}}class D_{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Yi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class tc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new St(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Yi(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new D_(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Yi(this._firestore,n))})}isEqual(e){return Md(this._delegate,e._delegate)}}class ni extends St{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new zt(this.firestore,e):null}doc(e){try{return new zt(this.firestore,void 0===e?oo(this._delegate):oo(this._delegate,e))}catch(t){throw Pt(t,"doc()","CollectionReference.doc()")}}add(e){return function u_(r,e){const t=pe(r.firestore,ke),n=oo(r),i=_o(r.converter,e);return ti(t,[co(or(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,Qe.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new zt(this.firestore,t))}isEqual(e){return yd(this._delegate,e._delegate)}withConverter(e){return new ni(this.firestore,this._delegate.withConverter(e?cr.getInstance(this.firestore,e):null))}}function lr(r){return pe(r,ze)}class nc{constructor(...e){this._delegate=new fn(...e)}static documentId(){return new nc(De.keyField().canonicalString())}isEqual(e){return(e=(0,ie.Ku)(e))instanceof fn&&this._delegate._internalPath.isEqual(e._internalPath)}}class hr{constructor(e){this._delegate=e}static serverTimestamp(){const e=function v_(){return new qu("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new hr(e)}static delete(){const e=function T_(){return new ji("deleteField")}();return e._methodName="FieldValue.delete",new hr(e)}static arrayUnion(...e){const t=function A_(...r){return new zu("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new hr(t)}static arrayRemove(...e){const t=function w_(...r){return new ju("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new hr(t)}static increment(e){const t=function b_(r){return new Gu("increment",r)}(e);return t._methodName="FieldValue.increment",new hr(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const N_={Firestore:Kd,GeoPoint:ao,Timestamp:Me,Blob:Hi,Transaction:$d,WriteBatch:Qd,DocumentReference:zt,DocumentSnapshot:Ji,Query:St,QueryDocumentSnapshot:Yi,QuerySnapshot:tc,CollectionReference:ni,FieldPath:nc,FieldValue:hr,setLogLevel:function C_(r){!function Ze(r){ye.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};!function M_(r){(function k_(r,e){r.INTERNAL.registerComponent(new Ie.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},N_)))})(r,(e,t)=>new Kd(e,t,new x_)),r.registerVersion("@firebase/firestore-compat","0.3.33")}(Te.A)},467:(gr,Ct,Se)=>{function Te(ve,Ie,Ge,ie,tt,lt,we){try{var q=ve[lt](we),j=q.value}catch(ee){return void Ge(ee)}q.done?Ie(j):Promise.resolve(j).then(ie,tt)}function V(ve){return function(){var Ie=this,Ge=arguments;return new Promise(function(ie,tt){var lt=ve.apply(Ie,Ge);function we(j){Te(lt,ie,tt,we,q,"next",j)}function q(j){Te(lt,ie,tt,we,q,"throw",j)}we(void 0)})}}Se.d(Ct,{A:()=>V})}}]);